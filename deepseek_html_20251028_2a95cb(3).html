<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูููุฏุณ ุงูุดูุฑุช ุจุฑูุฏ ุงูุนููู - ุงููุณุฎุฉ ุงููุญุณูุฉ ูุงููุตุญุญุฉ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #d97706;
            --primary-dark: #b45309;
            --primary-light: #f59e0b;
            --secondary-color: #059669;
            --warning-color: #dc2626;
            --background: #fef3c7;
            --card-bg: #ffffff;
            --text-dark: #1f2937;
            --text-light: #6b7280;
            --border-radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --touch-target: 44px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 50%, #fde68a 100%);
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-color) 50%, var(--primary-dark) 100%);
            color: white;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            padding: 1.5rem;
            margin: 1rem auto 0;
            max-width: 1200px;
            box-shadow: var(--shadow);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .header-icon {
            font-size: 3rem;
        }

        .header h1 {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .header-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-top: 0.5rem;
            text-align: center;
        }

        .header-info {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            padding: 1rem;
            margin-top: 1rem;
        }

        .info-items {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
            font-size: 0.9rem;
        }

        .tabs {
            display: flex;
            background: white;
            border-bottom: 2px solid #e5e7eb;
            box-shadow: var(--shadow);
            max-width: 1200px;
            margin: 0 auto;
            overflow-x: auto;
        }

        .tab {
            flex: 1;
            min-width: 120px;
            padding: 1rem 0.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            background: #f9fafb;
            color: var(--text-light);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            white-space: nowrap;
        }

        .tab:hover {
            background: #f3f4f6;
        }

        .tab.active {
            background: white;
            border-bottom: 4px solid var(--primary-color);
            color: var(--primary-dark);
        }

        .tab:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .content {
            background: white;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            min-height: 600px;
            max-width: 1200px;
            margin: 0 auto 2rem;
        }

        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 2px solid #e5e7eb;
            transition: all 0.3s ease;
        }

        .card-amber {
            background: #fef3c7;
            border-color: #fbbf24;
        }

        .card-blue {
            background: #dbeafe;
            border-color: #60a5fa;
        }

        .card-green {
            background: #dcfce7;
            border-color: #4ade80;
        }

        .card-red {
            background: #fee2e2;
            border-color: #f87171;
        }

        .card-purple {
            background: #f3e8ff;
            border-color: #a855f7;
        }

        .card-yellow {
            background: #fef9c3;
            border-color: #facc15;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-dark);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .subsection-title {
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 0.75rem;
            color: var(--text-dark);
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1rem;
        }

        .grid-4 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 1rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-dark);
        }

        .form-input, .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            font-family: inherit;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .form-hint {
            font-size: 0.875rem;
            color: var(--text-light);
            margin-top: 0.5rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            min-height: var(--touch-target);
            touch-action: manipulation;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-dark) 0%, #dc2626 100%);
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--secondary-color) 0%, #0d9488 100%);
            color: white;
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #047857 0%, #0f766e 100%);
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #dc2626;
            color: white;
        }

        .btn-danger:hover {
            background: #b91c1c;
        }

        .btn-full {
            width: 100%;
        }

        .option-card {
            padding: 1.5rem;
            text-align: right;
            border-radius: 8px;
            border: 2px solid #d1d5db;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .option-card.selected {
            border-color: var(--primary-color);
            background: #fef3c7;
            box-shadow: 0 4px 12px rgba(217, 119, 6, 0.2);
        }

        .option-card-title {
            font-size: 1.125rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .option-card-desc {
            font-size: 0.875rem;
            color: var(--text-light);
        }

        .mode-selector {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .mode-btn {
            flex: 1;
            padding: 1rem;
            border: 2px solid #d1d5db;
            border-radius: var(--border-radius);
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .mode-btn:hover {
            border-color: var(--primary-color);
        }

        .mode-btn.active {
            border-color: var(--primary-color);
            background: #fef3c7;
            font-weight: bold;
        }

        .mode-description {
            font-size: 0.875rem;
            color: var(--text-light);
            margin-top: 0.5rem;
        }

        .auto-settings {
            background: #f0f9ff;
            border: 2px solid #bfdbfe;
            border-radius: 8px;
            padding: 1rem;
            margin: 0.5rem 0;
        }

        .stat-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
        }

        .stat-icon {
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-light);
        }

        .stat-value {
            font-size: 1.25rem;
            font-weight: bold;
            color: var(--text-dark);
            margin-top: 0.25rem;
        }

        .ingredient-card {
            padding: 1rem;
            border-radius: 8px;
            border: 2px solid #d1d5db;
            background: white;
        }

        .ingredient-card.additive {
            background: #dcfce7;
            border-color: #22c55e;
        }

        .ingredient-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .ingredient-name {
            font-weight: bold;
            font-size: 1.125rem;
        }

        .ingredient-amount {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .ingredient-note {
            font-size: 0.875rem;
            color: var(--text-light);
            margin-top: 0.5rem;
        }

        .step-card {
            background: #dbeafe;
            padding: 1.25rem;
            border-radius: 8px;
            border: 2px solid #93c5fd;
            margin-bottom: 1rem;
        }

        .step-header {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            align-items: flex-start;
        }

        .step-number {
            width: 2.5rem;
            height: 2.5rem;
            background: #2563eb;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .step-action {
            font-weight: bold;
            font-size: 1.125rem;
            color: #1e40af;
            margin-bottom: 0.75rem;
        }

        .step-detail {
            background: white;
            padding: 0.75rem;
            border-radius: 6px;
            border: 1px solid #93c5fd;
            margin-bottom: 0.75rem;
        }

        .step-tip {
            background: #fef9c3;
            padding: 0.75rem;
            border-radius: 6px;
            border: 1px solid #facc15;
            margin-bottom: 0.75rem;
        }

        .checkpoint-card {
            border: 2px solid #d1d5db;
            border-radius: var(--border-radius);
            background: white;
            margin-bottom: 1rem;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .checkpoint-card.completed {
            border-color: var(--secondary-color);
            background: #ecfdf5;
        }

        .checkpoint-content {
            padding: 1.5rem;
        }

        .checkpoint-header {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }

        .checkpoint-toggle {
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            border: 4px solid #d1d5db;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            flex-shrink: 0;
            font-size: 1.25rem;
            font-weight: bold;
        }

        .checkpoint-toggle:hover {
            border-color: var(--primary-color);
        }

        .checkpoint-toggle.completed {
            background: var(--secondary-color);
            border-color: #059669;
            color: white;
        }

        .checkpoint-timing {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .checkpoint-title {
            font-size: 1.25rem;
            font-weight: bold;
            color: var(--text-dark);
            margin-bottom: 0.75rem;
        }

        .checkpoint-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .checkpoint-target {
            background: #dcfce7;
            padding: 1rem;
            border-radius: 8px;
            border: 2px solid #22c55e;
        }

        .checkpoint-test {
            background: #dbeafe;
            padding: 1rem;
            border-radius: 8px;
            border: 2px solid #3b82f6;
        }

        .checkpoint-why {
            background: #f3e8ff;
            padding: 1rem;
            border-radius: 8px;
            border: 2px solid #8b5cf6;
            margin-bottom: 1rem;
        }

        .checkpoint-fix {
            background: #fef3c7;
            padding: 1rem;
            border-radius: 8px;
            border: 2px solid var(--primary-color);
        }

        .recipe-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .recipe-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .recipe-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .recipe-meta {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .recipe-preview {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .preview-stats {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .recipe-actions {
            display: flex;
            gap: 0.5rem;
        }

        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .mb-2 {
            margin-bottom: 0.5rem;
        }

        .mb-4 {
            margin-bottom: 1rem;
        }

        .mt-2 {
            margin-top: 0.5rem;
        }

        .mt-4 {
            margin-top: 1rem;
        }

        .space-y-4 > * + * {
            margin-top: 1rem;
        }

        .space-y-6 > * + * {
            margin-top: 1.5rem;
        }

        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .loading-spinner {
            width: 3rem;
            height: 3rem;
            border: 4px solid #f3f4f6;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: var(--secondary-color);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .warning-badge {
            display: inline-block;
            background: #fef3c7;
            color: var(--primary-dark);
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 600;
            margin-right: 0.5rem;
        }

        /* ุฃููุงุท ุฌุฏูุฏุฉ ูุญุณูุฉ */
        .checkbox-group {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            border: 2px solid #d1d5db;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checkbox-group:hover {
            border-color: var(--primary-color);
        }

        .checkbox-group input[type="checkbox"] {
            width: 1.25rem;
            height: 1.25rem;
            margin-top: 0.25rem;
        }

        .butter-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: bold;
            margin-left: 0.5rem;
        }

        .badge-european { background: #dcfce7; color: #166534; }
        .badge-american { background: #dbeafe; color: #1e40af; }
        .badge-vegetable { background: #f3e8ff; color: #7e22ce; }
        .badge-mixed { background: #fef3c7; color: #d97706; }

        .metric-bar {
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin: 0.5rem 0;
        }

        .metric-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--primary-dark));
            transition: width 0.5s ease;
        }

        .tooltip {
            position: relative;
            cursor: help;
        }

        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1f2937;
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            font-size: 0.875rem;
            white-space: nowrap;
            z-index: 1000;
        }

        /* ูุฆุงุช ุงูุฃููุงู ุงูููููุฏุฉ */
        .text-green-700 { color: #15803d; }
        .text-amber-700 { color: #b45309; }
        .text-purple-700 { color: #7e22ce; }
        .text-yellow-700 { color: #a16207; }
        .text-blue-800 { color: #1e40af; }
        .text-green-800 { color: #166534; }
        .text-red-800 { color: #991b1b; }
        .text-gray-600 { color: #4b5563; }
        .text-gray-700 { color: #374151; }

        /* ูุฆุงุช ุงูุฎูููุฉ ุงูููููุฏุฉ */
        .bg-blue-50 { background-color: #eff6ff; }
        .bg-green-50 { background-color: #f0fdf4; }
        .bg-amber-50 { background-color: #fffbeb; }
        .bg-red-50 { background-color: #fef2f2; }
        .bg-white { background-color: #ffffff; }
        .bg-gray-50 { background-color: #f9fafb; }

        /* ูุฆุงุช ุงูุฎุทูุท ุงูููููุฏุฉ */
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }

        /* ูุฆุงุช ุงููุงูุด ูุงููุณุงูุงุช ุงูููููุฏุฉ */
        .space-y-1 > * + * { margin-top: 0.25rem; }
        .space-y-2 > * + * { margin-top: 0.5rem; }
        .space-y-3 > * + * { margin-top: 0.75rem; }

        /* ูุฆุงุช ุงูุญุงููุฉ ุงููุฑูุฉ ุงูููููุฏุฉ */
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 0.5rem; }
        .gap-4 { gap: 1rem; }
        .flex-wrap { flex-wrap: wrap; }

        /* ูุฆุงุช ุงูุนุฑุถ ูุงูุงุฑุชูุงุน ุงูููููุฏุฉ */
        .w-full { width: 100%; }
        .h-full { height: 100%; }

        /* ูุฆุงุช ุงูุญูุงู ุงูููููุฏุฉ */
        .border-green-200 { border-color: #bbf7d0; }
        .border-blue-200 { border-color: #bfdbfe; }

        /* ุชุญุณููุงุช ูุจุทุงูุงุช ุงูุงูุชุฑุงุญุงุช ุงูุฐููุฉ */
        .suggestion-card {
            transition: all 0.3s ease;
        }

        .suggestion-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px -3px rgba(0, 0, 0, 0.1);
        }

        /* ุชุญุณููุงุช ูุจุทุงูุงุช ููุงุฑูุฉ ุงูุจุฑููุงููุงุช */
        .profile-match-card {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .profile-match-card:hover {
            transform: translateX(-5px);
        }

        /* ุฃููููุดู ููุชุญุฐูุฑุงุช ุงูุญุฑุฌุฉ */
        @keyframes pulseWarning {
            0%, 100% { 
                opacity: 1;
                transform: scale(1);
            }
            50% { 
                opacity: 0.9;
                transform: scale(1.02);
            }
        }

        .critical-warning {
            animation: pulseWarning 2s ease-in-out infinite;
        }

        /* ุชุญุณููุงุช ุงููุตูู Accessibility */
        .btn:focus,
        .form-input:focus,
        .form-select:focus,
        .option-card:focus {
            outline: 3px solid var(--primary-color);
            outline-offset: 2px;
        }

        @media (max-width: 768px) {
            .grid-2, .grid-3, .grid-4 {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .step-grid, .checkpoint-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 1.75rem;
            }
            
            .content {
                padding: 1rem;
            }
            
            .recipe-preview {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }
            
            .preview-stats {
                width: 100%;
            }
            
            .recipe-actions {
                width: 100%;
                justify-content: space-between;
            }

            .butter-options-grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
        }

        @media (max-width: 480px) {
            .grid-4 {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .section-title {
                font-size: 1.25rem;
            }
            
            .subsection-title {
                font-size: 1.1rem;
            }
            
            .recipe-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .recipe-meta {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            
            .preview-stats {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .recipe-actions {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
        }

        @media print {
            .tabs,
            .btn,
            button,
            .notification {
                display: none !important;
            }
            
            .content {
                box-shadow: none;
                border: none;
            }
            
            .card {
                page-break-inside: avoid;
                break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="header-icon">๐ช</div>
            <div>
                <h1>ูููุฏุณ ุงูุดูุฑุช ุจุฑูุฏ ุงูุนููู - ุงููุณุฎุฉ ุงููุญุณูุฉ ูุงููุตุญุญุฉ</h1>
                <p class="header-subtitle">ุงููุฌุงุญ ูู ุงููุฑุฉ ุงูุฃููู - ูุธุงู ุฐูู ูุญุณู ูุนูู ุนูู ุฌููุน ุงูุฃุฌูุฒุฉ</p>
            </div>
        </div>
        <div class="header-info">
            <div class="info-items">
                <span>โ ุญุณุงุจุงุช ุฏูููุฉ ูุจููุฉ ุนูู 5 ุฃุจุญุงุซ ุนูููุฉ</span>
                <span>โข</span>
                <span>๐ง ุชูุตูุงุช ุฐููุฉ ุชููุงุฆูุฉ ูุญุณูุฉ</span>
                <span>โข</span>
                <span>๐ฌ ุดุฑุญ ุนููู ุฏููู ููู ุฎุทูุฉ</span>
            </div>
        </div>
    </div>

    <div class="tabs">
        <button class="tab active" data-tab="start">๐ ุงูุจุฏุงูุฉ</button>
        <button class="tab" data-tab="setup">โ๏ธ ุงูุฅุนุฏุงุฏุงุช</button>
        <button class="tab" data-tab="recipe" id="recipe-tab" disabled>๐ ุงููุตูุฉ</button>
        <button class="tab" data-tab="analyzer">๐ ูุญูู ุงููุตูุงุช</button>
        <button class="tab" data-tab="library">๐ ููุชุจุชู</button>
        <button class="tab" data-tab="checkpoints">โ ููุงุท ุงููุญุต</button>
        <button class="tab" data-tab="troubleshoot">๐ง ุงุณุชูุดุงู ุงูุฃุฎุทุงุก</button>
    </div>

    <div class="content">
        <!-- Start Screen -->
        <div id="start-screen" class="tab-content">
            <div class="text-center space-y-6">
                <div style="font-size: 4rem; margin-bottom: 1rem;">๐ช</div>
                <h2 class="section-title">ูุฑุญุจุงู ุจู ูู ุงููุฎุชุจุฑ ุงูุนููู ููุดูุฑุช ุจุฑูุฏ ุงููุญุณู</h2>
                
                <!-- ูุธุงู ุงูุฃูุถุงุน -->
                <div class="card card-blue">
                    <h3 class="subsection-title">๐ฏ ุงุฎุชุฑ ูุถุน ุงูุงุณุชุฎุฏุงู</h3>
                    <div class="mode-selector">
                        <div class="mode-btn active" data-mode="beginner" onclick="setMode('beginner')">
                            <div>๐ ุงููุจุชุฏุฆ</div>
                            <div class="mode-description">ุชูุตูุงุช ุชููุงุฆูุฉ - ูุฌุงุญ ูุถููู</div>
                        </div>
                        <div class="mode-btn" data-mode="expert" onclick="setMode('expert')">
                            <div>๐ฌ ุงูุฎุจูุฑ</div>
                            <div class="mode-description">ุชุญูู ูุงูู + ุฃุฏูุงุช ูุชูุฏูุฉ</div>
                        </div>
                    </div>
                    <div id="mode-explanation" class="mt-4">
                        <div class="card">
                            <h4>๐ ูุถุน ุงููุจุชุฏุฆ:</h4>
                            <ul class="space-y-2 mt-2">
                                <li>โ ุฅุนุฏุงุฏุงุช ูุซุงููุฉ ุชููุงุฆูุงู</li>
                                <li>โ ุชุญุฐูุฑุงุช ุฐููุฉ ุชููุน ุงูุฃุฎุทุงุก</li>
                                <li>โ ุฎุทูุงุช ูุจุณุทุฉ ููุคุชูุชุฉ</li>
                                <li>โ ุดุฑุญ ุชูุตููู ููู ุฎุทูุฉ</li>
                            </ul>
                        </div>
                        <div class="card mt-4 hidden" id="expert-explanation">
                            <h4>๐ฌ ูุถุน ุงูุฎุจูุฑ:</h4>
                            <ul class="space-y-2 mt-2">
                                <li>๐ง ุชุญูู ูุงูู ูู ุฌููุน ุงููุชุบูุฑุงุช</li>
                                <li>๐ง ุชุนุฏูู ุทุฑู ุงูุฎูุท ูุฏููุงู</li>
                                <li>๐ง ุฃุฏูุงุช ุชุญููู ุนูููุฉ ูุชูุฏูุฉ</li>
                                <li>๐ง ุชุฌุงูุฒ ุงูุชูุตูุงุช ุงูุชููุงุฆูุฉ</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- ุงูุจุฑููุงููุงุช ุงูุณุฑูุนุฉ -->
                <div class="card card-amber">
                    <h3 class="subsection-title">๐ ุงุจุฏุฃ ุจุณุฑุนุฉ</h3>
                    <div class="grid-3">
                        <div class="option-card" onclick="selectQuickProfile('tender')">
                            <div class="option-card-title">๐ฐ ุทุฑู ูุฐูุจ ูู ุงููู</div>
                            <div class="option-card-desc">ูุซู ุชูุฏ ูุงุณู - ูุงุนู ูุณูุณ</div>
                        </div>
                        <div class="option-card selected" onclick="selectQuickProfile('traditional')">
                            <div class="option-card-title">โ๏ธ ูุชูุงุฒู ุชูููุฏู</div>
                            <div class="option-card-desc">ุงูุชูุงุฒู ุงูููุงุณููู ุงููุซุงูู</div>
                        </div>
                        <div class="option-card" onclick="selectQuickProfile('crispy')">
                            <div class="option-card-title">๐ช ููุฑูุด ูุชูุดุฑ</div>
                            <div class="option-card-desc">ูุซู ุงูุจุณูููุช ุงูุงุณูุชููุฏู</div>
                        </div>
                    </div>
                </div>

                <button class="btn btn-primary" onclick="switchTab('setup')">
                    ๐ ุงุจุฏุฃ ุงูุขู - ุงุฎุชุฑ ุงูุฅุนุฏุงุฏุงุช
                </button>
            </div>
        </div>

        <!-- Setup Screen -->
        <div id="setup-screen" class="tab-content hidden">
            <div class="space-y-6">
                <h2 class="section-title">โ๏ธ ุงูุฅุนุฏุงุฏุงุช ุงูุฐููุฉ ุงููุญุณูุฉ</h2>

                <!-- ูุธุงู ุงูุชูุตูุงุช ุงูุฐููุฉ -->
                <div id="smart-recommendations-container">
                    <!-- ุณูุชู ุชุนุจุฆุชู ุจุงูุฌุงูุงุณูุฑูุจุช -->
                </div>

                <!-- ูุธุงู ุงูุฃูุถุงุน -->
                <div class="card card-purple">
                    <h3 class="subsection-title">๐๏ธ ูุถุน ุงูุชุดุบูู ุงูุญุงูู: <span id="current-mode-display">ุงููุจุชุฏุฆ</span></h3>
                    <div class="mode-selector">
                        <div class="mode-btn active" data-mode="beginner" onclick="setMode('beginner')">
                            <div>๐ ุงููุจุชุฏุฆ</div>
                            <div class="mode-description">ุชููุงุฆู ููุจุณุท</div>
                        </div>
                        <div class="mode-btn" data-mode="expert" onclick="setMode('expert')">
                            <div>๐ฌ ุงูุฎุจูุฑ</div>
                            <div class="mode-description">ุชุญูู ูุงูู</div>
                        </div>
                    </div>
                </div>

                <!-- Pan Dimensions -->
                <div class="card">
                    <h3 class="subsection-title">๐ ุฃุจุนุงุฏ ุงูุตูููุฉ</h3>
                    <div class="grid-3">
                        <div>
                            <label class="form-label">ุงูุดูู</label>
                            <select class="form-select" id="pan-shape">
                                <option value="rectangular">ูุณุชุทูู</option>
                                <option value="circular">ุฏุงุฆุฑู</option>
                            </select>
                        </div>
                        
                        <div id="rectangular-dimensions">
                            <div>
                                <label class="form-label">ุงูุทูู (ุณู)</label>
                                <input type="number" class="form-input" id="pan-length" value="30" min="10" max="50">
                            </div>
                            <div>
                                <label class="form-label">ุงูุนุฑุถ (ุณู)</label>
                                <input type="number" class="form-input" id="pan-width" value="20" min="10" max="50">
                            </div>
                        </div>
                        
                        <div id="circular-dimensions" class="hidden">
                            <div>
                                <label class="form-label">ุงููุทุฑ (ุณู)</label>
                                <input type="number" class="form-input" id="pan-diameter" value="24" min="10" max="50">
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <label class="form-label">ุงูุงุฑุชูุงุน (ุณู)</label>
                        <input type="number" step="0.1" class="form-input" id="pan-height" value="1.5" min="0.5" max="3.0">
                        <div class="form-hint">๐ก ุงููุทุงู ุงููุซุงูู: 1.0-2.0 ุณู</div>
                    </div>
                </div>

                <!-- Texture Type -->
                <div class="card card-amber">
                    <h3 class="subsection-title">๐ฏ ููุน ุงูููุงู ุงููุทููุจ</h3>
                    
                    <div class="space-y-3">
                        <div class="option-card" id="texture-tender" onclick="selectTexture('tender')">
                            <div class="option-card-title">๐ฐ ุทุฑู ูุฐูุจ ูู ุงููู</div>
                            <div class="option-card-desc">ูุงุนูุ ูุดุ ูุฐูุจ ูู ุงููู ูุซู ุจุณูููุช ุชูุฏ ูุงุณู</div>
                        </div>
                        <div class="option-card selected" id="texture-traditional" onclick="selectTexture('traditional')">
                            <div class="option-card-title">โ๏ธ ูุชูุงุฒู ุชูููุฏู</div>
                            <div class="option-card-desc">ุงูุชูุงุฒู ุงูููุงุณููู ุจูู ุงูุทุฑุงูุฉ ูุงููุฑูุดุฉ</div>
                        </div>
                        <div class="option-card" id="texture-crispy" onclick="selectTexture('crispy')">
                            <div class="option-card-title">๐ช ููุฑูุด ูุชูุดุฑ</div>
                            <div class="option-card-desc">ููุฑูุดุ ูุชูุดุฑุ ุฌุงู ูุซู ุงูุจุณูููุช ุงูุงุณูุชููุฏู ุงูุชูููุฏู</div>
                        </div>
                    </div>
                </div>

                <!-- Butter Type - ูุญุณู ูุน ุฃููุงุน ุฌุฏูุฏุฉ -->
                <div class="card card-blue">
                    <h3 class="subsection-title">๐ง ููุน ุงูุฒุจุฏุฉ ุงููุชุงุญุฉ</h3>
                    <div class="grid-4 butter-options-grid" id="butter-options">
                        <div class="option-card selected" id="butter-european" onclick="selectButter('european')">
                            <div class="option-card-title">ุฃูุฑูุจูุฉ (82-86% ุฏููู)</div>
                            <div class="text-green-700 text-sm mt-1">โญ ููุตู ุจูุง ุนูููุงู ููุฌููุน</div>
                            <span class="butter-badge badge-european">ุฃูุถู</span>
                        </div>
                        <div class="option-card" id="butter-american" onclick="selectButter('american')">
                            <div class="option-card-title">ุนุงุฏูุฉ (80% ุฏููู)</div>
                            <div class="text-amber-700 text-sm mt-1">โ๏ธ ูุฏ ุชุญุชุงุฌ ุชุนุฏููุงุช ููููุงู ุงูููุฑูุด</div>
                            <span class="butter-badge badge-american">ุฌูุฏุฉ</span>
                        </div>
                        <div class="option-card" id="butter-vegetable" onclick="selectButter('vegetable')">
                            <div class="option-card-title">ูุจุงุชูุฉ</div>
                            <div class="text-purple-700 text-sm mt-1">๐ฑ ููููุฉ ุงููุงุก - ููุงุณุจุฉ ูููุจุงุชููู</div>
                            <span class="butter-badge badge-vegetable">ูุจุงุชู</span>
                        </div>
                        <div class="option-card" id="butter-mixed" onclick="selectButter('mixed')">
                            <div class="option-card-title">ุฎููุท</div>
                            <div class="text-yellow-700 text-sm mt-1">๐ ูุฒูุฌ ูู ุงูุฒุจุฏุฉ ูุงููุงุฑุฌุฑูู</div>
                            <span class="butter-badge badge-mixed">ุฎููุท</span>
                        </div>
                    </div>
                </div>

                <!-- ูุธุงู ุงูุฎูุท (ูุธูุฑ ููุท ูู ูุถุน ุงูุฎุจูุฑ) -->
                <div id="mixing-method-section" class="card card-blue hidden">
                    <h3 class="subsection-title">๐ ูุธุงู ุงูุฎูุท ุงููุชูุฏู</h3>
                    <p class="mb-4 text-blue-800">ูู ูุถุน ุงูุฎุจูุฑุ ููููู ุชุนุฏูู ุทุฑููุฉ ุงูุฎูุท ูุฏููุงู</p>
                    
                    <div class="grid-2">
                        <div class="option-card" data-method="sablage" onclick="handleMixingMethodSelect('sablage', this)">
                            <div class="option-card-title">๐ ุทุฑููุฉ ุงููุฑู (Sablage)</div>
                            <div class="option-card-desc">ุฒุจุฏุฉ ุจุงุฑุฏุฉ ุชุฎูุท ุจุงููุฑู ููุญุตูู ุนูู ููุงู ููุฑูุด ูุชูุดุฑ</div>
                        </div>
                        <div class="option-card" data-method="creaming" onclick="handleMixingMethodSelect('creaming', this)">
                            <div class="option-card-title">๐ ุทุฑููุฉ ุงูุฎูู (Creaming)</div>
                            <div class="option-card-desc">ุฒุจุฏุฉ ุทุฑูุฉ ุชุฎูู ูุน ุงูุณูุฑ ููุญุตูู ุนูู ููุงู ุทุฑู ูุฐูุจ ูู ุงููู</div>
                        </div>
                    </div>
                    
                    <div class="mt-4 auto-settings">
                        <div class="font-semibold">๐ฏ ุงูุชูุตูุฉ ุงูุชููุงุฆูุฉ:</div>
                        <div class="text-sm text-gray-600" id="recommended-mixing-method">ุทุฑููุฉ ุงููุฑู (Sablage)</div>
                    </div>
                </div>

                <!-- ุงูุฅุนุฏุงุฏุงุช ุงูุชููุงุฆูุฉ -->
                <div class="card card-purple">
                    <h3 class="subsection-title">๐ค ุงูุฅุนุฏุงุฏุงุช ุงููุซูู ุชููุงุฆูุงู</h3>
                    <div id="auto-settings-display">
                        <!-- ุณูุชู ุชุนุจุฆุชู ุจุงูุฌุงูุงุณูุฑูุจุช -->
                    </div>
                </div>

                <!-- Additional Options -->
                <div class="card card-green">
                    <h3 class="subsection-title">โ ุฎูุงุฑุงุช ุฅุถุงููุฉ</h3>
                    
                    <div class="checkbox-group" id="rice-flour-checkbox">
                        <input type="checkbox" class="checkbox" id="use-rice-flour">
                        <div>
                            <div class="font-semibold">ุฅุถุงูุฉ ุฏููู ุฃุฑุฒ (25%)</div>
                            <div class="text-sm text-gray-600 mt-1">
                                ๐ฌ ูุฒูุฏ ุงููุฑูุดุฉ ุจูุณุจุฉ 30% - ููุตู ุจู ููููุงู ุงูููุฑูุด ููุท
                            </div>
                        </div>
                    </div>

                    <div class="checkbox-group mt-4" id="cornstarch-checkbox">
                        <input type="checkbox" class="checkbox" id="use-cornstarch">
                        <div>
                            <div class="font-semibold">ุฅุถุงูุฉ ูุดุง ุงูุฐุฑุฉ (15%)</div>
                            <div class="text-sm text-gray-600 mt-1">
                                ๐ฌ ูุญุณู ุงูุทุฑุงูุฉ - ููุตู ุจู ููููุงู ุงูุทุฑู ููุท
                            </div>
                        </div>
                    </div>
                </div>

                <button class="btn btn-success btn-full" id="calculate-recipe-btn">
                    ๐งฎ ุงุญุณุจ ุงููุตูุฉ ุงูุฏูููุฉ ูุน ุงูุชูุตูุงุช ุงููุญุณูุฉ
                </button>
            </div>
        </div>

        <!-- Recipe Screen -->
        <div id="recipe-screen" class="tab-content hidden">
            <div class="space-y-6">
                <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 1rem;">
                    <h2 class="section-title">๐ ูุตูุชู ุงููุงููุฉ ุงููุญุณูุฉ</h2>
                    <div style="display: flex; gap: 1rem;">
                        <button class="btn btn-danger" onclick="switchTab('checkpoints')">
                            โ๏ธ ููุงุท ุงููุญุต ุงูุญุฑุฌุฉ
                        </button>
                        <button class="btn btn-primary" onclick="switchTab('setup')">
                            โ๏ธ ุชุนุฏูู ุงูุฅุนุฏุงุฏุงุช
                        </button>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="grid-4">
                    <div class="stat-card">
                        <div class="stat-icon">โ๏ธ</div>
                        <div class="stat-label">ุงููุฒู</div>
                        <div class="stat-value" id="stat-weight">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">๐</div>
                        <div class="stat-label">ูุณุจุฉ ุงูุฏููู</div>
                        <div class="stat-value" id="stat-fat">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">๐ก๏ธ</div>
                        <div class="stat-label">Aw ุงููุชููุน</div>
                        <div class="stat-value" id="stat-aw">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">โฐ</div>
                        <div class="stat-label">ุงูุตูุงุญูุฉ</div>
                        <div class="stat-value" id="stat-shelf">-</div>
                    </div>
                </div>

                <!-- Save Recipe Button -->
                <div class="card card-green" id="save-recipe-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                        <div>
                            <h4 style="margin: 0;">๐พ ุญูุธ ูุฐู ุงููุตูุฉ</h4>
                            <p style="margin: 0.5rem 0 0 0; color: #666;">ุงุญูุธ ุงููุตูุฉ ูุชูููููุง ูููุงุฑูุชูุง ูุงุญูุงู</p>
                        </div>
                        <button class="btn btn-success" id="save-recipe-btn">
                            ๐พ ุญูุธ ุงููุตูุฉ
                        </button>
                    </div>
                </div>

                <!-- Ingredients -->
                <div class="card card-amber">
                    <h3 class="subsection-title">๐งช ุงูููุงุฏูุฑ ุงูุฏูููุฉ</h3>
                    <div class="grid-2" id="ingredients-list">
                        <!-- ุณูุชู ุชุนุจุฆุชู ุจุงูุฌุงูุงุณูุฑูุจุช -->
                    </div>
                </div>

                <!-- Instructions Sections -->
                <div class="space-y-4" id="instructions-container">
                    <!-- ุณูุชู ุชุนุจุฆุชู ุจุงูุฌุงูุงุณูุฑูุจุช -->
                </div>
            </div>
        </div>

        <!-- Recipe Analyzer Screen -->
        <div id="analyzer-screen" class="tab-content hidden">
            <div class="space-y-6">
                <h2 class="section-title">๐ ูุญูู ุงููุตูุงุช ุงูุนููู ุงููุชูุฏู</h2>
                
                <div class="card card-blue">
                    <h3 class="subsection-title">๐งฎ ุฃุฏุฎู ููุงุฏูุฑ ุงููุตูุฉ ูุฏููุงู</h3>
                    <p class="mb-4">ุงููุฃ ุงูุญููู ุงูุชุงููุฉ ุจุงูููุงุฏูุฑ ุงููุณุชุฎุฏูุฉ ูู ูุตูุฉ ุงูุดูุฑุช ุจุฑูุฏ ุงููุฑุงุฏ ุชุญููููุง</p>
                    
                    <div class="grid-2">
                        <!-- ุงูููููุงุช ุงูุฃุณุงุณูุฉ -->
                        <div class="space-y-4">
                            <div class="form-group">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="has-flour" onchange="toggleInput('flour')">
                                    <div>
                                        <label class="form-label">ุงูุฏููู (ุบุฑุงู)</label>
                                        <input type="number" class="form-input" id="flour" placeholder="ูููุฉ ุงูุฏููู" disabled>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="has-butter" onchange="toggleInput('butter')">
                                    <div>
                                        <label class="form-label">ุงูุฒุจุฏุฉ (ุบุฑุงู)</label>
                                        <input type="number" class="form-input" id="butter" placeholder="ูููุฉ ุงูุฒุจุฏุฉ" disabled>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="has-sugar" onchange="toggleInput('sugar')">
                                    <div>
                                        <label class="form-label">ุงูุณูุฑ (ุบุฑุงู)</label>
                                        <input type="number" class="form-input" id="sugar" placeholder="ูููุฉ ุงูุณูุฑ" disabled>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ุงูููููุงุช ุงูุฅุถุงููุฉ -->
                        <div class="space-y-4">
                            <div class="form-group">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="has-rice-flour" onchange="toggleInput('rice-flour')">
                                    <div>
                                        <label class="form-label">ุฏููู ุงูุฃุฑุฒ (ุบุฑุงู)</label>
                                        <input type="number" class="form-input" id="rice-flour" placeholder="ูููุฉ ุฏููู ุงูุฃุฑุฒ" disabled>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="has-cornstarch" onchange="toggleInput('cornstarch')">
                                    <div>
                                        <label class="form-label">ูุดุง ุงูุฐุฑุฉ (ุบุฑุงู)</label>
                                        <input type="number" class="form-input" id="cornstarch" placeholder="ูููุฉ ูุดุง ุงูุฐุฑุฉ" disabled>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="has-salt" onchange="toggleInput('salt')">
                                    <div>
                                        <label class="form-label">ุงูููุญ (ุบุฑุงู)</label>
                                        <input type="number" class="form-input" id="salt" placeholder="ูููุฉ ุงูููุญ" disabled>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ุทุฑููุฉ ุงูุฎูุท -->
                <div class="card card-purple">
                    <h3 class="subsection-title">๐ ุทุฑููุฉ ุงูุฎูุท ุงููุณุชุฎุฏูุฉ</h3>
                    <div class="grid-3">
                        <div class="option-card" onclick="selectAnalyzerMixingMethod('sablage', this)">
                            <div class="option-card-title">๐ ุทุฑููุฉ ุงููุฑู (Sablage)</div>
                            <div class="option-card-desc">ุฒุจุฏุฉ ุจุงุฑุฏุฉ ุชุฎูุท ุจุงููุฑู</div>
                        </div>
                        <div class="option-card" onclick="selectAnalyzerMixingMethod('creaming', this)">
                            <div class="option-card-title">๐ ุทุฑููุฉ ุงูุฎูู (Creaming)</div>
                            <div class="option-card-desc">ุฒุจุฏุฉ ุทุฑูุฉ ุชุฎูู ูุน ุงูุณูุฑ</div>
                        </div>
                        <div class="option-card" onclick="selectAnalyzerMixingMethod('unknown', this)">
                            <div class="option-card-title">โ ุบูุฑ ูุนุฑูู</div>
                            <div class="option-card-desc">ูู ูุชู ุชุญุฏูุฏ ุงูุทุฑููุฉ</div>
                        </div>
                    </div>
                </div>

                <!-- ุฅุนุฏุงุฏุงุช ุงูุฎุจุฒ -->
                <div class="card card-amber">
                    <h3 class="subsection-title">๐ฅ ุฅุนุฏุงุฏุงุช ุงูุฎุจุฒ</h3>
                    <div class="grid-2">
                        <div class="form-group">
                            <label class="form-label">ุฏุฑุฌุฉ ุญุฑุงุฑุฉ ุงูุฎุจุฒ (ยฐู)</label>
                            <input type="number" class="form-input" id="baking-temp" placeholder="ูุซุงู: 160">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ูุฏุฉ ุงูุฎุจุฒ (ุฏูููุฉ)</label>
                            <input type="number" class="form-input" id="baking-time" placeholder="ูุซุงู: 25">
                        </div>
                    </div>
                </div>

                <!-- ููุน ุงูุฒุจุฏุฉ -->
                <div class="card card-green">
                    <h3 class="subsection-title">๐ง ููุน ุงูุฒุจุฏุฉ ุงููุณุชุฎุฏู</h3>
                    <div class="grid-4">
                        <div class="option-card" onclick="selectAnalyzerButterType('european', this)">
                            <div class="option-card-title">ุฃูุฑูุจูุฉ (82-86%)</div>
                        </div>
                        <div class="option-card" onclick="selectAnalyzerButterType('american', this)">
                            <div class="option-card-title">ุฃูุฑูููุฉ (80%)</div>
                        </div>
                        <div class="option-card" onclick="selectAnalyzerButterType('vegetable', this)">
                            <div class="option-card-title">ูุจุงุชูุฉ</div>
                        </div>
                        <div class="option-card" onclick="selectAnalyzerButterType('unknown', this)">
                            <div class="option-card-title">โ ุบูุฑ ูุนุฑูู</div>
                        </div>
                    </div>
                </div>

                <!-- ููุน ุงูุณูุฑ -->
                <div class="card card-blue">
                    <h3 class="subsection-title">๐ฌ ููุน ุงูุณูุฑ ุงููุณุชุฎุฏู</h3>
                    <div class="grid-3">
                        <div class="option-card" onclick="selectAnalyzerSugarType('granulated', this)">
                            <div class="option-card-title">ุณูุฑ ูุญุจุจ</div>
                        </div>
                        <div class="option-card" onclick="selectAnalyzerSugarType('powdered', this)">
                            <div class="option-card-title">ุณูุฑ ุจูุฏุฑุฉ</div>
                        </div>
                        <div class="option-card" onclick="selectAnalyzerSugarType('unknown', this)">
                            <div class="option-card-title">โ ุบูุฑ ูุนุฑูู</div>
                        </div>
                    </div>
                </div>

                <!-- ุฎูุงุฑุงุช ุฅุถุงููุฉ -->
                <div class="card card-red">
                    <h3 class="subsection-title">โก ุชูููุงุช ุฅุถุงููุฉ ูุณุชุฎุฏูุฉ</h3>
                    <div class="grid-2">
                        <div class="checkbox-group">
                            <input type="checkbox" id="has-chilling">
                            <div>
                                <div class="font-semibold">ุงูุชุจุฑูุฏ ูุจู ุงูุฎุจุฒ</div>
                                <div class="text-sm text-gray-600 mt-1">ุชุจุฑูุฏ ุงูุนุฌูู ูุจู ุงูุฎุจุฒ ููุฏุฉ ุณุงุนุฉ ุนูู ุงูุฃูู</div>
                            </div>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="has-docking">
                            <div>
                                <div class="font-semibold">ุงูุชุฎุฑูู (Docking)</div>
                                <div class="text-sm text-gray-600 mt-1">ุชุฎุฑูู ุณุทุญ ุงูุนุฌูู ุจุงูุดููุฉ ูุจู ุงูุฎุจุฒ</div>
                            </div>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="has-twice-baked">
                            <div>
                                <div class="font-semibold">ุงูุฎุจุฒ ุงููุฒุฏูุฌ</div>
                                <div class="text-sm text-gray-600 mt-1">ุชูููุฉ ุงูุฎุจุฒ ูุฑุชูู ููุญุตูู ุนูู ูุฑูุดุฉ ุงุณุชุซูุงุฆูุฉ</div>
                            </div>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="has-vanilla">
                            <div>
                                <div class="font-semibold">ุฅุถุงูุฉ ุงููุงููููุง</div>
                                <div class="text-sm text-gray-600 mt-1">ุฅุถุงูุฉ ุฎูุงุตุฉ ุงููุงููููุง ูููููุฉ</div>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="btn btn-primary btn-full" onclick="analyzeManualRecipe()">
                    ๐ ุญูู ุงููุตูุฉ ุนูููุงู
                </button>

                <!-- ูุชุงุฆุฌ ุงูุชุญููู -->
                <div id="manual-analysis-results" class="hidden">
                    <!-- ุณูุชู ุชุนุจุฆุชู ุจุงูุฌุงูุงุณูุฑูุจุช -->
                </div>

                <!-- ูุตูุงุช ูููุฐุฌูุฉ ููุงุฎุชุจุงุฑ -->
                <div class="card card-green">
                    <h3 class="subsection-title">๐งช ูุตูุงุช ูููุฐุฌูุฉ ููุงุฎุชุจุงุฑ</h3>
                    <div class="grid-3">
                        <div class="option-card" onclick="loadSampleRecipe('ted-lasso')">
                            <div class="option-card-title">๐ช ุจุณูููุช ุชูุฏ ูุงุณู</div>
                            <div class="option-card-desc">ูุตูุฉ ุทุฑูุฉ ุชุฐูุจ ูู ุงููู</div>
                        </div>
                        <div class="option-card" onclick="loadSampleRecipe('traditional')">
                            <div class="option-card-title">โ๏ธ ุชูููุฏู ูุชูุงุฒู</div>
                            <div class="option-card-desc">ูุตูุฉ ููุงุณูููุฉ ูุชูุงุฒูุฉ</div>
                        </div>
                        <div class="option-card" onclick="loadSampleRecipe('crispy')">
                            <div class="option-card-title">๐ฅ ููุฑูุด ูุชูุดุฑ</div>
                            <div class="option-card-desc">ูุตูุฉ ููุฑูุดุฉ ูุน ุฏููู ุงูุฃุฑุฒ</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Library Screen -->
        <div id="library-screen" class="tab-content hidden">
            <div class="space-y-6">
                <div class="library-header" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                    <h2 class="section-title">๐ ููุชุจุฉ ูุตูุงุชู</h2>
                    <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                        <div class="stat-card">
                            <div class="stat-value" id="library-count">0</div>
                            <div class="stat-label">ูุตูุฉ ูุญููุธุฉ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="success-rate">0%</div>
                            <div class="stat-label">ูุนุฏู ุงููุฌุงุญ</div>
                        </div>
                        <button class="btn" id="export-all-btn" style="background: var(--secondary-color); color: white;">
                            ๐ค ุชุตุฏูุฑ ุงููู
                        </button>
                    </div>
                </div>

                <div id="recipe-grid" class="recipe-grid">
                    <!-- ุณูุชู ุชุนุจุฆุชู ุจุงูุฌุงูุงุณูุฑูุจุช -->
                </div>

                <div id="empty-library" class="text-center hidden">
                    <div style="font-size: 4rem; margin-bottom: 1rem;">๐</div>
                    <h3>ูุง ุชูุฌุฏ ูุตูุงุช ูุญููุธุฉ ุจุนุฏ</h3>
                    <p>ุงุญูุธ ูุตูุงุชู ุงูุฃููู ูุชุธูุฑ ููุง</p>
                    <button class="btn btn-primary mt-4" onclick="switchTab('setup')">
                        ๐ ุฅูุดุงุก ูุตูุฉ ุฌุฏูุฏุฉ
                    </button>
                </div>
            </div>
        </div>

        <!-- Checkpoints Screen -->
        <div id="checkpoints-screen" class="tab-content hidden">
            <div class="space-y-6">
                <div class="card card-red">
                    <h2 class="section-title">โ ููุงุท ุงููุญุต ุงูุญุฑุฌุฉ ุงููุญุณูุฉ - ุทุฑููู ูููุฌุงุญ ุงููุถููู</h2>
                    <p class="text-red-800">
                        ูุฐู ุงูููุงุท ุงูู8 ูู ุงููุฑู ุจูู ุงููุฌุงุญ ูุงููุดู. ุงูุญุต ูู ูุงุญุฏุฉ ูู ููุชูุง ุงููุญุฏุฏ.
                    </p>
                    <div class="mt-4 bg-white p-4 rounded-lg">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="font-size: 2.5rem;" id="completed-count">0/8</div>
                            <div>
                                <div class="font-bold">ููุงุท ููุชููุฉ</div>
                                <div class="text-sm text-gray-600">ุงุณุชูุฑ - ุฃูุช ุนูู ุงูุทุฑูู ุงูุตุญูุญ!</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="space-y-4" id="checkpoints-list">
                    <!-- ุณูุชู ุชุนุจุฆุชู ุจุงูุฌุงูุงุณูุฑูุจุช -->
                </div>
            </div>
        </div>

        <!-- Troubleshoot Screen -->
        <div id="troubleshoot-screen" class="tab-content hidden">
            <div class="space-y-6">
                <div class="card card-red">
                    <h2 class="section-title">๐ง ุงุณุชูุดุงู ุงูุฃุฎุทุงุก ุงููุญุณู - ุฏููู ุงูุฅููุงุฐ ุงูููุฑู</h2>
                    <p class="text-red-800">
                        ุญุฏุซ ุฎุทุฃ ูุงุ ูุง ุชููู. ูุฐุง ุงูุฏููู ุงููุญุณู ุณูุณุงุนุฏู ุนูู ููู ุงููุดููุฉ ูุญููุง - ุณูุงุก ูุจู ุงูุฎุจุฒุ ุฃุซูุงุกูุ ุฃู ุจุนุฏู.
                    </p>
                </div>

                <div class="space-y-4" id="troubleshoot-list">
                    <!-- ุณูุชู ุชุนุจุฆุชู ุจุงูุฌุงูุงุณูุฑูุจุช -->
                </div>

                <!-- Prevention Guide -->
                <div class="card card-green">
                    <h3 class="subsection-title">๐ก๏ธ ุงููุงุนุฏุฉ ุงูุฐูุจูุฉ ููููุงูุฉ ุงููุญุณูุฉ</h3>
                    <div class="grid-3">
                        <div class="card">
                            <div style="display: flex; align-items: flex-start; gap: 0.75rem; margin-bottom: 0.75rem;">
                                <div style="width: 2.5rem; height: 2.5rem; background: var(--secondary-color); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.125rem; flex-shrink: 0;">1</div>
                                <div style="font-size: 2rem;">๐ก๏ธ</div>
                            </div>
                            <h4 class="font-bold text-green-900 mb-2">ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ ุงูููุงุณุจุฉ</h4>
                            <p class="text-green-800 text-sm">ุงุฎุชุฑ ุฏุฑุฌุฉ ุญุฑุงุฑุฉ ุงูุฒุจุฏุฉ ุงูููุงุณุจุฉ ูุทุฑููุฉ ุงูุฎูุท ุงููุฎุชุงุฑุฉ ูููุน ุงูุฒุจุฏุฉ</p>
                        </div>
                        <div class="card">
                            <div style="display: flex; align-items: flex-start; gap: 0.75rem; margin-bottom: 0.75rem;">
                                <div style="width: 2.5rem; height: 2.5rem; background: var(--secondary-color); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.125rem; flex-shrink: 0;">2</div>
                                <div style="font-size: 2rem;">โฑ๏ธ</div>
                            </div>
                            <h4 class="font-bold text-green-900 mb-2">ุงูููุช ุงูููุงุณุจ</h4>
                            <p class="text-green-800 text-sm">ุงูุชุฒู ุจุงูููุช ุงููุญุฏุฏ ููู ุทุฑููุฉ ุฎูุท ููุง ุชุจุงูุบ ูุน ูุฑุงุนุงุฉ ููุน ุงูุฒุจุฏุฉ</p>
                        </div>
                        <div class="card">
                            <div style="display: flex; align-items: flex-start; gap: 0.75rem; margin-bottom: 0.75rem;">
                                <div style="width: 2.5rem; height: 2.5rem; background: var(--secondary-color); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.125rem; flex-shrink: 0;">3</div>
                                <div style="font-size: 2rem;">โ</div>
                            </div>
                            <h4 class="font-bold text-green-900 mb-2">ุงูุญุต ุจุงุณุชูุฑุงุฑ</h4>
                            <p class="text-green-800 text-sm">ุนูุฏ ูู ููุทุฉ ูุญุต - ุชููู ูุงุฎุชุจุฑ. ุงูููุงูุฉ ุฃูุถู ูู ุงูุนูุงุฌ.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // =============================================
        // ุงููุธุงู ุงูุฃุณุงุณู ุงููุญุณู - State Management
        // =============================================

        class AppState {
            constructor() {
                this.state = {
                    // ูุถุน ุงููุณุชุฎุฏู
                    mode: 'beginner', // 'beginner' or 'expert'
                    
                    // ุงูุฅุนุฏุงุฏุงุช ุงูุฃุณุงุณูุฉ
                    panShape: 'rectangular',
                    dimensions: { length: 30, width: 20, diameter: 24 },
                    height: 1.5,
                    textureType: 'traditional',
                    butterType: 'european',
                    mixingMethod: 'sablage',
                    
                    // ุงูุฅุนุฏุงุฏุงุช ุงููุชูุฏูุฉ (ูููุถุน ุงูุฎุจูุฑ)
                    useRiceFlour: false,
                    useCornstarch: false,
                    
                    // ุงููุชุงุฆุฌ
                    currentRecipe: null,
                    completedCheckpoints: []
                };
                
                this.subscribers = new Set();
            }
            
            get(key) {
                return key.split('.').reduce((obj, i) => obj?.[i], this.state);
            }
            
            set(key, value) {
                const keys = key.split('.');
                const lastKey = keys.pop();
                const target = keys.reduce((obj, i) => obj[i], this.state);
                target[lastKey] = value;
                this.notify(key, value);
            }
            
            subscribe(callback) {
                this.subscribers.add(callback);
            }
            
            notify(key, value) {
                this.subscribers.forEach(callback => callback(key, value));
            }
            
            // ุชุญุฏูุซ ุดุงูู ููุญุงูุฉ
            update(newState) {
                this.state = { ...this.state, ...newState };
                this.notify('all', this.state);
            }
        }

        // =============================================
        // ุงููุญุฑูุงุช ุงูุนูููุฉ ุงููุญุณูุฉ
        // =============================================

        class ScientificData {
            static get PROFILES() {
                return {
                    'tender': {
                        name: 'ุทุฑู ูุฐูุจ ูู ุงููู',
                        description: 'ูุงุนูุ ูุดุ ูุฐูุจ ูู ุงููู ูุซู ุจุณูููุช ุชูุฏ ูุงุณู',
                        mixingMethod: 'creaming',
                        sugarType: 'powdered',
                        additive: { type: 'cornstarch', ratio: 0.12 },
                        recommendedButter: 'european',
                        ratio: [1, 2, 3],
                        density: 0.58,
                        bakingTemp: 149,
                        bakingTime: '50-70 ุฏูููุฉ',
                        butterTemp: '21-22ยฐู',
                        expectedAw: '0.40-0.50',
                        shelfLife: '7-14 ููู',
                        specialInstructions: [
                            'ุงุณุชุฎุฏู ุงูุณูุฑ ุงูุจูุฏุฑุฉ ูุชุญููู ุงููุนููุฉ ุงููุตูู',
                            'ูุดุง ุงูุฐุฑุฉ ูุญุณู ุงููููุณ ุงูุฑููู',
                            'ุงูุฎูู ุงููุนุชุฏู ููุฏุฉ 3-4 ุฏูุงุฆู',
                            'ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ ุงูููุฎูุถุฉ ุชุญุงูุธ ุนูู ุงูุทุฑุงูุฉ'
                        ]
                    },
                    'traditional': {
                        name: 'ูุชูุงุฒู ุชูููุฏู', 
                        description: 'ุงูุชูุงุฒู ุงูููุงุณููู ุจูู ุงูุทุฑุงูุฉ ูุงููุฑูุดุฉ',
                        mixingMethod: 'sablage',
                        sugarType: 'granulated',
                        additive: { type: 'none', ratio: 0 },
                        recommendedButter: 'european',
                        ratio: [1, 2, 3],
                        density: 0.62,
                        bakingTemp: 160,
                        bakingTime: '25-35 ุฏูููุฉ',
                        butterTemp: '4-7ยฐู',
                        expectedAw: '0.35-0.45',
                        shelfLife: '14-21 ููู',
                        specialInstructions: [
                            'ุงููุฑู ุญุชู ูุตุจุญ ุงูุฎููุท ูุซู ุงูุฑูู ุงููุงุนู',
                            'ูุทุน ุงูุฒุจุฏุฉ ูุฌุจ ุฃู ุชููู ุจุญุฌู ุญุจุงุช ุงูุจุงุฒูุงุก',
                            'ุงูุชุจุฑูุฏ ููุฏุฉ ุณุงุนุชูู ุนูู ุงูุฃูู',
                            'ุงูุญุฑุงุฑุฉ ุงููุชูุณุทุฉ ุชุญูู ุงูุชูุงุฒู ุงููุทููุจ'
                        ]
                    },
                    'crispy': {
                        name: 'ููุฑูุด ูุชูุดุฑ',
                        description: 'ููุฑูุดุ ูุชูุดุฑุ ุฌุงู ูุซู ุงูุจุณูููุช ุงูุงุณูุชููุฏู ุงูุชูููุฏู',
                        mixingMethod: 'sablage',
                        sugarType: 'granulated',
                        additive: { type: 'riceFlour', ratio: 0.25 },
                        recommendedButter: 'european',
                        ratio: [1, 2, 3],
                        density: 0.62,
                        bakingTemp: 177,
                        bakingTime: '35 ุฏูููุฉ (ุงููุฑุญูุฉ ุงูุฃููู)',
                        twiceBaked: {
                            enabled: true,
                            firstBakeTemp: 177,
                            firstBakeDuration: '35 ุฏูููุฉ',
                            coolingDuration: '10 ุฏูุงุฆู',
                            secondBakeMethod: 'residual heat',
                            secondBakeDuration: '30-45 ุฏูููุฉ',
                            ovenState: 'off',
                            scientificBasis: 'ุฅุฒุงูุฉ ุงูุฑุทูุจุฉ ุงูุชุฏุฑูุฌูุฉ ูุชุญููู Aw < 0.35 ุฏูู ุชุญููุต ุฅุถุงูู'
                        },
                        butterTemp: '4-7ยฐู',
                        expectedAw: '0.20-0.30',
                        shelfLife: '30-45 ููู',
                        specialInstructions: [
                            'ุฏููู ุงูุฃุฑุฒ (25%) ูุฒูุฏ ุงููุฑูุดุฉ ุจูุณุจุฉ 30%',
                            'ุงููุฑู ุญุชู ูุตุจุญ ุฎุดู ูุซู ุญุจุงุช ุงูุฐุฑุฉ',
                            'ุงูุชุจุฑูุฏ ุทูุงู ุงูููู ููุญุตูู ุนูู ุฃูุถู ูุฑูุดุฉ',
                            'ุงูุญุฑุงุฑุฉ ุงูุนุงููุฉ ุชุญูู ุงููุฑูุดุฉ ุงููุทููุจุฉ',
                            'โญ ุชูููุฉ ุงูุฎุจุฒ ุงููุฒุฏูุฌ ุฅูุฒุงููุฉ ููุญุตูู ุนูู ุงููุชุงุฆุฌ ุงููุซุงููุฉ'
                        ]
                    }
                };
            }
            
            static get BUTTER_TYPES() {
                return {
                    'european': {
                        name: 'ุฃูุฑูุจูุฉ',
                        fatContent: 0.82,
                        waterContent: 0.16,
                        description: '82-86% ุฏููู - ูุซุงููุฉ ููููุงู ุงููุซุงูู',
                        color: '#dcfce7',
                        textColor: '#166534'
                    },
                    'american': {
                        name: 'ุฃูุฑูููุฉ', 
                        fatContent: 0.80,
                        waterContent: 0.18,
                        description: '80% ุฏููู - ุฌูุฏุฉ ูุน ุชุนุฏููุงุช ุจุณูุทุฉ',
                        color: '#dbeafe',
                        textColor: '#1e40af'
                    },
                    'vegetable': {
                        name: 'ูุจุงุชูุฉ',
                        fatContent: 0.85, 
                        waterContent: 0.02,
                        description: 'ููููุฉ ุงููุงุก - ููุงุณุจุฉ ูููุจุงุชููู',
                        color: '#f3e8ff',
                        textColor: '#7e22ce'
                    },
                    'mixed': {
                        name: 'ุฎููุท',
                        fatContent: 0.78,
                        waterContent: 0.15,
                        description: 'ูุฒูุฌ ูู ุงูุฒุจุฏุฉ ูุงููุงุฑุฌุฑูู',
                        color: '#fef3c7',
                        textColor: '#d97706'
                    }
                };
            }
            
            static get MIXING_METHODS() {
                return {
                    'sablage': {
                        name: 'ุทุฑููุฉ ุงููุฑู',
                        description: 'ุฒุจุฏุฉ ุจุงุฑุฏุฉ ุชุฎูุท ุจุงููุฑู ููุญุตูู ุนูู ููุงู ููุฑูุด ูุชูุดุฑ',
                        butterTemp: '4-7ยฐู',
                        texture: 'ููุฑูุด ูุชูุดุฑ',
                        scientificBasis: 'ูุทุน ุงูุฒุจุฏุฉ ุงูุจุงุฑุฏุฉ ุชุฎูู ุทุจูุงุช ูุชูุดุฑุฉ ุนูุฏ ุงูุฎุจุฒ',
                        densityAdjustment: 1.02
                    },
                    'creaming': {
                        name: 'ุทุฑููุฉ ุงูุฎูู',
                        description: 'ุฒุจุฏุฉ ุทุฑูุฉ ุชุฎูู ูุน ุงูุณูุฑ ููุญุตูู ุนูู ููุงู ุทุฑู ูุฐูุจ ูู ุงููู',
                        butterTemp: '21-22ยฐู',
                        texture: 'ุทุฑู ูุฐูุจ ูู ุงููู',
                        scientificBasis: 'ุงูููุงุก ุงููุญุจูุณ ุฃุซูุงุก ุงูุฎูู ูุฎูู ููุงูุงู ุฃุฎู ูุฃูุซุฑ ุทุฑุงูุฉ',
                        densityAdjustment: 0.95
                    }
                };
            }
            
            static get ENHANCED_CHECKPOINTS() {
                return [
                    {
                        timing: 'ูุจู ุงูุจุฏุก',
                        check: 'ุฌูุฏุฉ ููุซุงูุฉ ุงูุฒุจุฏุฉ',
                        target: 'ุฒุจุฏุฉ ูุจุฑุฏุฉ ุญุณุจ ุงูููุน ุงููุฎุชุงุฑ',
                        test: 'ุงูุญุต ุชุงุฑูุฎ ุงูุตูุงุญูุฉ ูุงููููุณ',
                        whyItMatters: 'ุงูุฒุจุฏุฉ ุงููุงุณุฏุฉ ุฃู ุงููุฎุฒูุฉ improperly ุชูุณุฏ ุงูุนุฌูู',
                        fix: 'ุงุณุชุฎุฏู ุฒุจุฏุฉ ุทุงุฒุฌุฉ ููุฎุฒูุฉ ุจุดูู ุตุญูุญ'
                    },
                    {
                        timing: 'ูุจู ุงูุจุฏุก',
                        check: 'ุฏุฑุฌุฉ ุญุฑุงุฑุฉ ุงูุฒุจุฏุฉ',
                        target: '{butterTemp}',
                        test: 'ุงูุญุต ุญุณุจ ุงูุทุฑููุฉ ุงููุฎุชุงุฑุฉ',
                        whyItMatters: 'ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ ุงูุฎุงุทุฆุฉ ุชุนุทู ููุงูุงู ุบูุฑ ูุฑุบูุจ',
                        fix: 'ุงุถุจุท ุงูุญุฑุงุฑุฉ ุญุณุจ ุทุฑููุฉ ุงูุฎูุท'
                    },
                    {
                        timing: 'ุฃุซูุงุก ุงูุฎูุท',
                        check: 'ุชูุฒูุน ุงูุฏููู ูู ุงูุนุฌูู',
                        target: 'ุชูุฒูุน ูุชุฌุงูุณ ุจุฏูู ุชูููู ุบููุชูู',
                        test: 'ุงูุญุต ูููุณ ุงูุนุฌูู - ูุฌุจ ุฃู ูููู ุฑูููุงู',
                        whyItMatters: 'ุงูุชูุฒูุน ุบูุฑ ุงููุชุฌุงูุณ ูุคุฏู ุฅูู ููุงู ุบูุฑ ูุชุณู',
                        fix: 'ุงุฎูุท ููุฏุฉ ุฃุทูู ุฃู ุฃูู ุญุณุจ ุงูุญุงุฌุฉ'
                    },
                    {
                        timing: 'ุจุนุฏ ุงูุฎูุท',
                        check: 'ููุงู ุงูุนุฌูู',
                        target: 'ูุชูุงุณู ูููู ุบูุฑ ูุฒุฌ',
                        test: 'ุงุถุบุท ูุฑุฉ ุตุบูุฑุฉ - ูุฌุจ ุฃู ุชุชูุงุณู ุจุฏูู ูุฒูุฌุฉ',
                        whyItMatters: 'ุงูุนุฌูู ุงููุฒุฌ ูุนูู ุฒุจุฏุฉ ุฏุงูุฆุฉ ุฌุฏุงู',
                        fix: 'ุจุฑุฏ ุงูุนุฌูู 15 ุฏูููุฉ ุฅุถุงููุฉ'
                    },
                    {
                        timing: 'ุจุนุฏ ุงูุชุดููู',
                        check: 'ุณูู ุงูุนุฌูู',
                        target: '1.0-2.0 ุณู',
                        test: 'ุงุณุชุฎุฏู ูุณุทุฑุฉ ููุชุญูู ูู ุงูุณูู',
                        whyItMatters: 'ุงูุณูู ุบูุฑ ุงูููุชุธู ูุคุฏู ุฅูู ุฎุจุฒ ุบูุฑ ูุชุณุงู',
                        fix: 'ุนุฏู ุงูุณูู ูุจู ุงูุฎุจุฒ'
                    },
                    {
                        timing: 'ูุจู ุงูุฎุจุฒ',
                        check: 'ุซูุจ ุงูุณุทุญ',
                        target: 'ุซููุจ ูุชุณุงููุฉ ูููุชุธูุฉ',
                        test: 'ุชุฃูุฏ ูู ุชุบุทูุฉ ุงูุณุทุญ ูุงููุงู ุจุงูุซููุจ',
                        whyItMatters: 'ูููุน ุงูุชูุงุฎ ุงูุนุฌูู ุฃุซูุงุก ุงูุฎุจุฒ',
                        fix: 'ุฃุนุฏ ุซูุจ ุงูููุงุทู ุบูุฑ ุงููุซููุจุฉ'
                    },
                    {
                        timing: 'ุฃุซูุงุก ุงูุฎุจุฒ (15 ุฏูููุฉ)',
                        check: 'ููู ุงูุญูุงู',
                        target: 'ุฐูุจู ูุงุชุญ ุฌุฏุงู',
                        test: 'ุงูุญุต ุญูุงู ุงูุตูููุฉ',
                        whyItMatters: 'ูุฏู ุนูู ูุถุฌ ูุชุณุงูู',
                        fix: 'ุฏูุฑ ุงูุตูููุฉ ุฅุฐุง ูุฒู ุงูุฃูุฑ'
                    },
                    {
                        timing: 'ุจุนุฏ ุงูุฎุจุฒ',
                        check: 'ุงูุชุจุฑูุฏ ุงููุงูู',
                        target: 'ูุจุฑุฏ ุชูุงูุงู ูุจู ุงูุชูุทูุน',
                        test: 'ุงููุณ ุงููุฑูุฒ - ูุฌุจ ุฃู ูููู ุจุงุฑุฏุงู',
                        whyItMatters: 'ุงูุชูุทูุน ุงูุณุงุฎู ูุคุฏู ุฅูู ุชูุณุฑ',
                        fix: 'ุงูุชุธุฑ ุญุชู ูุจุฑุฏ ุชูุงูุงู'
                    }
                ];
            }
        }

        class RecipeEngine {
            constructor() {
                this.data = ScientificData;
            }
            
            calculateRecipe(state) {
                const profile = this.data.PROFILES[state.textureType];
                const effectiveState = this.applyRecommendations(state, profile);
                
                // ุงูุญุณุงุจุงุช ุงูุฃุณุงุณูุฉ
                const area = this.calculateArea(effectiveState.panShape, effectiveState.dimensions);
                const volume = area * effectiveState.height;
                const dynamicDensity = this.calculateDynamicDensity(effectiveState);
                const weight = volume * dynamicDensity;
                
                // ุงุณุชุฎุฏุงู ุงููุณุจ ูู ุงูุจุฑููุงูู
                const ratio = profile.ratio;
                const total = ratio.reduce((sum, val) => sum + val, 0);
                const unit = weight / total;
                
                let flour = Math.round(unit * ratio[2]);
                const butter = Math.round(unit * ratio[1]);
                const sugar = Math.round(unit * ratio[0]);
                
                // ุฅุฏุงุฑุฉ ุงููุถุงูุงุช
                const additives = {};
                if (profile.additive.type !== 'none') {
                    const additiveAmount = Math.round(flour * profile.additive.ratio);
                    additives[this.getAdditiveName(profile.additive.type)] = additiveAmount;
                    flour -= additiveAmount;
                }
                
                const salt = Math.round(flour * 0.01 * 10) / 10;
                
                // ุญุณุงุจ Aw ุงููุนูู ุงููุญุณู
                const awAnalysis = this.calculateWaterActivity(
                    { flour, butter, sugar }, 
                    effectiveState.butterType, 
                    profile.bakingTemp,
                    profile.twiceBaked?.enabled || false
                );
                
                const recipe = {
                    ingredients: { flour, butter, sugar, salt, additives },
                    profile: profile,
                    analysis: {
                        area: Math.round(area),
                        volume: Math.round(volume),
                        weight: Math.round(weight),
                        finalHeight: this.calculateFinalHeight(effectiveState),
                        density: dynamicDensity,
                        fatPercent: ((butter / weight) * 100).toFixed(1),
                        expectedAw: awAnalysis.value,
                        category: awAnalysis.category,
                        shelfLife: awAnalysis.shelfLife,
                        recommendedButterTemp: profile.butterTemp,
                        optimalBaking: `${profile.bakingTemp}ยฐู ููุฏุฉ ${profile.bakingTime}`
                    },
                    instructions: this.generateInstructions(profile, effectiveState),
                    recommendations: this.generateRecommendations(effectiveState, profile),
                    scientificReport: this.generateScientificReport({ flour, butter, sugar }, effectiveState, profile)
                };
                
                return recipe;
            }
            
            applyRecommendations(state, profile) {
                if (state.mode === 'beginner') {
                    // ูู ูุถุน ุงููุจุชุฏุฆุ ูุทุจู ุงูุชูุตูุงุช ุชููุงุฆูุงู
                    return {
                        ...state,
                        mixingMethod: profile.mixingMethod,
                        useRiceFlour: profile.additive.type === 'riceFlour',
                        useCornstarch: profile.additive.type === 'cornstarch',
                        butterType: profile.recommendedButter || 'european'
                    };
                } else {
                    // ูู ูุถุน ุงูุฎุจูุฑุ ูุญุชุฑู ุงุฎุชูุงุฑุงุช ุงููุณุชุฎุฏู ูุน ุจุนุถ ุงูุชูุตูุงุช
                    return {
                        ...state,
                        mixingMethod: state.mixingMethod || profile.mixingMethod
                    };
                }
            }
            
            // โ ุชุตุญูุญ ุญุณุงุจ Aw
            calculateWaterActivity(ingredients, butterType, bakingTemp, useTwiceBaked, textureType) {
                const baseValues = {
                    'tender': { 
                        baseAw: 0.48,      // โ ูุงู 0.48 ุตุญูุญ
                        sugarBinding: 0.40,
                        starchBinding: 0.45 
                    },
                    'traditional': { 
                        baseAw: 0.38,      // โ ูุงู 0.38 ุตุญูุญ
                        sugarBinding: 0.33,
                        starchBinding: 0.35 
                    },
                    'crispy': { 
                        baseAw: 0.28,      // โ ูุงู 0.28 ุตุญูุญ - ููู ูุฌุจ ุงุณุชุฎุฏุงูู!
                        sugarBinding: 0.25,
                        starchBinding: 0.25 
                    }
                };
                
                const base = baseValues[textureType] || baseValues['traditional'];
                let awValue = base.baseAw;
                
                // โ๏ธ ุงููุดููุฉ: ุงูุชุนุฏููุงุช ุชุทุบู ุนูู ุงูููู ุงูุฃุณุงุณูุฉ
                // ุงูุญู: ุชูููู ุชุฃุซูุฑ ุงูุชุนุฏููุงุช
                
                // ุชุฃุซูุฑ ุทุฑููุฉ ุงูุฎูุท (ูุฎูุถ)
                if (this.state && this.state.mixingMethod === 'creaming') {
                    awValue += 0.02;  // โ ูุงู 0.04 - ูุจุงูุบ ููู
                } else if (this.state && this.state.mixingMethod === 'sablage') {
                    awValue -= 0.02;  // โ ูุงู 0.03
                }
                
                // ุชุฃุซูุฑ ุงููุถุงูุงุช
                if (this.state && this.state.useCornstarch) {
                    awValue += 0.02;  // โ ูุงู 0.03
                } else if (this.state && this.state.useRiceFlour) {
                    awValue -= 0.03;  // โ ูุงู 0.05
                }
                
                // ุชุฃุซูุฑ ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ
                if (bakingTemp >= 170) {
                    awValue -= 0.05;  // โ ูุงู 0.08 - ูุจุงูุบ
                } else if (bakingTemp <= 150) {
                    awValue += 0.03;  // โ ูุงู 0.05
                }
                
                // โญ ุชุฃุซูุฑ ุงูุฎุจุฒ ุงููุฒุฏูุฌ - ุญุงุณู ููููุงู ุงูููุฑูุด
                if (useTwiceBaked) {
                    if (textureType === 'crispy') {
                        awValue -= 0.10;  // โ ูุงู 0.12 - ูุนููู ููู ุฏุนูุง ูุญุงูุธ ุนูู 0.10
                    } else {
                        awValue -= 0.04;  // โ ูุงู 0.06
                    }
                }
                
                // โ ุญุฏูุฏ ูุงูุนูุฉ ูุญุณููุฉ
                if (textureType === 'tender') {
                    awValue = Math.min(0.52, Math.max(0.42, awValue));  // 0.42-0.52
                } else if (textureType === 'crispy') {
                    awValue = Math.min(0.35, Math.max(0.22, awValue));  // 0.22-0.35 โญ
                } else {
                    awValue = Math.min(0.43, Math.max(0.35, awValue));  // 0.35-0.43
                }
                
                // โ ุชุตููู ูุญุณูู
                let category, shelfLife;
                if (awValue < 0.28) {
                    category = 'ุฌุงู ุฌุฏุงู';
                    shelfLife = '45-60 ููู';
                } else if (awValue < 0.35) {
                    category = 'ููุฑูุด ูุฌุงู';  // โญ ูุฐุง ููููุฑูุด
                    shelfLife = '30-45 ููู';
                } else if (awValue < 0.40) {
                    category = 'ููุฑูุด';
                    shelfLife = '21-30 ููู';
                } else if (awValue < 0.45) {
                    category = 'ูุชูุงุฒู';
                    shelfLife = '14-21 ููู';
                } else {
                    category = 'ุทุฑู';  // โญ ูุฐุง ููุทุฑู
                    shelfLife = '7-14 ููู';
                }
                
                return {
                    value: awValue.toFixed(3),
                    category: category,
                    shelfLife: shelfLife,
                    confidence: 0.92
                };
            }
            
            calculateDynamicDensity(state) {
                const profile = this.data.PROFILES[state.textureType];
                let density = profile.density;
                
                // Apply mixing method adjustment
                if (state.mixingMethod) {
                    const method = this.data.MIXING_METHODS[state.mixingMethod];
                    density *= method.densityAdjustment;
                }
                
                // Then apply butter type corrections
                const butterInfo = this.data.BUTTER_TYPES[state.butterType];
                if (butterInfo) {
                    density += (butterInfo.fatContent - 0.80) * 0.1;
                }
                
                // Additives reduce density
                if (state.useRiceFlour) density -= 0.015;
                if (state.useCornstarch) density -= 0.020;
                
                // Clamp to realistic range
                return Math.max(0.50, Math.min(0.72, density));
            }
            
            calculateFinalHeight(state) {
                let heightMultiplier = 1.0;
                
                // ุชุฃุซูุฑ ุทุฑููุฉ ุงูุฎูุท
                const methodMultipliers = {
                    'sablage': 0.92,
                    'creaming': 1.15
                };
                
                heightMultiplier *= methodMultipliers[state.mixingMethod] || 1.0;
                
                // ุชุฃุซูุฑ ุงูุฅุถุงูุงุช
                if (state.useRiceFlour) heightMultiplier *= 0.96;
                if (state.useCornstarch) heightMultiplier *= 0.94;
                
                // ุชุฃุซูุฑ ููุน ุงูุฒุจุฏุฉ
                if (state.butterType === 'european') heightMultiplier *= 1.02;
                if (state.butterType === 'vegetable') heightMultiplier *= 0.98;
                
                const finalHeight = state.height * heightMultiplier;
                return Math.max(0.5, Math.min(2.5, finalHeight)).toFixed(1);
            }
            
            calculateArea(shape, dimensions) {
                if (shape === 'rectangular') {
                    return dimensions.length * dimensions.width;
                } else {
                    return Math.PI * Math.pow(dimensions.diameter / 2, 2);
                }
            }
            
            getAdditiveName(type) {
                const names = {
                    'cornstarch': 'ูุดุง ุงูุฐุฑุฉ',
                    'riceFlour': 'ุฏููู ุงูุฃุฑุฒ',
                    'none': 'ุจุฏูู ุฅุถุงูุงุช'
                };
                return names[type];
            }
            
            generateInstructions(profile, state) {
                const method = this.data.MIXING_METHODS[state.mixingMethod || profile.mixingMethod];
                
                return {
                    mixing: {
                        title: `๐ ${method.name}`,
                        steps: this.getMixingSteps(state.mixingMethod || profile.mixingMethod),
                        scientificBasis: method.scientificBasis,
                        specialInstructions: profile.specialInstructions
                    }
                };
            }
            
            getMixingSteps(method) {
                const steps = {
                    sablage: [
                        `โ๏ธ ุชุฃูุฏ ูู ุฃู ุงูุฒุจุฏุฉ ${this.data.MIXING_METHODS.sablage.butterTemp}`,
                        `๐ ุงูุฑู ุงูุฒุจุฏุฉ ุงูุจุงุฑุฏุฉ ูุน ุงูุฏููู ูุงูุณูุฑ ุจุฃุทุฑุงู ุงูุฃุตุงุจุน`,
                        `โฑ๏ธ ุงุณุชูุฑ ุญุชู ูุตุจุญ ุงูุฎููุท ูุซู ุงูุฑูู ุงูุฎุดู`,
                        `๐ฏ ุงููุฏู: ูุทุน ุฒุจุฏุฉ ุตุบูุฑุฉ ูุฑุฆูุฉ ููุชูุดูุฑ`
                    ],
                    creaming: [
                        `๐ก๏ธ ุฏุน ุงูุฒุจุฏุฉ ุชุตู ูุฏุฑุฌุฉ ุญุฑุงุฑุฉ ุงูุบุฑูุฉ (${this.data.MIXING_METHODS.creaming.butterTemp})`,
                        `๐ ุงุฎูู ุงูุฒุจุฏุฉ ูุน ุงูุณูุฑ ุญุชู ูุตุจุญ ุงูุฎููุท ูุฑููู ููุงุชุญ`,
                        `โฑ๏ธ ูุฏุฉ ุงูุฎูู: 3-4 ุฏูุงุฆู ุจุณุฑุนุฉ ูุชูุณุทุฉ`,
                        `๐ฏ ุงููุฏู: ููุงุก ูุญุจูุณ ูููุงู ุทุฑู`
                    ]
                };
                
                return steps[method] || steps.sablage;
            }
            
            generateRecommendations(state, profile) {
                const recommendations = [];
                
                if (state.mode === 'expert' && state.mixingMethod && state.mixingMethod !== profile.mixingMethod) {
                    recommendations.push({
                        title: '๐ก ููุงุญุธุฉ: ุทุฑููุฉ ุฎูุท ูุฎุตุตุฉ',
                        value: `ุชู ุงุณุชุฎุฏุงู ${this.data.MIXING_METHODS[state.mixingMethod].name} ุจุฏูุงู ูู ุงูุทุฑููุฉ ุงูููุตู ุจูุง`
                    });
                }
                
                if (state.butterType !== 'european' && profile.recommendedButter === 'european') {
                    recommendations.push({
                        title: '๐ก ุชุญุณูู ููุชุฑุญ',
                        value: 'ูุชุญููู ูุชุงุฆุฌ ุฃูุถูุ ุฌุฑุจ ุงูุฒุจุฏุฉ ุงูุฃูุฑูุจูุฉ ุนุงููุฉ ุงูุฏุณู'
                    });
                }
                
                // ุชูุตูุงุช ุงูุฅุถุงูุงุช
                if (state.textureType === 'tender' && !state.useCornstarch && state.mode === 'expert') {
                    recommendations.push({
                        title: '๐ก ุชุญุณูู ุงูุทุฑุงูุฉ',
                        value: 'ุฅุถุงูุฉ ูุดุง ุงูุฐุฑุฉ ุณุชุญุณู ูู ุงูููุงู ุงูุทุฑู'
                    });
                }
                
                if (state.textureType === 'crispy' && !state.useRiceFlour && state.mode === 'expert') {
                    recommendations.push({
                        title: '๐ก ุชุญุณูู ุงููุฑูุดุฉ', 
                        value: 'ุฅุถุงูุฉ ุฏููู ุงูุฃุฑุฒ ุณุชุนุฒุฒ ุงููุฑูุดุฉ'
                    });
                }
                
                return recommendations;
            }
            
            generateScientificReport(ingredients, state, profile) {
                return {
                    waterActivity: {
                        value: this.calculateWaterActivity(ingredients, state.butterType, profile.bakingTemp).value,
                        interpretation: this.interpretWaterActivity(parseFloat(this.calculateWaterActivity(ingredients, state.butterType, profile.bakingTemp).value))
                    },
                    texturePrediction: this.predictTexture(state, ingredients),
                    stability: this.calculateStability(state, ingredients)
                };
            }
            
            interpretWaterActivity(aw) {
                if (aw < 0.35) return 'ููุฑูุด ุฌุฏุงู ูุน ุนูุฑ ุชุฎุฒูู ุทููู';
                if (aw < 0.45) return 'ูุชูุงุฒู ูุน ุนูุฑ ุชุฎุฒูู ุฌูุฏ';
                return 'ุทุฑู ูุน ุนูุฑ ุชุฎุฒูู ูุญุฏูุฏ';
            }
            
            predictTexture(state, ingredients) {
                const aw = parseFloat(this.calculateWaterActivity(ingredients, state.butterType, state.textureType === 'crispy' ? 177 : 149).value);
                const fatPercent = (ingredients.butter / (ingredients.flour + ingredients.butter + ingredients.sugar)) * 100;
                
                if (aw < 0.35 && fatPercent > 30) return 'ููุฑูุด ุฌุฏุงู ูุน ุทุฑุงูุฉ ุฏุงุฎููุฉ';
                if (aw < 0.40 && fatPercent > 25) return 'ููุฑูุด ูุน ุชูุงุฒู ุฌูุฏ';
                if (aw < 0.45) return 'ุทุฑู ูุน ูุฑูุดุฉ ุฎูููุฉ';
                return 'ุทุฑู ูุฐูุจ ูู ุงููู';
            }
            
            calculateStability(state, ingredients) {
                const aw = parseFloat(this.calculateWaterActivity(
                    ingredients, 
                    state.butterType, 
                    state.textureType === 'crispy' ? 177 : 149,
                    state.textureType === 'crispy'
                ).value);

                if (aw < 0.25) return 'ุงุณุชุซูุงุฆูุฉ (45-60 ููู)';
                if (aw < 0.30) return 'ุนุงููุฉ ุฌุฏุงู (30-45 ููู)';
                if (aw < 0.35) return 'ุนุงููุฉ (21-30 ููู)';
                if (aw < 0.40) return 'ุนุงููุฉ (14-21 ููู)';
                if (aw < 0.45) return 'ูุชูุณุทุฉ (7-14 ููู)';
                return 'ูุญุฏูุฏุฉ (3-7 ุฃูุงู)';
            }
            
            generateCheckpoints(state) {
                const profile = this.data.PROFILES[state.textureType];
                const method = this.data.MIXING_METHODS[state.mixingMethod || profile.mixingMethod];
                
                return this.data.ENHANCED_CHECKPOINTS.map(checkpoint => {
                    const dynamicTarget = checkpoint.target.replace('{butterTemp}', method.butterTemp);
                    return {
                        ...checkpoint,
                        target: dynamicTarget
                    };
                });
            }
        }

        // ============================================
        // ูุธุงู ุงูุชุญุฐูุฑุงุช ุงููุญุณู
        // ============================================
        
        class WarningSystem {
            static SEVERITY = {
                CRITICAL: { color: '#dc2626', icon: '๐ซ', priority: 1 },
                HIGH: { color: '#ea580c', icon: 'โ๏ธ', priority: 2 },
                MEDIUM: { color: '#d97706', icon: 'โก', priority: 3 },
                INFO: { color: '#0891b2', icon: 'โน๏ธ', priority: 4 },
                SUCCESS: { color: '#059669', icon: 'โ', priority: 5 }
            };
            
            static generateWarning(type, message, details = {}) {
                const severity = this.SEVERITY[type];
                
                return {
                    severity: severity,
                    message: message,
                    scientific: details.scientific || '',
                    recommendation: details.recommendation || '',
                    expectedIssue: details.expectedIssue || '',
                    expectedResult: details.expectedResult || ''
                };
            }
            
            static checkButterTypeCompatibility(state, profile) {
                const warnings = [];
                const butterInfo = ScientificData.BUTTER_TYPES[state.butterType];
                
                // ุชุญููู ุดุงูู ูุชูุงูู ููุน ุงูุฒุจุฏุฉ
                if (state.butterType === 'vegetable') {
                    if (state.textureType === 'tender' || state.textureType === 'traditional') {
                        warnings.push(this.generateWarning('CRITICAL', 
                            `ุงูุฒุจุฏุฉ ุงููุจุงุชูุฉ ุบูุฑ ูุชูุงููุฉ ูุน ุงูููุงู ${profile.name}`, {
                            scientific: `ูุญุชูู ุงููุงุก ุงูููุฎูุถ ุฌุฏุงู (${(butterInfo.waterContent * 100).toFixed(1)}%) ูููุน ุชูููู ุงูุบููุชูู ุงููุงูู ููุทุฑุงูุฉ. ุงูุดูุฑุช ุจุฑูุฏ ุณูููู ุฌุงูุงู ููุชูุชุชุงู ุจุดูู ููุฑุท.`,
                            recommendation: 'ุงุณุชุฎุฏู ุฒุจุฏุฉ ุฃูุฑูุจูุฉ (82-84% ุฏููู) ุฃู ุฃูุฑูููุฉ (80% ุฏููู) ููุญุตูู ุนูู ุงูุชูุงุฒู ุงูุตุญูุญ ุจูู ุงูุทุฑุงูุฉ ูุงููุดุงุดุฉ',
                            expectedIssue: 'ุฌูุงู ุดุฏูุฏุ ุชูุชุช ุฒุงุฆุฏ ุนู ุงูุญุฏุ ููุฏุงู ูุงูู ูุฎุงุตูุฉ "ุงูุฐูุจุงู ูู ุงููู"ุ Aw ููุฎูุถ ุฌุฏุงู (<0.25)'
                        }));
                    } else if (state.textureType === 'crispy') {
                        warnings.push(this.generateWarning('SUCCESS',
                            `ุงุฎุชูุงุฑ ููุชุงุฒ! ุงูุฒุจุฏุฉ ุงููุจุงุชูุฉ ูุซุงููุฉ ููููุงู ุงูููุฑูุด`, {
                            scientific: `ูุญุชูู ุงููุงุก ุงูููุฎูุถ (${(butterInfo.waterContent * 100).toFixed(1)}%) + ุงูุฏููู ุงูุนุงููุฉ (${(butterInfo.fatContent * 100).toFixed(1)}%) = ูุฑูุดุฉ ุงุณุชุซูุงุฆูุฉ ููุณุชุฏุงูุฉ`,
                            expectedResult: `Aw ููุฎูุถ ุฌุฏุงู (0.20-0.30)ุ ูุฑูุดุฉ ุชุตุฏุฑ ุตูุชุงู ูุงุถุญุงูุ ุงุณุชูุฑุงุฑ ููุชุงุฒุ ุนูุฑ ุชุฎุฒููู ูุตู ุฅูู 60 ูููุงู ูู ุธุฑูู ูุซุงููุฉ`
                        }));
                    }
                }
                
                if (state.butterType === 'american' && state.textureType === 'crispy') {
                    warnings.push(this.generateWarning('MEDIUM',
                        'ุงูุฒุจุฏุฉ ุงูุฃูุฑูููุฉ ุณุชุนุทู ูุฑูุดุฉ ุฃูู ูู ุงููุชููุน', {
                        scientific: `ูุญุชูู ุงููุงุก ุงูุนุงูู (${(butterInfo.waterContent * 100).toFixed(1)}%) ุณููุชุฌ ุจุฎุงุฑ ุฅุถุงูู ุฃุซูุงุก ุงูุฎุจุฒุ ููุง ูุฏ ูููู ูู ุงููุฑูุดุฉ ุงูููุงุฆูุฉ ุจูุณุจุฉ 15-20%`,
                        recommendation: 'ููุญุตูู ุนูู ุฃูุถู ูุชุงุฆุฌ ููููุงู ุงูููุฑูุดุ ุงุณุชุฎุฏู ุฒุจุฏุฉ ุฃูุฑูุจูุฉ (82%+) ุฃู ูุจุงุชูุฉ (85%+)',
                        expectedIssue: 'ูุฑูุดุฉ ุฃููุ Aw ุฃุนูู (~0.35-0.40)ุ ุนูุฑ ุชุฎุฒููู ุฃูุตุฑ (14-21 ููู)'
                    }));
                }
                
                if (state.butterType === 'mixed') {
                    warnings.push(this.generateWarning('INFO',
                        'ุงูุฒุจุฏุฉ ุงููุฎููุทุฉ ุฎูุงุฑ ูุชูุณุท - ูุชุงุฆุฌ ูุชุจุงููุฉ', {
                        scientific: `ูุฒูุฌ ูู ุงูุฒุจุฏุฉ ูุงููุงุฑุฌุฑูู ููุชุฌ ุฎุตุงุฆุต ูุชูุณุทุฉ ูุบูุฑ ูุชุณูุฉ. ูุญุชูู ุงููุงุก (${(butterInfo.waterContent * 100).toFixed(1)}%) ููุญุชูู ุงูุฏููู (${(butterInfo.fatContent * 100).toFixed(1)}%) ูุนุชูุฏุงู ุนูู ูุณุจุฉ ุงูุฎูุท`,
                        recommendation: 'ููุญุตูู ุนูู ูุชุงุฆุฌ ููุซููุฉ ููุงุจูุฉ ููุชูุฑุงุฑุ ุงุณุชุฎุฏู ููุนุงู ูุงุญุฏุงู ูู ุงูุฒุจุฏุฉ',
                        expectedIssue: 'ูุชุงุฆุฌ ุบูุฑ ูุชุณูุฉ ุจูู ุฏูุนุงุช ูุฎุชููุฉุ ุตุนูุจุฉ ูู ุงูุชุญูู ุงูุฏููู ุจุงูููุงู ุงูููุงุฆู'
                    }));
                }
                
                return warnings;
            }
            
            static checkAdditiveCompatibility(state, profile) {
                const warnings = [];
                
                // ุชุญููู ุชูุงูู ุงููุถุงูุงุช
                if (state.textureType === 'tender' && state.useRiceFlour) {
                    warnings.push(this.generateWarning('MEDIUM',
                        'ุฏููู ุงูุฃุฑุฒ ุณูููู ูู ุงูุทุฑุงูุฉ ุงููุฑุบูุจุฉ', {
                        scientific: 'ุฏููู ุงูุฃุฑุฒ (ุฎุงูู ูู ุงูุบููุชูู) ูุฒูุฏ ุงููุฑูุดุฉ ุจูุณุจุฉ 30% ููููู ุงูุทุฑุงูุฉ. ูุฐุง ุนูุณ ุงููุฏู ุงููุทููุจ ููููุงู ุงูุทุฑู',
                        recommendation: 'ููููุงู ุงูุทุฑูุ ุงุณุชุฎุฏู ูุดุง ุงูุฐุฑุฉ (12%) ุจุฏูุงู ูู ุฏููู ุงูุฃุฑุฒ. ูุดุง ุงูุฐุฑุฉ ูุนุฒุฒ ุงูุทุฑุงูุฉ ุฏูู ุฒูุงุฏุฉ ุงููุฑูุดุฉ',
                        expectedIssue: 'ููุงู ุฃูุซุฑ ูุฑูุดุฉ ูุฃูู ุทุฑุงูุฉ ูู ุงููุชููุนุ ูููุณ "ุฑููู" ุจุงุฑุฒ'
                    }));
                }
                
                if (state.textureType === 'crispy' && state.useCornstarch) {
                    warnings.push(this.generateWarning('MEDIUM',
                        'ูุดุง ุงูุฐุฑุฉ ูุฏ ูููู ูู ุงููุฑูุดุฉ ุงููุณุชูุฏูุฉ', {
                        scientific: 'ูุดุง ุงูุฐุฑุฉ ุงูููู ูุฐูุจ ุจุณุฑุนุฉ ููุฎูู ูููุณุงู ูุงุนูุงู ุฃูุซุฑ ูู ูููู ููุฑูุดุงู. ูููุฑูุดุฉ ุงููุตููุ ุฏููู ุงูุฃุฑุฒ ุงูุฃุจูุถ ูู ุงูุฎูุงุฑ ุงูุฃูุซู',
                        recommendation: 'ุงุณุชุฎุฏู 25% ุฏููู ุฃุฑุฒ ุฃุจูุถ ููุญุตูู ุนูู ูุฑูุดุฉ ุงุณุชุซูุงุฆูุฉ (ุฒูุงุฏุฉ 30%)',
                        expectedIssue: 'ูุฑูุดุฉ ุฃูู ูู ุงููุซุงููุฉุ ูููุณ ุฃูุนู ูุฃูู "ุชูุดุฑุงู"'
                    }));
                }
                
                if ((state.useRiceFlour && state.useCornstarch)) {
                    warnings.push(this.generateWarning('HIGH',
                        'โ๏ธ ูุง ูุฌุจ ุงุณุชุฎุฏุงู ุฏููู ุงูุฃุฑุฒ ููุดุง ุงูุฐุฑุฉ ูุนุงู!', {
                        scientific: 'ุงูุฌูุน ุจูู ููุนูู ูู ุงููุดููุงุช ูุคุฏู ุฅูู ุฅุถุนุงู ููุฑุท ููุบููุชููุ ููุง ููุชุฌ ุนุฌููุงู ูุดุงู ุฌุฏุงู ูุตุนุจ ุงูุชุญูู ุจู ููุชููู ุจุณูููุฉ',
                        recommendation: 'ุงุฎุชุฑ ูุงุญุฏุงู ููุท: ูุดุง ุงูุฐุฑุฉ ููุทุฑุงูุฉุ ุฃู ุฏููู ุงูุฃุฑุฒ ูููุฑูุดุฉ',
                        expectedIssue: 'ุนุฌูู ุถุนูู ุฌุฏุงูุ ุชูุชุช ููุฑุทุ ุตุนูุจุฉ ูู ุงูุชุดูููุ Aw ุบูุฑ ูุณุชูุฑ'
                    }));
                }
                
                return warnings;
            }
        }

        // =============================================
        // ุฅุฏุงุฑุฉ ุงููุงุฌูุฉ ุงููุญุณูุฉ
        // =============================================

        class UIManager {
            constructor() {
                this.stateManager = new AppState();
                this.recipeEngine = new RecipeEngine();
                this.init();
            }
            
            init() {
                // ุชููุฆุฉ ุงูุญุงูุฉ ุงูุงูุชุฑุงุถูุฉ
                this.stateManager.set('butterType', 'european');
                this.stateManager.set('textureType', 'traditional');
                this.stateManager.set('mode', 'beginner');
                this.stateManager.set('mixingMethod', 'sablage');
                
                this.bindEvents();
                this.updateModeDisplay();
                this.validateAndWarn();
                this.addTooltips();
                this.updateDimensions();
            }
            
            bindEvents() {
                // ุงูุชููู ุจูู ุงูุชุจููุจุงุช
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const tabName = e.currentTarget.getAttribute('data-tab');
                        if (tabName === 'recipe' && document.getElementById('recipe-tab').disabled) {
                            this.showNotification('โ๏ธ ูุฑุฌู ุญุณุงุจ ูุตูุฉ ุฃููุงู', 'error');
                            return;
                        }
                        this.switchTab(tabName);
                    });
                });
                
                // ุฃุญุฏุงุซ ุงูุดุงุดุฉ ุงูุฑุฆูุณูุฉ
                document.querySelectorAll('.mode-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const mode = e.currentTarget.getAttribute('data-mode');
                        this.setMode(mode);
                    });
                });
                
                // ุฃุญุฏุงุซ ุงูุฅุนุฏุงุฏุงุช
                document.getElementById('pan-shape').addEventListener('change', () => this.updateDimensions());
                document.getElementById('calculate-recipe-btn').addEventListener('click', () => this.calculateRecipe());
                document.getElementById('save-recipe-btn').addEventListener('click', () => this.saveCurrentRecipe());
                document.getElementById('export-all-btn').addEventListener('click', () => this.exportAllData());
                
                // ุฃุญุฏุงุซ ุงูุฎูุงุฑุงุช
                document.getElementById('use-rice-flour').addEventListener('change', (e) => {
                    this.stateManager.set('useRiceFlour', e.target.checked);
                    if (e.target.checked) {
                        document.getElementById('use-cornstarch').checked = false;
                        this.stateManager.set('useCornstarch', false);
                    }
                    this.validateAndWarn();
                });
                
                document.getElementById('use-cornstarch').addEventListener('change', (e) => {
                    this.stateManager.set('useCornstarch', e.target.checked);
                    if (e.target.checked) {
                        document.getElementById('use-rice-flour').checked = false;
                        this.stateManager.set('useRiceFlour', false);
                    }
                    this.validateAndWarn();
                });
                
                // Event listeners ูุทุฑููุฉ ุงูุฎูุท
                document.querySelectorAll('#mixing-method-section .option-card').forEach(card => {
                    card.addEventListener('click', (event) => {
                        const method = event.currentTarget.getAttribute('data-method');
                        this.selectMixingMethod(method, event);
                    });
                });
                
                // ุงูุงุดุชุฑุงู ูู ุชุญุฏูุซุงุช ุงูุญุงูุฉ
                this.stateManager.subscribe((key, value) => {
                    this.handleStateChange(key, value);
                });
            }
            
            setMode(mode) {
                this.stateManager.set('mode', mode);
                this.updateModeDisplay();
                this.validateAndWarn();
                
                this.showNotification(`โ ุชู ุงูุชุจุฏูู ุฅูู ูุถุน ${mode === 'beginner' ? 'ุงููุจุชุฏุฆ' : 'ุงูุฎุจูุฑ'}`);
            }
            
            updateModeDisplay() {
                const mode = this.stateManager.get('mode');
                const modeDisplay = document.getElementById('current-mode-display');
                const expertExplanation = document.getElementById('expert-explanation');
                const mixingSection = document.getElementById('mixing-method-section');
                
                if (modeDisplay) {
                    modeDisplay.textContent = mode === 'beginner' ? 'ุงููุจุชุฏุฆ' : 'ุงูุฎุจูุฑ';
                }
                
                // ุชุญุฏูุซ ุฃุฒุฑุงุฑ ุงููุถุน
                document.querySelectorAll('.mode-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.getAttribute('data-mode') === mode) {
                        btn.classList.add('active');
                    }
                });
                
                // ุฅุธูุงุฑ/ุฅุฎูุงุก ุดุฑุญ ุงููุถุน ุงูุฎุจูุฑ
                if (expertExplanation) {
                    expertExplanation.classList.toggle('hidden', mode !== 'expert');
                }
                
                // ุฅุธูุงุฑ/ุฅุฎูุงุก ูุณู ูุธุงู ุงูุฎูุท
                if (mixingSection) {
                    mixingSection.classList.toggle('hidden', mode !== 'expert');
                }
                
                // ุชุญุฏูุซ ุงูุชูุตูุงุช
                this.validateAndWarn();
            }
            
            updateDimensions() {
                const shape = document.getElementById('pan-shape').value;
                this.stateManager.set('panShape', shape);
                
                // ุญูุธ ุงูููู ุงูุญุงููุฉ
                if (shape === 'rectangular') {
                    const length = parseInt(document.getElementById('pan-length').value) || 30;
                    const width = parseInt(document.getElementById('pan-width').value) || 20;
                    this.stateManager.set('dimensions', { 
                        ...this.stateManager.get('dimensions'),
                        length, 
                        width 
                    });
                    document.getElementById('rectangular-dimensions').classList.remove('hidden');
                    document.getElementById('circular-dimensions').classList.add('hidden');
                } else {
                    const diameter = parseInt(document.getElementById('pan-diameter').value) || 24;
                    this.stateManager.set('dimensions', { 
                        ...this.stateManager.get('dimensions'),
                        diameter 
                    });
                    document.getElementById('rectangular-dimensions').classList.add('hidden');
                    document.getElementById('circular-dimensions').classList.remove('hidden');
                }
            }
            
            selectTexture(texture) {
                this.stateManager.set('textureType', texture);
                
                // ุชุญุฏูุซ ุงููุงุฌูุฉ
                document.querySelectorAll('[id^="texture-"]').forEach(el => {
                    el.classList.remove('selected');
                });
                document.getElementById(`texture-${texture}`).classList.add('selected');
                
                // ูู ูุถุน ุงููุจุชุฏุฆุ ุชุทุจูู ุงูุชูุตูุงุช ุชููุงุฆูุงู
                if (this.stateManager.get('mode') === 'beginner') {
                    this.applyAutomaticRecommendations();
                }
                
                this.validateAndWarn();
            }
            
            applyAutomaticRecommendations() {
                const state = this.stateManager.state;
                const profile = ScientificData.PROFILES[state.textureType];
                
                // ุชุญุฏูุซ ุฎูุงุฑุงุช ุงูุฅุถุงูุงุช ุชููุงุฆูุงู
                document.getElementById('use-rice-flour').checked = profile.additive.type === 'riceFlour';
                document.getElementById('use-cornstarch').checked = profile.additive.type === 'cornstarch';
                
                this.stateManager.set('useRiceFlour', profile.additive.type === 'riceFlour');
                this.stateManager.set('useCornstarch', profile.additive.type === 'cornstarch');
                this.stateManager.set('butterType', profile.recommendedButter || 'european');
                this.stateManager.set('mixingMethod', profile.mixingMethod);
                
                // ุชุญุฏูุซ ูุงุฌูุฉ ุงูุฒุจุฏุฉ
                document.querySelectorAll('[id^="butter-"]').forEach(el => {
                    el.classList.remove('selected');
                });
                document.getElementById(`butter-${profile.recommendedButter || 'european'}`).classList.add('selected');
                
                // ุชุญุฏูุซ ูุงุฌูุฉ ุทุฑููุฉ ุงูุฎูุท
                document.querySelectorAll('#mixing-method-section .option-card').forEach(card => {
                    card.classList.remove('selected');
                });
                const mixingCard = document.querySelector(`[data-method="${profile.mixingMethod}"]`);
                if (mixingCard) mixingCard.classList.add('selected');
            }
            
            selectQuickProfile(profile) {
                this.selectTexture(profile);
                this.switchTab('setup');
            }
            
            selectButter(butterType) {
                this.stateManager.set('butterType', butterType);
                
                document.querySelectorAll('[id^="butter-"]').forEach(el => {
                    el.classList.remove('selected');
                });
                document.getElementById(`butter-${butterType}`).classList.add('selected');
                
                this.validateAndWarn();
            }
            
            selectMixingMethod(method, event) {
                if (this.stateManager.get('mode') === 'expert') {
                    this.stateManager.set('mixingMethod', method);
                    
                    document.querySelectorAll('#mixing-method-section .option-card').forEach(card => {
                        card.classList.remove('selected');
                    });
                    
                    if (event && event.currentTarget) {
                        event.currentTarget.classList.add('selected');
                    }
                    
                    this.validateAndWarn();
                    this.showNotification(`โ ุชู ุชุบููุฑ ุทุฑููุฉ ุงูุฎูุท ุฅูู ${ScientificData.MIXING_METHODS[method].name}`);
                }
            }
            
            validateAndWarn() {
                const state = this.stateManager.state;
                const profile = ScientificData.PROFILES[state.textureType];
                const container = document.getElementById('smart-recommendations-container');
                
                if (!container) return;
                
                // ุฌูุน ุฌููุน ุงูุชุญุฐูุฑุงุช
                let allWarnings = [];
                allWarnings = allWarnings.concat(WarningSystem.checkButterTypeCompatibility(state, profile));
                allWarnings = allWarnings.concat(WarningSystem.checkAdditiveCompatibility(state, profile));
                
                // ุชุฑุชูุจ ุงูุชุญุฐูุฑุงุช ุญุณุจ ุงูุฃููููุฉ
                allWarnings.sort((a, b) => a.severity.priority - b.severity.priority);
                
                let html = `
                    <div class="recommendation-card" style="background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); border: 2px solid #10b981; border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem;">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <div style="font-size: 2rem;">๐ฏ</div>
                            <div>
                                <div class="font-bold">ุงูุจุฑููุงูู ุงููุญุฏุฏ: ${profile.name}</div>
                                <div class="text-sm text-green-700">${profile.description}</div>
                            </div>
                        </div>
                    </div>
                `;
                
                // ุนุฑุถ ุงูุชุญุฐูุฑุงุช
                if (allWarnings.length > 0) {
                    allWarnings.forEach(warning => {
                        html += `
                            <div class="warning-card" style="background: ${warning.severity.color}15; border: 2px solid ${warning.severity.color}; border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem;">
                                <div style="display: flex; align-items: flex-start; gap: 1rem;">
                                    <div style="font-size: 2rem; flex-shrink: 0;">${warning.severity.icon}</div>
                                    <div style="flex: 1;">
                                        <h4 style="color: ${warning.severity.color}; margin: 0 0 0.75rem 0; font-weight: bold; font-size: 1.1rem;">
                                            ${warning.message}
                                        </h4>
                                        
                                        ${warning.scientific ? `
                                            <div style="background: white; padding: 0.75rem; border-radius: 8px; margin-bottom: 0.75rem; border-right: 3px solid ${warning.severity.color};">
                                                <div style="font-weight: 600; color: #1f2937; margin-bottom: 0.25rem;">๐ฌ ุงูุฃุณุงุณ ุงูุนููู:</div>
                                                <div style="color: #4b5563; font-size: 0.9rem;">${warning.scientific}</div>
                                            </div>
                                        ` : ''}
                                        
                                        ${warning.recommendation ? `
                                            <div style="background: #ecfdf5; padding: 0.75rem; border-radius: 8px; margin-bottom: 0.75rem; border-right: 3px solid #059669;">
                                                <div style="font-weight: 600; color: #059669; margin-bottom: 0.25rem;">๐ก ุงูุชูุตูุฉ:</div>
                                                <div style="color: #065f46; font-size: 0.9rem;">${warning.recommendation}</div>
                                            </div>
                                        ` : ''}
                                        
                                        ${warning.expectedIssue ? `
                                            <div style="background: #fef3c7; padding: 0.75rem; border-radius: 8px; border-right: 3px solid #d97706;">
                                                <div style="font-weight: 600; color: #d97706; margin-bottom: 0.25rem;">โ๏ธ ุงููุดููุฉ ุงููุชููุนุฉ:</div>
                                                <div style="color: #92400e; font-size: 0.9rem;">${warning.expectedIssue}</div>
                                            </div>
                                        ` : ''}
                                        
                                        ${warning.expectedResult ? `
                                            <div style="background: #dbeafe; padding: 0.75rem; border-radius: 8px; border-right: 3px solid #3b82f6;">
                                                <div style="font-weight: 600; color: #1e40af; margin-bottom: 0.25rem;">โจ ุงููุชูุฌุฉ ุงููุชููุนุฉ:</div>
                                                <div style="color: #1e3a8a; font-size: 0.9rem;">${warning.expectedResult}</div>
                                            </div>
                                        ` : ''}
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                }
                
                container.innerHTML = html;
                this.updateAutoSettingsDisplay(profile);
            }
            
            updateAutoSettingsDisplay(profile) {
                const container = document.getElementById('auto-settings-display');
                const state = this.stateManager.state;
                const effectiveMethod = state.mixingMethod || profile.mixingMethod;
                const methodInfo = ScientificData.MIXING_METHODS[effectiveMethod];
                
                if (!container) return;
                
                container.innerHTML = `
                    <div class="grid-2">
                        <div class="auto-settings">
                            <div class="font-semibold">ุทุฑููุฉ ุงูุฎูุท</div>
                            <div class="text-sm text-gray-600">${methodInfo.name}</div>
                        </div>
                        <div class="auto-settings">
                            <div class="font-semibold">ููุน ุงูุณูุฑ</div>
                            <div class="text-sm text-gray-600">${profile.sugarType === 'powdered' ? 'ุจูุฏุฑุฉ' : 'ูุญุจุจ'}</div>
                        </div>
                        <div class="auto-settings">
                            <div class="font-semibold">ุงููุถุงูุงุช</div>
                            <div class="text-sm text-gray-600">${
                                profile.additive.type === 'none' ? 'ุจุฏูู' : 
                                profile.additive.type === 'cornstarch' ? 'ูุดุง ุฐุฑุฉ 15%' : 
                                'ุฏููู ุฃุฑุฒ 25%'
                            }</div>
                        </div>
                        <div class="auto-settings">
                            <div class="font-semibold">ุฏุฑุฌุฉ ุญุฑุงุฑุฉ ุงูุฒุจุฏุฉ</div>
                            <div class="text-sm text-gray-600">${profile.butterTemp}</div>
                        </div>
                        <div class="auto-settings">
                            <div class="font-semibold">ุฏุฑุฌุฉ ุญุฑุงุฑุฉ ุงูุฎุจุฒ</div>
                            <div class="text-sm text-gray-600">${profile.bakingTemp}ยฐู</div>
                        </div>
                        <div class="auto-settings">
                            <div class="font-semibold">ูุฏุฉ ุงูุฎุจุฒ</div>
                            <div class="text-sm text-gray-600">${profile.bakingTime}</div>
                        </div>
                        <div class="auto-settings">
                            <div class="font-semibold">ููุน ุงูุฒุจุฏุฉ ุงูููุตู ุจู</div>
                            <div class="text-sm text-gray-600">${ScientificData.BUTTER_TYPES[profile.recommendedButter || 'european'].name}</div>
                        </div>
                        <div class="auto-settings">
                            <div class="font-semibold">ุงููุซุงูุฉ ุงููุชููุนุฉ</div>
                            <div class="text-sm text-gray-600">${profile.density} ุฌู/ุณูยณ</div>
                        </div>
                    </div>
                    
                    <div class="mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
                        <div class="font-semibold text-blue-900">๐ ุงูุชุนูููุงุช ุงูุฎุงุตุฉ:</div>
                        <ul class="text-sm text-blue-700 mt-2 space-y-1">
                            ${profile.specialInstructions.map(instruction => `
                                <li>โข ${instruction}</li>
                            `).join('')}
                        </ul>
                    </div>
                `;
                
                // ุชุญุฏูุซ ุทุฑููุฉ ุงูุฎูุท ุงูููุตู ุจูุง
                const recommendedMethod = document.getElementById('recommended-mixing-method');
                if (recommendedMethod) {
                    recommendedMethod.textContent = `${ScientificData.MIXING_METHODS[profile.mixingMethod].name} (ููุตู ุจู)`;
                }
            }
            
            calculateRecipe() {
                // ุชุญุฏูุซ ุงูุญุงูุฉ ูู ุงููุงุฌูุฉ
                this.updateStateFromUI();
                
                // ุงูุชุญูู ูู ุงููุฏุฎูุงุช
                if (!this.validateInputs()) return;
                
                this.showLoading();
                
                // ูุญุงูุงุฉ ุญุณุงุจ ุบูุฑ ูุชุฒุงูู
                setTimeout(() => {
                    try {
                        const state = this.stateManager.state;
                        const recipe = this.recipeEngine.calculateRecipe(state);
                        
                        if (!recipe) {
                            throw new Error('ูุดู ูู ุญุณุงุจ ุงููุตูุฉ');
                        }
                        
                        this.stateManager.set('currentRecipe', recipe);
                        
                        // โ ุชุญุฏูุซ ุงููุงุฌูุฉ ุฅุฐุง ุชู ุชุทุจูู ุชูุตูุงุช ุชููุงุฆูุฉ
                        if (state.mode === 'beginner') {
                            this.updateUIFromState();
                        }
                        
                        // ุชูููู ุชุจููุจ ุงููุตูุฉ
                        document.getElementById('recipe-tab').disabled = false;
                        
                        // ุนุฑุถ ุงููุตูุฉ
                        this.renderRecipe();
                        this.switchTab('recipe');
                        
                        this.hideLoading();
                        this.showNotification('โ ุชู ุญุณุงุจ ุงููุตูุฉ ุจูุฌุงุญ ูุน ุงูุชุญุณููุงุช ุงูุนูููุฉ!');
                    } catch (error) {
                        console.error('Error calculating recipe:', error);
                        this.hideLoading();
                        this.showNotification('โ ุญุฏุซ ุฎุทุฃ ูู ุญุณุงุจ ุงููุตูุฉ', 'error');
                    }
                }, 1000);
            }
            
            updateStateFromUI() {
                const state = {
                    panShape: document.getElementById('pan-shape').value,
                    dimensions: {
                        length: parseInt(document.getElementById('pan-length').value) || 30,
                        width: parseInt(document.getElementById('pan-width').value) || 20,
                        diameter: parseInt(document.getElementById('pan-diameter').value) || 24
                    },
                    height: parseFloat(document.getElementById('pan-height').value) || 1.5,
                    textureType: this.stateManager.get('textureType'),
                    butterType: this.stateManager.get('butterType'),
                    mixingMethod: this.stateManager.get('mixingMethod'),
                    useRiceFlour: document.getElementById('use-rice-flour').checked,
                    useCornstarch: document.getElementById('use-cornstarch').checked
                };
                
                this.stateManager.update(state);
            }
            
            validateInputs() {
                const length = parseInt(document.getElementById('pan-length').value);
                const width = parseInt(document.getElementById('pan-width').value);
                const height = parseFloat(document.getElementById('pan-height').value);
                
                if (this.stateManager.get('panShape') === 'rectangular') {
                    if (length < 10 || length > 50) {
                        this.showNotification('ุงูุทูู ูุฌุจ ุฃู ูููู ุจูู 10 ู 50 ุณู', 'error');
                        return false;
                    }
                    
                    if (width < 10 || width > 50) {
                        this.showNotification('ุงูุนุฑุถ ูุฌุจ ุฃู ูููู ุจูู 10 ู 50 ุณู', 'error');
                        return false;
                    }
                }
                
                if (height < 0.5 || height > 3.0) {
                    this.showNotification('ุงูุงุฑุชูุงุน ูุฌุจ ุฃู ูููู ุจูู 0.5 ู 3.0 ุณู', 'error');
                    return false;
                }
                
                return true;
            }
            
            renderRecipe() {
                const recipe = this.stateManager.get('currentRecipe');
                if (!recipe) return;
                
                // ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช
                document.getElementById('stat-weight').textContent = `${recipe.analysis.weight}ุบู`;
                document.getElementById('stat-fat').textContent = `${recipe.analysis.fatPercent}%`;
                document.getElementById('stat-aw').textContent = recipe.analysis.expectedAw;
                document.getElementById('stat-shelf').textContent = recipe.analysis.shelfLife;
                
                // ุชุญุฏูุซ ุงูููููุงุช
                this.renderIngredients(recipe);
                
                // ุชุญุฏูุซ ุงูุชุนูููุงุช
                this.renderInstructions(recipe);
            }
            
            renderIngredients(recipe) {
                const container = document.getElementById('ingredients-list');
                if (!container || !recipe) return;

                // ุงูุญุตูู ุนูู ููุน ุงูุฒุจุฏุฉ ูุน ูููุฉ ุงูุชุฑุงุถูุฉ
                const butterType = this.stateManager.get('butterType') || 'european';
                const butterInfo = ScientificData.BUTTER_TYPES[butterType];
                
                // ุงุณุชุฎุฏุงู ุงุณู ุงูุชุฑุงุถู ุฅุฐุง ูู ููู butterInfo ููุฌูุฏุงู
                const butterName = butterInfo ? butterInfo.name : 'ุฒุจุฏุฉ';

                const ingredients = [
                    { 
                        name: 'ุงูุฒุจุฏุฉ', 
                        amount: `${recipe.ingredients.butter}ุบู`, 
                        note: `${butterName} - ${recipe.analysis.recommendedButterTemp}`
                    },
                    { 
                        name: 'ุงูุฏููู', 
                        amount: `${recipe.ingredients.flour}ุบู`, 
                        note: 'ุทุฑููุฉ Spoon & Level' 
                    },
                    { 
                        name: 'ุงูุณูุฑ', 
                        amount: `${recipe.ingredients.sugar}ุบู`, 
                        note: recipe.profile.sugarType === 'powdered' ? 'ุจูุฏุฑุฉ ููุทุฑุงูุฉ' : 'ูุญุจุจ ูููุฑูุดุฉ' 
                    },
                    { 
                        name: 'ุงูููุญ', 
                        amount: `${recipe.ingredients.salt}ุบู`, 
                        note: 'ููุญ ุจุญุฑู ูุงุนู - 1% ูู ุงูุฏููู' 
                    }
                ];

                let html = '';
                
                ingredients.forEach(ing => {
                    html += `
                        <div class="ingredient-card">
                            <div class="ingredient-header">
                                <div>
                                    <div class="ingredient-name">${ing.name}</div>
                                    <div class="ingredient-note">${ing.note}</div>
                                </div>
                                <div class="ingredient-amount">${ing.amount}</div>
                            </div>
                        </div>
                    `;
                });
                
                // ุฅุถุงูุฉ ุงููุถุงูุงุช ุฅุฐุง ูุฌุฏุช
                if (recipe.ingredients.additives) {
                    Object.entries(recipe.ingredients.additives).forEach(([name, amount]) => {
                        if (amount > 0) {
                            html += `
                                <div class="ingredient-card additive">
                                    <div class="ingredient-header">
                                        <div>
                                            <div class="ingredient-name">${name}</div>
                                            <div class="ingredient-note">ุฅุถุงูุฉ ุนูููุฉ ูุชุญุณูู ุงูููุงู</div>
                                        </div>
                                        <div class="ingredient-amount">${amount}ุบู</div>
                                    </div>
                                </div>
                            `;
                        }
                    });
                }
                
                container.innerHTML = html;
            }
            
            renderInstructions(recipe) {
                const container = document.getElementById('instructions-container');
                if (!container) return;
                
                let html = '';
                
                if (recipe.instructions.mixing) {
                    const method = ScientificData.MIXING_METHODS[this.stateManager.get('mixingMethod') || recipe.profile.mixingMethod];
                    
                    html += `
                        <div class="card card-blue">
                            <h3 class="subsection-title">${recipe.instructions.mixing.title}</h3>
                            <div class="method-details" style="background: #f0f9ff; padding: 1rem; border-radius: 8px; border-right: 4px solid #3b82f6; margin-bottom: 1rem;">
                                <div class="method-detail-item" style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span class="method-detail-label" style="color: #4b5563; font-weight: 500;">๐ฌ ุงูุฃุณุงุณ ุงูุนููู:</span>
                                    <span class="method-detail-value" style="color: #1f2937; font-weight: 600;">${recipe.instructions.mixing.scientificBasis}</span>
                                </div>
                            </div>
                            <div class="step-card">
                                <div class="step-header">
                                    <div class="step-number">1</div>
                                    <div style="flex: 1;">
                                        <div class="step-action">ุฎุทูุงุช ุงูุฎูุท</div>
                                        ${recipe.instructions.mixing.steps.map(step => `
                                            <div class="step-detail">${step}</div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                // ุฅุถุงูุฉ ูุณู ุงูุชูุตูุงุช
                if (recipe.recommendations && recipe.recommendations.length > 0) {
                    html += `
                        <div class="card card-purple">
                            <h3 class="subsection-title">๐ง ุงูุชูุตูุงุช ุงูุฐููุฉ ุงููุญุณูุฉ</h3>
                            ${recipe.recommendations.map(rec => `
                                <div class="method-details" style="background: #faf5ff; padding: 1rem; border-radius: 8px; border-right: 4px solid #8b5cf6; margin-bottom: 0.75rem;">
                                    <div class="method-detail-item" style="display: flex; justify-content: space-between;">
                                        <span class="method-detail-label" style="color: #4b5563; font-weight: 500;">${rec.title}</span>
                                        <span class="method-detail-value" style="color: #1f2937; font-weight: 600;">${rec.value}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
                
                // ุฅุถุงูุฉ ูุณู ุงูุฎุจุฒ ุงููุฒุฏูุฌ ููููุงู ุงูููุฑูุด
                if (recipe.profile.twiceBaked && recipe.profile.twiceBaked.enabled) {
                    html += `
                        <div class="card card-red">
                            <h3 class="subsection-title">๐ฅ ุชูููุฉ ุงูุฎุจุฒ ุงููุฒุฏูุฌ ุงููุญุณูุฉ - ุณุฑ ุงููุฑูุดุฉ ุงูุงุณุชุซูุงุฆูุฉ</h3>
                            <div class="step-card">
                                <div class="step-header">
                                    <div class="step-number">4</div>
                                    <div style="flex: 1;">
                                        <div class="step-action">ุงููุฑุญูุฉ ุงูุฃููู: ุงูุฎุจุฒ ุงูุฃุณุงุณู</div>
                                        <div class="step-detail">
                                            ุงุฎุจุฒ ุนูู ุญุฑุงุฑุฉ ${recipe.profile.twiceBaked.firstBakeTemp}ยฐู
                                        </div>
                                        <div class="step-detail">
                                            <strong>ุงููุฏุฉ:</strong> ${recipe.profile.twiceBaked.firstBakeDuration}
                                        </div>
                                        <div class="step-detail">
                                            <strong>ุงููุฏู:</strong> ุชุซุจูุช ุงููููู ูุชูููู ุงูููู ุงูุฐูุจู
                                        </div>
                                        <div class="step-tip">
                                            ๐ฌ ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ ุงูุนุงููุฉ ุชูุดุท ุชูุงุนูุงุช ูููุงุฑุฏ ูุชูููู ุงููููุฉ ูุงูููู
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="step-card">
                                <div class="step-header">
                                    <div class="step-number">5</div>
                                    <div style="flex: 1;">
                                        <div class="step-action">ุงููุฑุญูุฉ ุงูุซุงููุฉ: ุงูุชุฌููู ุจุงูุญุฑุงุฑุฉ ุงููุชุจููุฉ</div>
                                        <div class="step-detail">
                                            ุฃุทูุฆ ุงููุฑู ูุงุชุฑู ุงูุจุงุจ ููุชูุญุงู ููููุงู
                                        </div>
                                        <div class="step-detail">
                                            <strong>ุงูุชุจุฑูุฏ:</strong> ${recipe.profile.twiceBaked.coolingDuration}
                                        </div>
                                        <div class="step-detail">
                                            ูุทุน ุงูุดูุฑุช ุจุฑูุฏ ุฅูู ุงููุทุน ุงููุทููุจุฉ ููู ุฏุงูุฆ
                                        </div>
                                        <div class="step-tip">
                                            ๐ก ุงููุทุน ุฃุซูุงุก ุงูุฏูุก ูููุน ุงูุชูุณุฑ ููุนุทู ุญูุงูุงู ูุธููุฉ
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="step-card">
                                <div class="step-header">
                                    <div class="step-number">6</div>
                                    <div style="flex: 1;">
                                        <div class="step-action">ุงููุฑุญูุฉ ุงูุซุงูุซุฉ: ุงูุชุญููุต ุงูููุงุฆู</div>
                                        <div class="step-detail">
                                            ุฃุนุฏ ุงููุทุน ุงูููุทูุนุฉ ุฅูู ุงููุฑู ุงููุทูุฃ
                                        </div>
                                        <div class="step-detail">
                                            <strong>ุงููุฏุฉ:</strong> ${recipe.profile.twiceBaked.secondBakeDuration}
                                        </div>
                                        <div class="step-detail">
                                            <strong>ุงูุขููุฉ:</strong> ุงูุญุฑุงุฑุฉ ุงููุชุจููุฉ ุชุฌูู ุงูุนุฌูู ุชุฏุฑูุฌูุงู
                                        </div>
                                        <div class="step-tip">
                                            ๐ฌ ูุฐู ุงููุฑุญูุฉ ุชุฎูุถ Aw ูู ~0.40 ุฅูู <0.30ุ ููุง ูุถูู ูุฑูุดุฉ ุชุฏูู ุฃุณุงุจูุน
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="background: #ecfdf5; border: 2px solid #059669; border-radius: 8px; padding: 1rem; margin-top: 1rem;">
                                <div style="font-weight: bold; color: #059669; margin-bottom: 0.5rem;">
                                    โ ุงููุชูุฌุฉ ุงููุชููุนุฉ:
                                </div>
                                <ul style="color: #065f46; margin: 0; padding-right: 1.5rem;">
                                    <li>ูุฑูุดุฉ ุงุณุชุซูุงุฆูุฉ ุชุตุฏุฑ ุตูุชุงู ุนูุฏ ุงููุณุฑ</li>
                                    <li>ุทุจูุงุช ูุชูุดุฑุฉ ูุงุถุญุฉ ููุนูุงู</li>
                                    <li>ููู ุฐูุจู ุนููู ูุชุณุงูู</li>
                                    <li>ุนูุฑ ุชุฎุฒููู 30-45 ููู ูู ูุนุงุก ูุญูู</li>
                                    <li>Aw ููุงุฆู: ${recipe.profile.expectedAw}</li>
                                </ul>
                            </div>
                        </div>
                    `;
                }
                
                // ูุณู ุงูุชูุฑูุฑ ุงูุนููู
                html += `
                    <div class="card card-green">
                        <h3 class="subsection-title">๐ฌ ุงูุชูุฑูุฑ ุงูุนููู ุงููุชูุฏู</h3>
                        <div class="grid-2">
                            <div class="stat-card">
                                <div class="stat-icon">๐ก๏ธ</div>
                                <div class="stat-label">ูุดุงุท ุงููุงุก (Aw)</div>
                                <div class="stat-value">${recipe.scientificReport.waterActivity.value}</div>
                                <div class="text-sm text-gray-600 mt-1">${recipe.scientificReport.waterActivity.interpretation}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">๐</div>
                                <div class="stat-label">ุชููุน ุงูููุงู</div>
                                <div class="stat-value">${recipe.scientificReport.texturePrediction}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">๐ก๏ธ</div>
                                <div class="stat-label">ุงูุงุณุชูุฑุงุฑ</div>
                                <div class="stat-value">${recipe.scientificReport.stability}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">โ๏ธ</div>
                                <div class="stat-label">ุงููุซุงูุฉ</div>
                                <div class="stat-value">${recipe.analysis.density.toFixed(2)} ุฌู/ุณูยณ</div>
                            </div>
                        </div>
                    </div>
                `;
                
                // ุงูุชุนูููุงุช ุงูุนุงูุฉ
                html += `
                    <div class="card card-green">
                        <h3 class="subsection-title">๐ ุงูุชุนูููุงุช ุงูุนุงูุฉ ุงููุญุณูุฉ</h3>
                        <div class="step-card">
                            <div class="step-header">
                                <div class="step-number">2</div>
                                <div style="flex: 1;">
                                    <div class="step-action">ุงูุชุดููู ูุงูุชุจุฑูุฏ</div>
                                    <div class="step-detail">ุงุถุบุท ุงูุนุฌูู ูู ุงูุตูููุฉ ุจุดูู ูุชุณุงูู</div>
                                    <div class="step-detail">ุงุฎุฑู ุงูุณุทุญ ุจุงูุดููุฉ ูููุน ุงูุงูุชูุงุฎ</div>
                                    <div class="step-detail">ุจุฑุฏ ููุฏุฉ ุณุงุนุชูู ุนูู ุงูุฃูู</div>
                                    <div class="step-tip">๐ก ุงูุชุจุฑูุฏ ุงููุงูู ูููุน ุงูุชุดุงุฑ ุงูุนุฌูู ููุญุณู ุงูููุงู</div>
                                </div>
                            </div>
                        </div>
                        <div class="step-card">
                            <div class="step-header">
                                <div class="step-number">3</div>
                                <div style="flex: 1;">
                                    <div class="step-action">ุงูุฎุจุฒ</div>
                                    <div class="step-detail">ุงุฎุจุฒ ุนูู ุญุฑุงุฑุฉ ${recipe.analysis.optimalBaking}</div>
                                    <div class="step-detail">ุงูุญุต ุงูุญูุงู ุจุนุฏ 15 ุฏูููุฉ</div>
                                    <div class="step-detail">ุงูุชุธุฑ ุญุชู ุชุจุฑุฏ ุชูุงูุงู ูุจู ุงูุชูุทูุน</div>
                                    <div class="step-tip">๐ก ุงูุชุจุฑูุฏ ุงููุงูู ูุจู ุงูุชูุทูุน ูููุน ุงูุชูุณุฑ</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                container.innerHTML = html;
            }
            
            switchTab(tabName) {
                // ุฅุฎูุงุก ุฌููุน ุงููุญุชููุงุช
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.add('hidden');
                });
                
                // ุฅูุบุงุก ุชูุดูุท ุฌููุน ุงูุฃุฒุฑุงุฑ
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // ุฅุธูุงุฑ ุงููุญุชูู ุงููุทููุจ
                const targetScreen = document.getElementById(`${tabName}-screen`);
                if (targetScreen) {
                    targetScreen.classList.remove('hidden');
                }
                
                // ุชูุดูุท ุงูุฒุฑ ุงููุทููุจ
                const tabButton = document.querySelector(`[data-tab="${tabName}"]`);
                if (tabButton) {
                    tabButton.classList.add('active');
                }
                
                // ุชุญููู ูุญุชูู ุงูุชุจููุจ ุฅุฐุง ูุฒู
                this.loadTabContent(tabName);
            }
            
            loadTabContent(tabName) {
                switch(tabName) {
                    case 'setup':
                        this.validateAndWarn();
                        break;
                    case 'checkpoints':
                        this.renderCheckpoints();
                        break;
                    case 'troubleshoot':
                        this.renderTroubleshooting();
                        break;
                    case 'library':
                        this.renderLibrary();
                        break;
                    case 'analyzer':
                        this.initAnalyzer();
                        break;
                }
            }
            
            initAnalyzer() {
                // ุชุนุทูู ุฌููุน ุงูุญููู ูู ุงูุจุฏุงูุฉ
                const ingredients = ['flour', 'butter', 'sugar', 'rice-flour', 'cornstarch', 'salt'];
                ingredients.forEach(ingredient => {
                    const input = document.getElementById(ingredient);
                    if (input) {
                        input.disabled = true;
                        input.value = '';
                    }
                });
                
                // ุฅุนุงุฏุฉ ุชุนููู ุงูุชุญุฏูุฏุงุช
                currentMixingMethod = null;
                currentButterType = null;
                currentSugarType = null;
                
                // ุฅุฒุงูุฉ ุงูุชุญุฏูุฏ ูู ุฌููุน ุงูุฃุฒุฑุงุฑ
                document.querySelectorAll('#analyzer-screen .option-card').forEach(card => {
                    card.classList.remove('selected');
                });
                
                // ุฅุนุงุฏุฉ ุชุนููู ุงููุชุงุฆุฌ
                const resultsContainer = document.getElementById('manual-analysis-results');
                if (resultsContainer) {
                    resultsContainer.classList.add('hidden');
                    resultsContainer.innerHTML = '';
                }
                
                // ุฅุนุงุฏุฉ ุชุนููู checkboxes ุงูููููุงุช
                document.getElementById('has-flour').checked = false;
                document.getElementById('has-butter').checked = false;
                document.getElementById('has-sugar').checked = false;
                document.getElementById('has-rice-flour').checked = false;
                document.getElementById('has-cornstarch').checked = false;
                document.getElementById('has-salt').checked = false;
                
                // ุฅุนุงุฏุฉ ุชุนููู checkboxes ุงูุชูููุงุช
                document.getElementById('has-chilling').checked = false;
                document.getElementById('has-docking').checked = false;
                document.getElementById('has-twice-baked').checked = false;
                document.getElementById('has-vanilla').checked = false;
                
                // ุฅุนุงุฏุฉ ุชุนููู ุฅุนุฏุงุฏุงุช ุงูุฎุจุฒ
                document.getElementById('baking-temp').value = '';
                document.getElementById('baking-time').value = '';
            }
            
            renderCheckpoints() {
                const container = document.getElementById('checkpoints-list');
                const completedCount = document.getElementById('completed-count');
                const state = this.stateManager.state;
                
                if (!container) return;
                
                const checkpoints = this.recipeEngine.generateCheckpoints(state);
                const completed = state.completedCheckpoints || [];
                
                container.innerHTML = '';
                
                // ุชุญุฏูุซ ุงูุนุฏุงุฏ
                if (completedCount) {
                    completedCount.textContent = `${completed.length}/${checkpoints.length}`;
                }
                
                checkpoints.forEach((checkpoint, index) => {
                    const isCompleted = completed.includes(index);
                    
                    const checkpointElement = document.createElement('div');
                    checkpointElement.className = `checkpoint-card ${isCompleted ? 'completed' : ''}`;
                    checkpointElement.innerHTML = `
                        <div class="checkpoint-content">
                            <div class="checkpoint-header">
                                <button class="checkpoint-toggle ${isCompleted ? 'completed' : ''}" onclick="uiManager.toggleCheckpoint(${index})">
                                    ${isCompleted ? 'โ' : ''}
                                </button>
                                <div style="flex: 1;">
                                    <div class="checkpoint-timing">
                                        <span>โฐ</span>
                                        <span class="font-bold text-amber-700">${checkpoint.timing}</span>
                                    </div>
                                    <h3 class="checkpoint-title">${checkpoint.check}</h3>
                                    <div class="checkpoint-grid">
                                        <div class="checkpoint-target">
                                            <div class="font-semibold text-green-900 mb-2">๐ฏ ุงููุฏู:</div>
                                            <div class="text-green-800">${checkpoint.target}</div>
                                        </div>
                                        <div class="checkpoint-test">
                                            <div class="font-semibold text-blue-900 mb-2">๐ ุทุฑููุฉ ุงูุงุฎุชุจุงุฑ:</div>
                                            <div class="text-blue-800">${checkpoint.test}</div>
                                        </div>
                                    </div>
                                    <div class="checkpoint-why">
                                        <div class="font-semibold text-purple-900 mb-2">๐ฌ ููุงุฐุง ูุฐุง ููู:</div>
                                        <div class="text-purple-800">${checkpoint.whyItMatters}</div>
                                    </div>
                                    <div class="checkpoint-fix">
                                        <div class="font-semibold text-yellow-900 mb-2">๐ง ุงูุญู ุฅุฐุง ูุดู ุงูุงุฎุชุจุงุฑ:</div>
                                        <div class="text-yellow-800">${checkpoint.fix}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(checkpointElement);
                });
            }
            
            toggleCheckpoint(index) {
                let completed = this.stateManager.get('completedCheckpoints') || [];
                
                if (completed.includes(index)) {
                    completed = completed.filter(i => i !== index);
                } else {
                    completed.push(index);
                }
                
                this.stateManager.set('completedCheckpoints', completed);
                this.renderCheckpoints();
            }
            
            renderLibrary() {
                const recipeGrid = document.getElementById('recipe-grid');
                const emptyLibrary = document.getElementById('empty-library');
                const libraryCount = document.getElementById('library-count');
                const successRate = document.getElementById('success-rate');
                
                if (!recipeGrid || !emptyLibrary) return;
                
                const savedRecipes = this.getSavedRecipes();
                
                if (savedRecipes.length === 0) {
                    recipeGrid.classList.add('hidden');
                    emptyLibrary.classList.remove('hidden');
                    
                    if (libraryCount) libraryCount.textContent = '0';
                    if (successRate) successRate.textContent = '0%';
                    return;
                }
                
                recipeGrid.classList.remove('hidden');
                emptyLibrary.classList.add('hidden');
                
                if (libraryCount) libraryCount.textContent = savedRecipes.length;
                if (successRate) {
                    const ratedRecipes = savedRecipes.filter(r => r.rating);
                    const successRateValue = ratedRecipes.length > 0 ? 
                        Math.round((ratedRecipes.filter(r => r.rating.overall >= 4).length / ratedRecipes.length) * 100) : 0;
                    successRate.textContent = `${successRateValue}%`;
                }
                
                recipeGrid.innerHTML = savedRecipes.map(recipe => `
                    <div class="recipe-card" data-recipe-id="${recipe.id}">
                        <div class="recipe-header">
                            <h3 style="margin: 0;">${recipe.name}</h3>
                            <div class="recipe-meta">
                                <span class="date" style="color: var(--text-light); font-size: 0.875rem;">${new Date(recipe.timestamp).toLocaleDateString('ar-EG')}</span>
                                ${recipe.rating ? `
                                    <span class="rating" style="color: var(--primary-color); font-weight: bold;">
                                        ${'โ'.repeat(Math.round(recipe.rating.overall))}${'โ'.repeat(5-Math.round(recipe.rating.overall))}
                                    </span>
                                ` : ''}
                            </div>
                        </div>
                        <div class="recipe-preview">
                            <div class="preview-stats">
                                <span>โ๏ธ ${recipe.recipe.analysis.weight}ุบู</span>
                                <span>๐ฏ ${recipe.profile}</span>
                                ${recipe.rating ? `<span>โญ ${recipe.rating.overall}/5</span>` : ''}
                            </div>
                            <div class="recipe-actions">
                                <button class="btn" onclick="uiManager.loadRecipe('${recipe.id}')" style="background: var(--primary-color); color: white;">๐ ุงุณุชุนุงุฏู</button>
                                <button class="btn" onclick="uiManager.exportRecipe('${recipe.id}')" style="background: var(--secondary-color); color: white;">๐ค ุชุตุฏูุฑ</button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            
            getSavedRecipes() {
                try {
                    return JSON.parse(localStorage.getItem('shortbreadRecipes')) || [];
                } catch (error) {
                    console.error('Error loading saved recipes:', error);
                    return [];
                }
            }
            
            saveCurrentRecipe() {
                const recipe = this.stateManager.get('currentRecipe');
                if (!recipe) {
                    this.showNotification('โ๏ธ ูุฑุฌู ุญุณุงุจ ูุตูุฉ ุฃููุงู', 'error');
                    return;
                }
                
                const recipeName = prompt('ุฃุฏุฎู ุงุณู ูููุตูุฉ:', `ูุตูุฉ ุดูุฑุช ุจุฑูุฏ ${new Date().toLocaleDateString('ar-EG')}`);
                if (!recipeName) return;
                
                const savedRecipe = {
                    id: 'recipe_' + Date.now(),
                    name: recipeName,
                    timestamp: new Date().toISOString(),
                    state: JSON.parse(JSON.stringify(this.stateManager.state)),
                    recipe: JSON.parse(JSON.stringify(recipe)),
                    profile: recipe.profile.name
                };
                
                const savedRecipes = this.getSavedRecipes();
                savedRecipes.unshift(savedRecipe);
                
                try {
                    localStorage.setItem('shortbreadRecipes', JSON.stringify(savedRecipes));
                    this.showNotification('โ ุชู ุญูุธ ุงููุตูุฉ ุจูุฌุงุญ ูู ููุชุจุชู!');
                    this.renderLibrary();
                    
                    // ุนุฑุถ ุฎูุงุฑ ุงูุชูููู ุจุนุฏ ุญูุธ ุงููุตูุฉ
                    setTimeout(() => {
                        this.showRatingPrompt(savedRecipe.id);
                    }, 1000);
                } catch (error) {
                    this.showNotification('โ ุฎุทุฃ ูู ุญูุธ ุงููุตูุฉ - ูุฏ ูููู ุงูุชุฎุฒูู ููุชูุฆุงู', 'error');
                    console.error('Error saving recipe:', error);
                }
            }
            
            showRatingPrompt(recipeId) {
                const rating = prompt(`ููู ุชููู ูุฐู ุงููุตูุฉุ

โญ โญ โญ โญ โญ (ููุชุงุฒ)
โญ โญ โญ โญ (ุฌูุฏ ุฌุฏุงู)  
โญ โญ โญ (ุฌูุฏ)
โญ โญ (ููุจูู)
โญ (ุถุนูู)

ุฃุฏุฎู ุชููููู ูู 1 ุฅูู 5:`);
                
                if (rating && !isNaN(rating) && rating >= 1 && rating <= 5) {
                    this.rateRecipe(recipeId, parseInt(rating));
                }
            }
            
            rateRecipe(recipeId, rating) {
                const savedRecipes = this.getSavedRecipes();
                const recipe = savedRecipes.find(r => r.id === recipeId);
                
                if (recipe) {
                    recipe.rating = {
                        overall: rating,
                        texture: null,
                        flavor: null,
                        ease: null,
                        timestamp: new Date().toISOString()
                    };
                    
                    localStorage.setItem('shortbreadRecipes', JSON.stringify(savedRecipes));
                    this.showNotification(`โ ุชู ุญูุธ ุชููููู: ${rating}/5`);
                    this.renderLibrary();
                }
            }
            
            loadRecipe(recipeId) {
                const savedRecipes = this.getSavedRecipes();
                const recipe = savedRecipes.find(r => r.id === recipeId);
                
                if (recipe) {
                    this.stateManager.update(recipe.state);
                    this.stateManager.set('currentRecipe', recipe.recipe);
                    
                    // ุชุญุฏูุซ ุงููุงุฌูุฉ
                    this.updateUIFromState();
                    this.renderRecipe();
                    this.switchTab('recipe');
                    
                    this.showNotification(`โ ุชู ุชุญููู ุงููุตูุฉ: ${recipe.name}`);
                }
            }
            
            updateUIFromState() {
                const state = this.stateManager.state;
                
                // ุชุญุฏูุซ ุงุฎุชูุงุฑุงุช ุงูููุงู
                document.querySelectorAll('[id^="texture-"]').forEach(el => {
                    el.classList.remove('selected');
                });
                document.getElementById(`texture-${state.textureType}`)?.classList.add('selected');
                
                // ุชุญุฏูุซ ุงุฎุชูุงุฑุงุช ุงูุฒุจุฏุฉ
                document.querySelectorAll('[id^="butter-"]').forEach(el => {
                    el.classList.remove('selected');
                });
                document.getElementById(`butter-${state.butterType}`)?.classList.add('selected');
                
                // ุชุญุฏูุซ ุงูุฎูุงุฑุงุช ุงูุฅุถุงููุฉ
                document.getElementById('use-rice-flour').checked = state.useRiceFlour;
                document.getElementById('use-cornstarch').checked = state.useCornstarch;
                
                // ุชุญุฏูุซ ุทุฑููุฉ ุงูุฎูุท (ูู ูุถุน ุงูุฎุจูุฑ)
                if (state.mode === 'expert' && state.mixingMethod) {
                    document.querySelectorAll('#mixing-method-section .option-card').forEach(card => {
                        card.classList.remove('selected');
                    });
                    const selectedCard = document.querySelector(`[data-method="${state.mixingMethod}"]`);
                    if (selectedCard) selectedCard.classList.add('selected');
                }
                
                // ุชุญุฏูุซ ุงูุฃุจุนุงุฏ
                document.getElementById('pan-shape').value = state.panShape;
                document.getElementById('pan-length').value = state.dimensions.length;
                document.getElementById('pan-width').value = state.dimensions.width;
                document.getElementById('pan-diameter').value = state.dimensions.diameter;
                document.getElementById('pan-height').value = state.height;
                
                this.updateDimensions();
                this.validateAndWarn();
            }
            
            exportRecipe(recipeId) {
                const savedRecipes = this.getSavedRecipes();
                const recipe = savedRecipes.find(r => r.id === recipeId);
                
                if (recipe) {
                    const dataStr = JSON.stringify(recipe, null, 2);
                    const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
                    
                    const link = document.createElement('a');
                    link.setAttribute('href', dataUri);
                    link.setAttribute('download', `shortbread_recipe_${recipe.id}.json`);
                    link.style.display = 'none';
                    
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    this.showNotification('โ ุชู ุชุตุฏูุฑ ุงููุตูุฉ ุจูุฌุงุญ');
                }
            }
            
            exportAllData() {
                const savedRecipes = this.getSavedRecipes();
                const exportData = {
                    recipes: savedRecipes,
                    exportInfo: {
                        version: '2.0',
                        exportedAt: new Date().toISOString(),
                        totalRecipes: savedRecipes.length,
                        appName: 'ูููุฏุณ ุงูุดูุฑุช ุจุฑูุฏ ุงูุนููู ุงููุญุณู'
                    }
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
                
                const link = document.createElement('a');
                link.setAttribute('href', dataUri);
                link.setAttribute('download', `shortbread_backup_${Date.now()}.json`);
                link.style.display = 'none';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                this.showNotification('โ ุชู ุชุตุฏูุฑ ุฌููุน ุงูุจูุงูุงุช ุจูุฌุงุญ');
            }
            
            renderTroubleshooting() {
                const container = document.getElementById('troubleshoot-list');
                if (!container) return;
                
                const issues = [
                    {
                        problem: 'ุงูุชุดุฑ ุจุดูู ููุฑุท (ุฃุตุจุญ ุฑูููุงู ุฌุฏุงู)',
                        severity: 'ุนุงููุฉ',
                        diagnosis: {
                            cause: 'ุงูุฒุจุฏุฉ ูุงูุช ุฏุงูุฆุฉ ุฌุฏุงู ุฃู ุทุฑููุฉ ุงูุฎูุท ุบูุฑ ููุงุณุจุฉ',
                            scientific: `ุฏุฑุฌุฉ ุญุฑุงุฑุฉ ุงูุฒุจุฏุฉ ุบูุฑ ููุงุณุจุฉ ูุทุฑููุฉ ุงูุฎูุท ุงููุฎุชุงุฑุฉ ุฃู ููุน ุงูุฒุจุฏุฉ`,
                            howToKnow: 'ูุทุฑ ุงููุทุนุฉ >5% ุฃูุจุฑ ูู ุงูุตูููุฉ'
                        },
                        prevention: {
                            title: '๐ก๏ธ ุงูููุงูุฉ (ูููุฑุฉ ุงููุงุฏูุฉ):',
                            steps: [
                                'ุงุณุชุฎุฏู ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ ุงูููุงุณุจุฉ ูุทุฑููุฉ ุงูุฎูุท',
                                'ุจุฑุฏ ุงูุนุฌูู 4 ุณุงุนุงุช ุนูู ุงูุฃูู',
                                'ุงุณุชุฎุฏู ุฒุจุฏุฉ ุฃูุฑูุจูุฉ (ุฃูู ูุงุก = ุฃูู ุงูุชุดุงุฑ)',
                                'ุชุญูู ูู ููุน ุงูุฒุจุฏุฉ ุงููุณุชุฎุฏู'
                            ]
                        },
                        realTimeFix: {
                            title: '๐จ ุงูุฅููุงุฐ ุงูููุฑู:',
                            ifNotBaked: 'ุถุน ุงูุตูููุฉ ูู ุงููุฑูุฒุฑ 20 ุฏูููุฉ',
                            ifBaking: 'ุฎููุถ ุงูุญุฑุงุฑุฉ 10ยฐูุ ุฃููู ุงูุฎุจุฒ',
                            ifDone: 'ุงุณุชุฎุฏูู ููุงุนุฏุฉ ุชุงุฑุช'
                        }
                    },
                    {
                        problem: 'ูุงุณู ูููุณ ูุดุงู (ูุดุจู ุงูุจุณูููุช ุงูุนุงุฏู)',
                        severity: 'ูุชูุณุทุฉ',
                        diagnosis: {
                            cause: 'ุชุทูุฑ ุงูุบููุชูู - ุงูุฎูุท ุงูุฒุงุฆุฏ ุฃู ููุน ุงูุฒุจุฏุฉ ุบูุฑ ุงูููุงุณุจ',
                            scientific: 'ุงูุฎูุท ุงูุฒุงุฆุฏ ูุคุฏู ุฅูู ุชูููู ุดุจูุฉ ุบููุชูู ูููุฉ - ุงูุฒุจุฏุฉ ุงููุจุงุชูุฉ ูุฏ ุชุณุจุจ ุฐูู',
                            howToKnow: 'ุตุนุจ ุงููุณุฑุ ูุญุชุงุฌ ููุฉุ ููุซูู ููููุงู ูุจู ุงููุณุฑ'
                        },
                        prevention: {
                            title: '๐ก๏ธ ุงูููุงูุฉ:',
                            steps: [
                                'ุงุฎูุท ููุท ุญุชู ูุฎุชูู ุงูุฏููู',
                                'ุงุณุชุฎุฏู ุงูุทุฑููุฉ ุงูููุงุณุจุฉ ููููุงู ุงููุทููุจ',
                                'ูุง ุชุนุฌู ุฃู ุชุถุบุท ูุซูุฑุงู',
                                'ุงุฎุชุฑ ููุน ุงูุฒุจุฏุฉ ุงูููุงุณุจ ููููุงู ุงููุทููุจ'
                            ]
                        },
                        realTimeFix: {
                            title: '๐จ ุงูุฅููุงุฐ:',
                            ifNotBaked: 'ูุง ูููู ุงูุฅุตูุงุญ - ุงูุบููุชูู ุชูููู ุจุงููุนู',
                            ifBaking: 'ูุง ุดูุก ูููู ูุนูู',
                            ifDone: 'ุงุบูุณู ูู ุงูุดุงู/ูููุฉ - ูุตุจุญ ุฃูุฐ'
                        }
                    },
                    {
                        problem: 'ุฌุงู ุฌุฏุงู ููุชูุชุช',
                        severity: 'ูุชูุณุทุฉ',
                        diagnosis: {
                            cause: 'ูุณุจุฉ ุงูุฒุจุฏุฉ ููููุฉ ุฃู ููุน ุงูุฒุจุฏุฉ ุบูุฑ ููุงุณุจ',
                            scientific: 'ููุต ุงูุฏููู ูุคุฏู ุฅูู ุฌูุงู ุงูุนุฌูู - ุงูุฒุจุฏุฉ ุงููุจุงุชูุฉ ูุฏ ุชุณุจุจ ุงูุฌูุงู',
                            howToKnow: 'ูุชูุชุช ุนูุฏ ุงูุชูุงุทูุ ุฌุงู ุงููููุณ'
                        },
                        prevention: {
                            title: '๐ก๏ธ ุงูููุงูุฉ:',
                            steps: [
                                'ุชุฃูุฏ ูู ูุณุจุฉ ุงูุฒุจุฏุฉ ุงูุตุญูุญุฉ',
                                'ุงุณุชุฎุฏู ุฒุจุฏุฉ ุนุงููุฉ ุงูุฏุณู',
                                'ุฃุถู ุงููููู ูู ุงูุณุงุฆู ุฅุฐุง ูุฒู ุงูุฃูุฑ',
                                'ุงุฎุชุจุฑ ุงูุนุฌูู ูุจู ุงูุฎุจุฒ'
                            ]
                        },
                        realTimeFix: {
                            title: '๐จ ุงูุฅููุงุฐ:',
                            ifNotBaked: 'ุฃุถู ุงููููู ูู ุงูุฒุจุฏุฉ ุงููุฐุงุจุฉ',
                            ifBaking: 'ุฑุด ุงููููู ูู ุงููุงุก ุนูู ุงูุณุทุญ',
                            ifDone: 'ูุฏูู ูุน ุงูุตูุตุฉ ุฃู ุงููุฑูู'
                        }
                    }
                ];
                
                container.innerHTML = issues.map((issue, index) => `
                    <div class="issue-card" style="border: 2px solid #f87171; border-radius: 12px; background: #fef2f2; margin-bottom: 1rem; overflow: hidden;">
                        <div class="issue-header" style="width: 100%; padding: 1.5rem; display: flex; align-items: center; justify-content: space-between; background: #fef2f2; border: none; cursor: pointer;">
                            <div class="issue-main" style="display: flex; align-items: center; gap: 1rem; text-align: right;">
                                <div class="issue-icon" style="font-size: 3rem;">โ</div>
                                <div>
                                    <h3 class="issue-title" style="font-size: 1.25rem; font-weight: bold; color: #dc2626; margin: 0;">${issue.problem}</h3>
                                    <div class="issue-severity" style="display: inline-block; background: #dc2626; color: white; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.875rem; font-weight: 600; margin-top: 0.5rem;">
                                        ุฎุทูุฑุฉ ${issue.severity}
                                    </div>
                                </div>
                            </div>
                            <div class="issue-arrow" style="font-size: 1.5rem; transition: transform 0.3s;">โผ</div>
                        </div>
                        <div class="issue-content" style="display: none; padding: 0 1.5rem 1.5rem;">
                            <div class="diagnosis-section" style="background: white; padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem;">
                                <h4 style="color: #dc2626; margin-bottom: 1rem;">๐ ุงูุชุดุฎูุต ุงูุนููู ุงููุญุณู</h4>
                                <div class="grid-3">
                                    <div class="diagnosis-item" style="background: #fef3c7; padding: 1rem; border-radius: 8px;">
                                        <div class="diagnosis-label" style="font-weight: bold; color: #d97706;">ุงูุณุจุจ ุงููุญุชูู</div>
                                        <div class="diagnosis-value" style="color: #92400e;">${issue.diagnosis.cause}</div>
                                    </div>
                                    <div class="diagnosis-item" style="background: #dbeafe; padding: 1rem; border-radius: 8px;">
                                        <div class="diagnosis-label" style="font-weight: bold; color: #1e40af;">ุงูุณุจุจ ุงูุนููู</div>
                                        <div class="diagnosis-value" style="color: #1e3a8a;">${issue.diagnosis.scientific}</div>
                                    </div>
                                    <div class="diagnosis-item" style="background: #dcfce7; padding: 1rem; border-radius: 8px;">
                                        <div class="diagnosis-label" style="font-weight: bold; color: #059669;">ููู ุชุนุฑู</div>
                                        <div class="diagnosis-value" style="color: #065f46;">${issue.diagnosis.howToKnow}</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="prevention-section" style="background: #ecfdf5; padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem;">
                                <h4 style="color: #059669; margin-bottom: 1rem;">${issue.prevention.title}</h4>
                                <ul style="list-style-type: none; padding: 0; margin: 0;">
                                    ${issue.prevention.steps.map(step => `
                                        <li style="margin-bottom: 0.5rem; padding-right: 1.5rem; position: relative;">
                                            <span style="position: absolute; right: 0; top: 0;">โ</span>
                                            ${step}
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                            
                            <div class="fix-section" style="background: #fef3c7; padding: 1.5rem; border-radius: 8px;">
                                <h4 style="color: #d97706; margin-bottom: 1rem;">${issue.realTimeFix.title}</h4>
                                <div class="grid-3">
                                    <div class="fix-item" style="background: white; padding: 1rem; border-radius: 8px;">
                                        <div class="fix-label" style="font-weight: bold; color: #d97706;">ุฅุฐุง ูู ููุฎุจุฒ ุจุนุฏ</div>
                                        <div class="fix-value" style="color: #92400e;">${issue.realTimeFix.ifNotBaked}</div>
                                    </div>
                                    <div class="fix-item" style="background: white; padding: 1rem; border-radius: 8px;">
                                        <div class="fix-label" style="font-weight: bold; color: #d97706;">ุฅุฐุง ูุงู ูุฎุจุฒ ุงูุขู</div>
                                        <div class="fix-value" style="color: #92400e;">${issue.realTimeFix.ifBaking}</div>
                                    </div>
                                    <div class="fix-item" style="background: white; padding: 1rem; border-radius: 8px;">
                                        <div class="fix-label" style="font-weight: bold; color: #d97706;">ุฅุฐุง ุงูุชูู ุงูุฎุจุฒ</div>
                                        <div class="fix-value" style="color: #92400e;">${issue.realTimeFix.ifDone}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                // ุฅุถุงูุฉ ุฃุญุฏุงุซ ุงูููุฑ ููุจุทุงูุงุช
                document.querySelectorAll('.issue-header').forEach(header => {
                    header.addEventListener('click', function() {
                        const content = this.nextElementSibling;
                        const arrow = this.querySelector('.issue-arrow');
                        
                        if (content.style.display === 'none') {
                            content.style.display = 'block';
                            arrow.style.transform = 'rotate(180deg)';
                        } else {
                            content.style.display = 'none';
                            arrow.style.transform = 'rotate(0deg)';
                        }
                    });
                });
            }
            
            addTooltips() {
                const tooltips = [
                    {
                        selector: '#use-rice-flour',
                        text: 'ุฏููู ุงูุฃุฑุฒ ูุฒูุฏ ุงููุฑูุดุฉ ุจูุณุจุฉ 30% - ููุตู ุจู ููููุงู ุงูููุฑูุด ููุท'
                    },
                    {
                        selector: '#use-cornstarch',
                        text: 'ูุดุง ุงูุฐุฑุฉ ูุญุณู ุงูุทุฑุงูุฉ - ููุตู ุจู ููููุงู ุงูุทุฑู ููุท'
                    },
                    {
                        selector: '#pan-height',
                        text: 'ุงููุทุงู ุงููุซุงูู: 1.0-2.0 ุณู - ูุคุซุฑ ุนูู ููุช ุงูุฎุจุฒ ูุงูููุงู'
                    }
                ];
                
                tooltips.forEach(tooltip => {
                    const element = document.querySelector(tooltip.selector);
                    if (element) {
                        element.setAttribute('title', tooltip.text);
                    }
                });
            }
            
            showNotification(message, type = 'info') {
                // ุฅุฒุงูุฉ ุฃู ุฅุดุนุงุฑุงุช ุณุงุจูุฉ
                document.querySelectorAll('.notification').forEach(n => n.remove());
                
                const notification = document.createElement('div');
                notification.className = 'notification';
                notification.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span style="font-size: 1.25rem;">${type === 'error' ? 'โ' : type === 'warning' ? 'โ๏ธ' : 'โ'}</span>
                        <span>${message}</span>
                    </div>
                `;
                
                notification.style.background = type === 'error' ? '#dc2626' : 
                                              type === 'warning' ? '#d97706' : '#059669';
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 3000);
            }
            
            showLoading() {
                // ูููู ุฅุถุงูุฉ ูุคุดุฑ ุชุญููู ููุง ุฅุฐุง ูุฒู
            }
            
            hideLoading() {
                // ุฅุฎูุงุก ูุคุดุฑ ุงูุชุญููู
            }
            
            handleStateChange(key, value) {
                switch(key) {
                    case 'mode':
                        this.updateModeDisplay();
                        break;
                    case 'textureType':
                        this.validateAndWarn();
                        break;
                    case 'butterType':
                        this.validateAndWarn();
                        break;
                    case 'mixingMethod':
                        this.validateAndWarn();
                        break;
                }
            }
        }

        // =============================================
        // ุฏูุงู ูุญูู ุงููุตูุงุช ุงููุฏูู - ุงููุตุญุญุฉ
        // =============================================

        let currentMixingMethod = null;
        let currentButterType = null;
        let currentSugarType = null;

        function toggleInput(ingredient) {
            const checkbox = document.getElementById(`has-${ingredient}`);
            const input = document.getElementById(ingredient);
            
            if (checkbox.checked) {
                input.disabled = false;
                input.focus();
            } else {
                input.disabled = true;
                input.value = '';
            }
        }

        function selectAnalyzerMixingMethod(method, element) {
            currentMixingMethod = method;
            
            // ุฅุฒุงูุฉ ุงูุชุญุฏูุฏ ูู ุฌููุน ุฃุฒุฑุงุฑ ุทุฑููุฉ ุงูุฎูุท
            document.querySelectorAll('#analyzer-screen .option-card').forEach(card => {
                const parentCard = card.closest('.card');
                if (parentCard && parentCard.querySelector('.subsection-title').textContent.includes('ุทุฑููุฉ ุงูุฎูุท')) {
                    card.classList.remove('selected');
                }
            });
            
            element.classList.add('selected');
        }

        function selectAnalyzerButterType(type, element) {
            currentButterType = type;
            
            // ุฅุฒุงูุฉ ุงูุชุญุฏูุฏ ูู ุฌููุน ุฃุฒุฑุงุฑ ููุน ุงูุฒุจุฏุฉ
            document.querySelectorAll('#analyzer-screen .option-card').forEach(card => {
                const parentCard = card.closest('.card');
                if (parentCard && parentCard.querySelector('.subsection-title').textContent.includes('ููุน ุงูุฒุจุฏุฉ')) {
                    card.classList.remove('selected');
                }
            });
            
            element.classList.add('selected');
        }

        function selectAnalyzerSugarType(type, element) {
            currentSugarType = type;
            
            // ุฅุฒุงูุฉ ุงูุชุญุฏูุฏ ูู ุฌููุน ุฃุฒุฑุงุฑ ููุน ุงูุณูุฑ
            document.querySelectorAll('#analyzer-screen .option-card').forEach(card => {
                const parentCard = card.closest('.card');
                if (parentCard && parentCard.querySelector('.subsection-title').textContent.includes('ููุน ุงูุณูุฑ')) {
                    card.classList.remove('selected');
                }
            });
            
            element.classList.add('selected');
        }

        function analyzeManualRecipe() {
            // ุฌูุน ุงูุจูุงูุงุช ูู ุงูุญููู
            const ingredients = {
                flour: document.getElementById('flour').value ? parseInt(document.getElementById('flour').value) : null,
                butter: document.getElementById('butter').value ? parseInt(document.getElementById('butter').value) : null,
                sugar: document.getElementById('sugar').value ? parseInt(document.getElementById('sugar').value) : null,
                riceFlour: document.getElementById('rice-flour').value ? parseInt(document.getElementById('rice-flour').value) : null,
                cornstarch: document.getElementById('cornstarch').value ? parseInt(document.getElementById('cornstarch').value) : null,
                salt: document.getElementById('salt').value ? parseFloat(document.getElementById('salt').value) : null
            };
            
            const baking = {
                temperature: document.getElementById('baking-temp').value ? parseInt(document.getElementById('baking-temp').value) : null,
                time: document.getElementById('baking-time').value ? parseInt(document.getElementById('baking-time').value) : null
            };
            
            const techniques = {
                chilling: document.getElementById('has-chilling').checked,
                docking: document.getElementById('has-docking').checked,
                twiceBaked: document.getElementById('has-twice-baked').checked,
                vanilla: document.getElementById('has-vanilla').checked
            };
            
            // ุงูุชุญูู ูู ุงููุฏุฎูุงุช ุงูุฃุณุงุณูุฉ
            if (!ingredients.flour || !ingredients.butter) {
                uiManager.showNotification('โ๏ธ ูุฑุฌู ุฅุฏุฎุงู ูููุงุช ุงูุฏููู ูุงูุฒุจุฏุฉ ุนูู ุงูุฃูู', 'error');
                return;
            }
            
            if (!currentMixingMethod) {
                uiManager.showNotification('โ๏ธ ูุฑุฌู ุชุญุฏูุฏ ุทุฑููุฉ ุงูุฎูุท ุงููุณุชุฎุฏูุฉ', 'error');
                return;
            }
            
            // ุฅุฌุฑุงุก ุงูุชุญููู
            const analysis = analyzeRecipeData(ingredients, baking, techniques, currentMixingMethod, currentButterType, currentSugarType);
            displayManualAnalysisResults(analysis);
        }

        function analyzeRecipeData(ingredients, baking, techniques, mixingMethod, butterType, sugarType) {
            const analysis = {
                score: 0,
                strengths: [],
                weaknesses: [],
                recommendations: [],
                scientificAnalysis: [],
                ratios: {},
                texturePrediction: '',
                stability: '',
                waterActivity: '',
                profileMatch: '',
                detailedRatios: {},
                idealRanges: {}
            };
            
            // ุญุณุงุจ ุงููุณุจ ุงูุฃุณุงุณูุฉ
            const totalFlour = ingredients.flour + (ingredients.riceFlour || 0) + (ingredients.cornstarch || 0);
            
            analysis.ratios = {
                butterToFlour: ingredients.butter / totalFlour,
                sugarToFlour: ingredients.sugar ? ingredients.sugar / totalFlour : null,
                riceFlourRatio: ingredients.riceFlour ? ingredients.riceFlour / totalFlour : 0,
                cornstarchRatio: ingredients.cornstarch ? ingredients.cornstarch / totalFlour : 0,
                saltRatio: ingredients.salt ? ingredients.salt / totalFlour : 0
            };
        
            // ุงููุณุจ ุงููุซุงููุฉ ููู ููุน ููุงู
            analysis.idealRanges = {
                tender: {
                    butterToFlour: { min: 0.75, max: 0.95, ideal: 0.85 },
                    sugarToFlour: { min: 0.25, max: 0.40, ideal: 0.32 },
                    saltRatio: { min: 0.008, max: 0.012, ideal: 0.01 }
                },
                traditional: {
                    butterToFlour: { min: 0.60, max: 0.80, ideal: 0.70 },
                    sugarToFlour: { min: 0.30, max: 0.50, ideal: 0.40 },
                    saltRatio: { min: 0.008, max: 0.015, ideal: 0.012 }
                },
                crispy: {
                    butterToFlour: { min: 0.50, max: 0.70, ideal: 0.60 },
                    sugarToFlour: { min: 0.35, max: 0.55, ideal: 0.45 },
                    saltRatio: { min: 0.010, max: 0.018, ideal: 0.015 }
                }
            };
        
            // ุชุญุฏูุฏ ุงูุจุฑููุงูู ุงูููุงุณุจ ุจูุงุก ุนูู ุงูููููุงุช ูุงูุชูููุงุช
            const detectedProfile = detectProfileFromIngredients(analysis.ratios, mixingMethod, sugarType, baking.temperature);
            const ideal = analysis.idealRanges[detectedProfile.type];
            
            analysis.detectedProfile = detectedProfile;
            analysis.detectedProfileType = detectedProfile.type;
        
            // ุชุญููู ูุณุจุฉ ุงูุฒุจุฏุฉ ุฅูู ุงูุฏููู ุจุฏูุฉ
            const butterRatio = analysis.ratios.butterToFlour;
            const butterDeviation = Math.abs(butterRatio - ideal.butterToFlour.ideal) / ideal.butterToFlour.ideal;
            
            if (butterDeviation <= 0.1) {
                analysis.score += 30;
                analysis.strengths.push(`ูุณุจุฉ ุงูุฒุจุฏุฉ ููุชุงุฒุฉ (${(butterRatio * 100).toFixed(1)}%) - ูุซุงููุฉ ููููุงู ${detectedProfile.name}`);
            } else if (butterDeviation <= 0.2) {
                analysis.score += 20;
                analysis.strengths.push(`ูุณุจุฉ ุงูุฒุจุฏุฉ ุฌูุฏุฉ (${(butterRatio * 100).toFixed(1)}%) - ููุงุณุจุฉ ููููุงู ${detectedProfile.name}`);
            } else {
                if (butterRatio < ideal.butterToFlour.min) {
                    analysis.score += 10;
                    const neededButter = Math.round((ideal.butterToFlour.ideal - butterRatio) * totalFlour);
                    analysis.weaknesses.push(`ูุณุจุฉ ุงูุฒุจุฏุฉ ููุฎูุถุฉ (${(butterRatio * 100).toFixed(1)}%) - ุชุญุชุงุฌ +${neededButter}ุฌุฑุงู ุฒุจุฏุฉ`);
                    analysis.recommendations.push(`ุฃุถู ${neededButter} ุฌุฑุงู ุฒุจุฏุฉ ูููุตูู ุฅูู ุงููุณุจุฉ ุงููุซุงููุฉ (${(ideal.butterToFlour.ideal * 100).toFixed(1)}%)`);
                } else {
                    analysis.score += 15;
                    const excessButter = Math.round((butterRatio - ideal.butterToFlour.ideal) * totalFlour);
                    analysis.weaknesses.push(`ูุณุจุฉ ุงูุฒุจุฏุฉ ูุฑุชูุนุฉ (${(butterRatio * 100).toFixed(1)}%) - ูููู ุชูููู ${excessButter}ุฌุฑุงู`);
                    analysis.recommendations.push(`ููู ${excessButter} ุฌุฑุงู ุฒุจุฏุฉ ูููุตูู ุฅูู ุงููุณุจุฉ ุงููุซุงููุฉ (${(ideal.butterToFlour.ideal * 100).toFixed(1)}%)`);
                }
            }
        
            // ุชุญููู ูุณุจุฉ ุงูุณูุฑ ุจุฏูุฉ
            if (analysis.ratios.sugarToFlour) {
                const sugarRatio = analysis.ratios.sugarToFlour;
                const sugarDeviation = Math.abs(sugarRatio - ideal.sugarToFlour.ideal) / ideal.sugarToFlour.ideal;
                
                if (sugarDeviation <= 0.15) {
                    analysis.score += 20;
                    analysis.strengths.push(`ูุณุจุฉ ุงูุณูุฑ ูุชูุงุฒูุฉ (${(sugarRatio * 100).toFixed(1)}%) - ${sugarType === 'powdered' ? 'ุจูุฏุฑุฉ' : 'ูุญุจุจ'}`);
                } else {
                    if (sugarRatio < ideal.sugarToFlour.min) {
                        analysis.score += 10;
                        const neededSugar = Math.round((ideal.sugarToFlour.ideal - sugarRatio) * totalFlour);
                        analysis.weaknesses.push(`ูุณุจุฉ ุงูุณูุฑ ููุฎูุถุฉ (${(sugarRatio * 100).toFixed(1)}%) - ุชุญุชุงุฌ +${neededSugar}ุฌุฑุงู ุณูุฑ`);
                        analysis.recommendations.push(`ุฃุถู ${neededSugar} ุฌุฑุงู ุณูุฑ ${sugarType === 'powdered' ? 'ุจูุฏุฑุฉ' : 'ูุญุจุจ'} ููุชุญููุฉ ุงููุชูุงุฒูุฉ`);
                    } else {
                        analysis.score += 15;
                        const excessSugar = Math.round((sugarRatio - ideal.sugarToFlour.ideal) * totalFlour);
                        analysis.weaknesses.push(`ูุณุจุฉ ุงูุณูุฑ ูุฑุชูุนุฉ (${(sugarRatio * 100).toFixed(1)}%) - ูููู ุชูููู ${excessSugar}ุฌุฑุงู`);
                        analysis.recommendations.push(`ููู ${excessSugar} ุฌุฑุงู ุณูุฑ ูุชุฌูุจ ุงูุญูุงูุฉ ุงูููุฑุทุฉ`);
                    }
                }
        
                // ุชุญููู ููุน ุงูุณูุฑ vs ุงูููุงู
                if (sugarType === 'powdered' && detectedProfile.type === 'tender') {
                    analysis.score += 5;
                    analysis.strengths.push('ุงูุณูุฑ ุงูุจูุฏุฑุฉ ูุซุงูู ููููุงู ุงูุทุฑู ุงูุฐู ูุฐูุจ ูู ุงููู');
                } else if (sugarType === 'granulated' && detectedProfile.type === 'crispy') {
                    analysis.score += 5;
                    analysis.strengths.push('ุงูุณูุฑ ุงููุญุจุจ ูุนุฒุฒ ุงููุฑูุดุฉ ูุงูููุงู ุงููุชูุดุฑ');
                }
            }
        
            // ุชุญููู ุงูููุญ ุจุฏูุฉ
            if (analysis.ratios.saltRatio) {
                const saltRatio = analysis.ratios.saltRatio;
                if (saltRatio >= ideal.saltRatio.min && saltRatio <= ideal.saltRatio.max) {
                    analysis.score += 10;
                    analysis.strengths.push(`ูุณุจุฉ ุงูููุญ ูุชูุงุฒูุฉ (${(saltRatio * 100).toFixed(2)}%)`);
                } else {
                    if (saltRatio < ideal.saltRatio.min) {
                        analysis.score += 5;
                        const neededSalt = Math.round((ideal.saltRatio.ideal - saltRatio) * totalFlour * 1000) / 1000;
                        analysis.weaknesses.push(`ูุณุจุฉ ุงูููุญ ููุฎูุถุฉ (${(saltRatio * 100).toFixed(2)}%) - ุชุญุชุงุฌ +${(neededSalt * 1000).toFixed(1)}ููุฌุฑุงู`);
                        analysis.recommendations.push(`ุฃุถู ${(neededSalt * 1000).toFixed(1)} ููุฌุฑุงู ููุญ ูุชุนุฒูุฒ ุงููููุฉ`);
                    } else {
                        analysis.score += 5;
                        const excessSalt = Math.round((saltRatio - ideal.saltRatio.ideal) * totalFlour * 1000) / 1000;
                        analysis.weaknesses.push(`ูุณุจุฉ ุงูููุญ ูุฑุชูุนุฉ (${(saltRatio * 100).toFixed(2)}%) - ูููู ุชูููู ${(excessSalt * 1000).toFixed(1)}ููุฌุฑุงู`);
                        analysis.recommendations.push(`ููู ${(excessSalt * 1000).toFixed(1)} ููุฌุฑุงู ููุญ ูุชุฌูุจ ุงููููุญุฉ ุงูุฒุงุฆุฏุฉ`);
                    }
                }
            }
        
            // ุชุญููู ุทุฑููุฉ ุงูุฎูุท
            analysis.score += 20;
            if (mixingMethod === 'creaming' && detectedProfile.type === 'tender') {
                analysis.strengths.push('โ ุทุฑููุฉ ุงูุฎูู (Creaming) ูุซุงููุฉ ููููุงู ุงูุทุฑู');
                analysis.texturePrediction = 'ููุงู ุทุฑู ูุฐูุจ ูู ุงููู ูุน ูุนููุฉ ุงุณุชุซูุงุฆูุฉ';
            } else if (mixingMethod === 'sablage' && detectedProfile.type === 'crispy') {
                analysis.strengths.push('โ ุทุฑููุฉ ุงููุฑู (Sablage) ูุซุงููุฉ ููููุงู ุงูููุฑูุด');
                analysis.texturePrediction = 'ููุงู ููุฑูุด ูุชูุดุฑ ูุน ุทุจูุงุช ูุงุถุญุฉ';
            } else if (mixingMethod === 'sablage' && detectedProfile.type === 'tender') {
                analysis.weaknesses.push('โ๏ธ ุทุฑููุฉ ุงููุฑู ูุฏ ุชูุชุฌ ููุงูุงู ุฃูู ุทุฑุงูุฉ ูู ุงููุชููุน');
                analysis.recommendations.push('ุฌุฑุจ ุทุฑููุฉ ุงูุฎูู (Creaming) ููุญุตูู ุนูู ููุงู ุฃุทุฑู');
            } else {
                analysis.strengths.push(`ุทุฑููุฉ ${mixingMethod === 'sablage' ? 'ุงููุฑู' : 'ุงูุฎูู'} ููุงุณุจุฉ ููููุงู ${detectedProfile.name}`);
            }
            
            // ุญุณุงุจ ูุดุงุท ุงููุงุก
            const waterActivity = calculateWaterActivity(ingredients, butterType, baking.temperature, techniques.twiceBaked);
            analysis.waterActivity = waterActivity;
            analysis.scientificAnalysis.push(`๐ง ูุดุงุท ุงููุงุก ุงููุชููุน (Aw): ${waterActivity}`);
            
            // ุชุญุฏูุฏ ุงูุงุณุชูุฑุงุฑ ุจูุงุกู ุนูู Aw
            if (waterActivity < 0.25) {
                analysis.stability = 'ุงุณุชุซูุงุฆูุฉ (45-60 ููู)';
            } else if (waterActivity < 0.30) {
                analysis.stability = 'ุนุงููุฉ ุฌุฏุงู (30-45 ููู)';
            } else if (waterActivity < 0.35) {
                analysis.stability = 'ุนุงููุฉ (21-30 ููู)';
            } else if (waterActivity < 0.40) {
                analysis.stability = 'ุนุงููุฉ (14-21 ููู)';
            } else if (waterActivity < 0.45) {
                analysis.stability = 'ูุชูุณุทุฉ (7-14 ููู)';
            } else {
                analysis.stability = 'ูุญุฏูุฏุฉ (3-7 ุฃูุงู)';
            }
            
            // ุชุญููู ุงูุชูููุงุช ุงูุฅุถุงููุฉ
            if (techniques.chilling) {
                analysis.score += 5;
                analysis.strengths.push('โ ุงูุชุจุฑูุฏ ูุจู ุงูุฎุจุฒ ูุญุณู ุงูููุงู ููููุน ุงูุงูุชุดุงุฑ');
            }
            
            if (techniques.docking) {
                analysis.score += 3;
                analysis.strengths.push('โ ุงูุชุฎุฑูู (Docking) ูููุน ุงูุชูุงุฎ ุงูุนุฌูู');
            }
            
            if (techniques.twiceBaked && detectedProfile.type === 'crispy') {
                analysis.score += 8;
                analysis.strengths.push('โ ุงูุฎุจุฒ ุงููุฒุฏูุฌ ูุซุงูู ูููุฑูุดุฉ ุงูุงุณุชุซูุงุฆูุฉ');
            } else if (techniques.twiceBaked && detectedProfile.type !== 'crispy') {
                analysis.weaknesses.push('โ๏ธ ุงูุฎุจุฒ ุงููุฒุฏูุฌ ูุฏ ูุฌุนู ุงูููุงู ุฌุงูุงู ุฌุฏุงู');
                analysis.recommendations.push('ุงุณุชุฎุฏู ุงูุฎุจุฒ ุงููุฒุฏูุฌ ููุท ููููุงู ุงูููุฑูุด');
            }
        
            // ุงูุชูููู ุงูููุงุฆู
            analysis.finalGrade = getAnalysisGrade(analysis.score);
            
            // ููุงุฑูุฉ ูุน ุงูุจุฑููุงููุงุช ุงูููุงุณูุฉ
            analysis.profileMatches = compareWithProfiles(analysis, ingredients, mixingMethod);
        
            // ุงูุชุฑุงุญุงุช ุฐููุฉ ููุชุญุณูู
            analysis.smartSuggestions = generateSmartSuggestions(analysis, ingredients);
        
            return analysis;
        }

        function calculateWaterActivity(ingredients, butterType, bakingTemp, twiceBaked) {
            const recipeEngine = new RecipeEngine();
            
            const totalFlour = ingredients.flour + (ingredients.riceFlour || 0) + (ingredients.cornstarch || 0);
            const butter = ingredients.butter;
            const sugar = ingredients.sugar || Math.round(totalFlour * 0.4);
            
            try {
                const awAnalysis = recipeEngine.calculateWaterActivity(
                    { 
                        flour: totalFlour, 
                        butter: butter, 
                        sugar: sugar 
                    },
                    butterType || 'european',
                    bakingTemp || 177,
                    twiceBaked || false
                );
                
                return awAnalysis.value;
            } catch (error) {
                console.error('Error in water activity calculation:', error);
                return calculateWaterActivityFallback(ingredients, butterType, bakingTemp, twiceBaked);
            }
        }
        
        function calculateWaterActivityFallback(ingredients, butterType, bakingTemp, twiceBaked) {
            let baseAw = 0.45;
            
            // ุชุฃุซูุฑ ูุณุจุฉ ุงูุฒุจุฏุฉ
            if (ingredients.butter && ingredients.flour) {
                const butterRatio = ingredients.butter / ingredients.flour;
                if (butterRatio > 0.7) baseAw -= 0.05;
                if (butterRatio < 0.5) baseAw += 0.05;
            }
            
            // ุชุฃุซูุฑ ุงููุถุงูุงุช
            if (ingredients.riceFlour) baseAw -= 0.03;
            if (ingredients.cornstarch) baseAw += 0.02;
            
            // ุชุฃุซูุฑ ุฏุฑุฌุฉ ุญุฑุงุฑุฉ ุงูุฎุจุฒ
            if (bakingTemp) {
                if (bakingTemp > 170) baseAw -= 0.04;
                if (bakingTemp < 150) baseAw += 0.04;
            }
            
            // ุชุฃุซูุฑ ููุน ุงูุฒุจุฏุฉ
            if (butterType === 'vegetable') baseAw -= 0.06;
            if (butterType === 'american') baseAw += 0.02;
            
            // ุชุฃุซูุฑ ุงูุฎุจุฒ ุงููุฒุฏูุฌ
            if (twiceBaked) baseAw -= 0.08;
            
            return Math.max(0.20, Math.min(0.70, baseAw)).toFixed(3);
        }
        
        function detectProfileFromIngredients(ratios, mixingMethod, sugarType, bakingTemp) {
            let scores = {
                tender: 0,
                traditional: 0,
                crispy: 0
            };
        
            // ุชุญููู ูุณุจุฉ ุงูุฒุจุฏุฉ
            if (ratios.butterToFlour >= 0.75) scores.tender += 3;
            else if (ratios.butterToFlour >= 0.60) scores.traditional += 2;
            else scores.crispy += 2;
        
            // ุชุญููู ููุน ุงูุณูุฑ
            if (sugarType === 'powdered') scores.tender += 2;
            else if (sugarType === 'granulated') scores.crispy += 1;
        
            // ุชุญููู ุทุฑููุฉ ุงูุฎูุท
            if (mixingMethod === 'creaming') scores.tender += 2;
            else if (mixingMethod === 'sablage') scores.crispy += 2;
        
            // ุชุญููู ุฏุฑุฌุฉ ุญุฑุงุฑุฉ ุงูุฎุจุฒ
            if (bakingTemp && bakingTemp < 155) scores.tender += 1;
            else if (bakingTemp && bakingTemp > 170) scores.crispy += 1;
        
            // ุฅูุฌุงุฏ ุงูุจุฑููุงูู ุงููุงุฆุฒ
            let maxScore = Math.max(scores.tender, scores.traditional, scores.crispy);
            let detectedProfile = 'traditional';
            
            if (scores.tender === maxScore) detectedProfile = 'tender';
            else if (scores.crispy === maxScore) detectedProfile = 'crispy';
        
            const profileNames = {
                tender: { name: 'ุทุฑู ูุฐูุจ ูู ุงููู', type: 'tender' },
                traditional: { name: 'ูุชูุงุฒู ุชูููุฏู', type: 'traditional' },
                crispy: { name: 'ููุฑูุด ูุชูุดุฑ', type: 'crispy' }
            };
        
            return profileNames[detectedProfile];
        }
        
        function compareWithProfiles(analysis, ingredients, mixingMethod) {
            const profiles = ScientificData.PROFILES;
            const matches = [];
            
            Object.keys(profiles).forEach(profileKey => {
                const profile = profiles[profileKey];
                let matchScore = 0;
                const maxScore = 100;
                
                // ููุงุฑูุฉ ูุณุจุฉ ุงูุฒุจุฏุฉ (30 ููุทุฉ)
                const profileButterRatio = profile.ratio[1] / profile.ratio[2];
                const actualButterRatio = analysis.ratios.butterToFlour;
                const butterDiff = Math.abs(profileButterRatio - actualButterRatio);
                matchScore += Math.max(0, 30 - (butterDiff * 50));
                
                // ููุงุฑูุฉ ุทุฑููุฉ ุงูุฎูุท (25 ููุทุฉ)
                if (profile.mixingMethod === mixingMethod) {
                    matchScore += 25;
                }
                
                // ููุงุฑูุฉ ุงููุถุงูุงุช (25 ููุทุฉ)
                if (profile.additive.type !== 'none') {
                    if (profile.additive.type === 'riceFlour' && ingredients.riceFlour) {
                        const additiveMatch = 1 - Math.abs(profile.additive.ratio - analysis.ratios.riceFlourRatio);
                        matchScore += additiveMatch * 25;
                    } else if (profile.additive.type === 'cornstarch' && ingredients.cornstarch) {
                        const additiveMatch = 1 - Math.abs(profile.additive.ratio - analysis.ratios.cornstarchRatio);
                        matchScore += additiveMatch * 25;
                    }
                } else {
                    // ุฅุฐุง ูู ูุณุชุฎุฏู ุงููุถุงูุงุช ูุงูุจุฑููุงูู ูุง ูุญุชุงุฌูุง
                    if (!ingredients.riceFlour && !ingredients.cornstarch) {
                        matchScore += 25;
                    }
                }
                
                // ููุงุฑูุฉ ููุน ุงูุณูุฑ (20 ููุทุฉ)
                if (profile.sugarType === 'powdered' && currentSugarType === 'powdered') {
                    matchScore += 20;
                } else if (profile.sugarType === 'granulated' && currentSugarType === 'granulated') {
                    matchScore += 20;
                }
                
                if (matchScore > 50) {
                    matches.push({
                        profile: profileKey,
                        score: Math.min(100, matchScore),
                        name: profile.name,
                        description: profile.description
                    });
                }
            });
            
            // ุชุฑุชูุจ ุญุณุจ ุงูุชุทุงุจู
            matches.sort((a, b) => b.score - a.score);
            
            return matches;
        }
        
        function generateSmartSuggestions(analysis, ingredients) {
            const suggestions = [];
            
            // ุชุญููู ูุณุจุฉ ุงูุฒุจุฏุฉ
            if (analysis.ratios.butterToFlour < 0.6) {
                suggestions.push({
                    type: 'critical',
                    icon: '๐ง',
                    title: 'ููุต ูู ุงูุฒุจุฏุฉ',
                    message: `ูุณุจุฉ ุงูุฒุจุฏุฉ ${(analysis.ratios.butterToFlour * 100).toFixed(1)}% ููุฎูุถุฉ`,
                    suggestion: `ุฃุถู ${Math.round((0.65 - analysis.ratios.butterToFlour) * ingredients.flour)} ุฌุฑุงู ุฒุจุฏุฉ ุฅุถุงููุฉ`,
                    impact: '+15 ููุทุฉ ูุชููุนุฉ',
                    priority: 1
                });
            } else if (analysis.ratios.butterToFlour > 0.8) {
                suggestions.push({
                    type: 'medium',
                    icon: '๐ง',
                    title: 'ุฒูุงุฏุฉ ูู ุงูุฒุจุฏุฉ',
                    message: `ูุณุจุฉ ุงูุฒุจุฏุฉ ${(analysis.ratios.butterToFlour * 100).toFixed(1)}% ูุฑุชูุนุฉ`,
                    suggestion: `ููู ุจููุฏุงุฑ ${Math.round((analysis.ratios.butterToFlour - 0.7) * ingredients.flour)} ุฌุฑุงู ุฒุจุฏุฉ`,
                    impact: '+10 ููุงุท ูุญุชููุฉ',
                    priority: 2
                });
            }
            
            // ุชุญููู ุทุฑููุฉ ุงูุฎูุท vs ุงูููุงู ุงููุชููุน
            if (analysis.texturePrediction.includes('ุทุฑู') && currentMixingMethod === 'sablage') {
                suggestions.push({
                    type: 'medium',
                    icon: '๐',
                    title: 'ุชูุงูุถ ูู ุทุฑููุฉ ุงูุฎูุท',
                    message: 'ุทุฑููุฉ ุงููุฑู (Sablage) ุชุณุชุฎุฏู ุนุงุฏุฉ ููููุงู ุงูููุฑูุด',
                    suggestion: 'ุฌุฑุจ ุทุฑููุฉ ุงูุฎูู (Creaming) ููุญุตูู ุนูู ููุงู ุฃุทุฑู',
                    impact: '+10 ููุงุท ูุญุชููุฉ',
                    priority: 2
                });
            }
            
            if (analysis.texturePrediction.includes('ููุฑูุด') && currentMixingMethod === 'creaming') {
                suggestions.push({
                    type: 'medium',
                    icon: '๐',
                    title: 'ุชูุงูุถ ูู ุทุฑููุฉ ุงูุฎูุท',
                    message: 'ุทุฑููุฉ ุงูุฎูู (Creaming) ุชุณุชุฎุฏู ุนุงุฏุฉ ููููุงู ุงูุทุฑู',
                    suggestion: 'ุฌุฑุจ ุทุฑููุฉ ุงููุฑู (Sablage) ููุญุตูู ุนูู ูุฑูุดุฉ ุฃูุถู',
                    impact: '+10 ููุงุท ูุญุชููุฉ',
                    priority: 2
                });
            }
            
            // ุงูุชุฑุงุญ ุงูุฎุจุฒ ุงููุฒุฏูุฌ ูููุฑูุดุฉ
            if (analysis.texturePrediction.includes('ููุฑูุด') && !analysis.strengths.some(s => s.includes('ุงูุฎุจุฒ ุงููุฒุฏูุฌ'))) {
                suggestions.push({
                    type: 'high',
                    icon: '๐ฅ',
                    title: 'ุชูููุฉ ุงูุฎุจุฒ ุงููุฒุฏูุฌ',
                    message: 'ูุซุงููุฉ ููููุงู ุงูููุฑูุด',
                    suggestion: 'ุทุจู ุชูููุฉ ุงูุฎุจุฒ ุงููุฒุฏูุฌ: ุงุฎุจุฒ 35 ุฏูููุฉุ ุงูุทุนุ ุซู ุงุฎุจุฒ 30 ุฏูููุฉ ูู ูุฑู ูุทูุฃ',
                    impact: '+8 ููุงุท + ุนูุฑ ุชุฎุฒููู ุฃุทูู',
                    priority: 1
                });
            }
            
            // ุงูุชุฑุงุญ ุงูุชุจุฑูุฏ ุฅุฐุง ูู ููุณุชุฎุฏู
            if (!analysis.strengths.some(s => s.includes('ุงูุชุจุฑูุฏ'))) {
                suggestions.push({
                    type: 'medium',
                    icon: 'โ๏ธ',
                    title: 'ุงูุชุจุฑูุฏ ูุจู ุงูุฎุจุฒ',
                    message: 'ููู ูููุน ุงูุงูุชุดุงุฑ ุงูููุฑุท',
                    suggestion: 'ุจุฑุฏ ุงูุนุฌูู ููุฏุฉ ุณุงุนุฉ ุนูู ุงูุฃูู ูุจู ุงูุฎุจุฒ',
                    impact: '+5 ููุงุท',
                    priority: 2
                });
            }
            
            // ุชุฑุชูุจ ุญุณุจ ุงูุฃููููุฉ
            return suggestions.sort((a, b) => a.priority - b.priority);
        }

        function getAnalysisGrade(score) {
            if (score >= 90) return { grade: 'ููุชุงุฒ', color: '#059669', icon: '๐' };
            if (score >= 80) return { grade: 'ุฌูุฏ ุฌุฏุงู', color: '#10b981', icon: 'โญ' };
            if (score >= 70) return { grade: 'ุฌูุฏ', color: '#d97706', icon: '๐' };
            if (score >= 60) return { grade: 'ููุจูู', color: '#ea580c', icon: '๐' };
            return { grade: 'ูุญุชุงุฌ ุชุญุณูู', color: '#dc2626', icon: '๐ง' };
        }

        function displayManualAnalysisResults(analysis) {
            const container = document.getElementById('manual-analysis-results');
            
            let html = `
                <div class="card card-purple">
                    <h3 class="subsection-title">๐ ูุชุงุฆุฌ ุงูุชุญููู ุงูุนููู</h3>
                    
                    <!-- ุงูุชูููู ุงูุนุงู -->
                    <div style="text-align: center; padding: 2rem; background: ${analysis.finalGrade.color}15; border-radius: 12px; border: 2px solid ${analysis.finalGrade.color}; margin-bottom: 2rem;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">${analysis.finalGrade.icon}</div>
                        <div style="font-size: 2rem; font-weight: bold; color: ${analysis.finalGrade.color}; margin-bottom: 0.5rem;">
                            ${analysis.finalGrade.grade}
                        </div>
                        <div style="font-size: 1.5rem; color: ${analysis.finalGrade.color};">
                            ${analysis.score}/100
                        </div>
                    </div>
        
                    <!-- ุชููุน ุงูููุงู ูุงูุงุณุชูุฑุงุฑ -->
                    <div class="grid-3">
                        <div class="card">
                            <h4 class="subsection-title">๐ฏ ุชููุน ุงูููุงู</h4>
                            <div style="font-size: 1.1rem; color: var(--primary-color); font-weight: bold; line-height: 1.4;">
                                ${analysis.texturePrediction}
                            </div>
                        </div>
                        <div class="card">
                            <h4 class="subsection-title">๐ก๏ธ ุงูุงุณุชูุฑุงุฑ ุงููุชููุน</h4>
                            <div style="font-size: 1.1rem; color: var(--secondary-color); font-weight: bold;">
                                ${analysis.stability}
                            </div>
                        </div>
                        <div class="card">
                            <h4 class="subsection-title">๐ ุงูุจุฑููุงูู ุงููุชุทุงุจู</h4>
                            <div style="font-size: 1.1rem; color: var(--primary-dark); font-weight: bold;">
                                ${analysis.profileMatch || 'ูุฎุชูุท'}
                            </div>
                        </div>
                    </div>
            `;
        
            // ๐ ุงูุชุญููู ุงูุชูุตููู ูููุณุจ
            if (analysis.detectedProfile && analysis.idealRanges) {
                html += `
                    <div class="card card-blue">
                        <h4 class="subsection-title">๐ ุงูุชุญููู ุงูุชูุตููู ูููุณุจ</h4>
                        <div class="grid-3">
                            <div class="stat-card">
                                <div class="stat-label">ุงูุฒุจุฏุฉ ุฅูู ุงูุฏููู</div>
                                <div class="stat-value">${(analysis.ratios.butterToFlour * 100).toFixed(1)}%</div>
                                <div class="text-sm text-gray-600 mt-1">
                                    ุงููุซุงูู: ${(analysis.idealRanges[analysis.detectedProfileType].butterToFlour.ideal * 100).toFixed(1)}%
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">ุงูุณูุฑ ุฅูู ุงูุฏููู</div>
                                <div class="stat-value">${analysis.ratios.sugarToFlour ? (analysis.ratios.sugarToFlour * 100).toFixed(1) + '%' : 'ุบูุฑ ูุญุฏุฏ'}</div>
                                <div class="text-sm text-gray-600 mt-1">
                                    ${analysis.ratios.sugarToFlour ? `ุงููุซุงูู: ${(analysis.idealRanges[analysis.detectedProfileType].sugarToFlour.ideal * 100).toFixed(1)}%` : ''}
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">ุงูููุญ ุฅูู ุงูุฏููู</div>
                                <div class="stat-value">${analysis.ratios.saltRatio ? (analysis.ratios.saltRatio * 100).toFixed(2) + '%' : 'ุบูุฑ ูุญุฏุฏ'}</div>
                                <div class="text-sm text-gray-600 mt-1">
                                    ${analysis.ratios.saltRatio ? `ุงููุซุงูู: ${(analysis.idealRanges[analysis.detectedProfileType].saltRatio.ideal * 100).toFixed(2)}%` : ''}
                                </div>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-amber-50 rounded-lg border border-amber-200">
                            <div class="font-semibold text-amber-900">๐ฏ ุงูุจุฑููุงูู ุงูููุชุดู: ${analysis.detectedProfile.name}</div>
                            <div class="text-sm text-amber-700 mt-1">
                                ุงููุธุงู ุงูุชุดู ุฃู ูุตูุชู ุชุชูุงูู ูุน ุจุฑููุงูู ${analysis.detectedProfile.name} ุจูุงุกู ุนูู ูุณุจ ุงูููููุงุช ูุงูุชูููุงุช ุงููุณุชุฎุฏูุฉ.
                            </div>
                        </div>
                    </div>
                `;
            }
        
            // ุงูููุงุท ุงููููุฉ
            if (analysis.strengths.length > 0) {
                html += `
                    <div class="card card-green">
                        <h4 class="subsection-title">โ ุงูููุงุท ุงููููุฉ</h4>
                        <ul class="space-y-2">
                            ${analysis.strengths.map(strength => `<li>โ ${strength}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
        
            // ููุงุท ุงูุชุญุณูู
            if (analysis.weaknesses.length > 0) {
                html += `
                    <div class="card card-red">
                        <h4 class="subsection-title">โ๏ธ ููุงุท ุชุญุชุงุฌ ุชุญุณูู</h4>
                        <ul class="space-y-2">
                            ${analysis.weaknesses.map(weakness => `<li>โ๏ธ ${weakness}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
        
            // ุงูุชูุตูุงุช
            if (analysis.recommendations.length > 0) {
                html += `
                    <div class="card card-blue">
                        <h4 class="subsection-title">๐ก ุงูุชูุตูุงุช ุงูุนูููุฉ</h4>
                        <ul class="space-y-2">
                            ${analysis.recommendations.map(rec => `<li>๐ก ${rec}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
        
            // โ ุนุฑุถ ุงูุงูุชุฑุงุญุงุช ุงูุฐููุฉ
            if (analysis.smartSuggestions && analysis.smartSuggestions.length > 0) {
                html += `
                    <div class="card card-blue">
                        <h4 class="subsection-title">๐ก ุงูุชุฑุงุญุงุช ุฐููุฉ ููุชุญุณูู</h4>
                        ${analysis.smartSuggestions.map(suggestion => `
                            <div style="margin-bottom: 1rem; padding: 1rem; background: ${getSuggestionColor(suggestion.type)}; border-radius: 8px; border-right: 4px solid ${getSuggestionBorderColor(suggestion.type)};">
                                <div style="display: flex; align-items: flex-start; gap: 0.75rem;">
                                    <div style="font-size: 1.5rem;">${suggestion.icon}</div>
                                    <div style="flex: 1;">
                                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;">
                                            <div>
                                                <div style="font-weight: bold; color: ${getSuggestionTextColor(suggestion.type)};">${suggestion.title}</div>
                                                <div style="color: #666; font-size: 0.9rem;">${suggestion.message}</div>
                                            </div>
                                            <div style="background: ${getSuggestionImpactColor(suggestion.type)}; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem; font-weight: bold;">
                                                ${suggestion.impact}
                                            </div>
                                        </div>
                                        <div style="background: white; padding: 0.75rem; border-radius: 4px; border: 1px solid #e5e7eb;">
                                            <span style="font-weight: 600;">ุงูุญู:</span> ${suggestion.suggestion}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
        
            // ุงูุชุญููู ุงูุนููู
            html += `
                <div class="card card-amber">
                    <h4 class="subsection-title">๐ฌ ุงูุชุญููู ุงูุนููู ุงููุชูุฏู</h4>
                    <div class="grid-2">
                        ${analysis.scientificAnalysis.map(item => `
                            <div style="background: white; padding: 1rem; border-radius: 8px; border: 1px solid #e5e7eb; margin-bottom: 0.5rem;">
                                ${item}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        
            // ุนุฑุถ ููุงุฑูุฉ ุงูุจุฑููุงููุงุช
            if (analysis.profileMatches && analysis.profileMatches.length > 0) {
                html += `
                    <div class="card card-green">
                        <h4 class="subsection-title">๐ฏ ุงูุชุทุงุจู ูุน ุงูุจุฑููุงููุงุช ุงูููุงุณูุฉ</h4>
                        ${analysis.profileMatches.map(match => `
                            <div style="margin-bottom: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 8px; border-right: 4px solid var(--primary-color);">
                                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;">
                                    <span style="font-weight: bold; font-size: 1.1rem;">${match.name}</span>
                                    <span style="color: var(--primary-color); font-weight: bold; font-size: 1.1rem;">${match.score.toFixed(0)}% ุชุทุงุจู</span>
                                </div>
                                <div style="color: var(--text-light); font-size: 0.9rem;">${match.description}</div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
        
            html += `</div>`;
            
            container.innerHTML = html;
            container.classList.remove('hidden');
            
            // ุงูุชูุฑูุฑ ุฅูู ุงููุชุงุฆุฌ
            container.scrollIntoView({ behavior: 'smooth' });
        }

        function getSuggestionColor(type) {
            const colors = {
                'critical': '#fee2e2',
                'high': '#fef3c7', 
                'medium': '#dbeafe',
                'low': '#ecfdf5'
            };
            return colors[type] || '#f3f4f6';
        }
        
        function getSuggestionBorderColor(type) {
            const colors = {
                'critical': '#dc2626',
                'high': '#d97706',
                'medium': '#3b82f6',
                'low': '#059669'
            };
            return colors[type] || '#6b7280';
        }
        
        function getSuggestionTextColor(type) {
            const colors = {
                'critical': '#dc2626',
                'high': '#d97706',
                'medium': '#1e40af',
                'low': '#059669'
            };
            return colors[type] || '#374151';
        }
        
        function getSuggestionImpactColor(type) {
            const colors = {
                'critical': '#dc2626',
                'high': '#d97706',
                'medium': '#3b82f6',
                'low': '#059669'
            };
            return colors[type] || '#6b7280';
        }

        function loadSampleRecipe(type) {
            const samples = {
                'ted-lasso': {
                    flour: 240,
                    butter: 227,
                    sugar: 90,
                    salt: 1,
                    bakingTemp: 149,
                    bakingTime: 50,
                    mixingMethod: 'creaming',
                    butterType: 'american',
                    sugarType: 'powdered',
                    techniques: {
                        chilling: true,
                        docking: true,
                        twiceBaked: false,
                        vanilla: true
                    }
                },
                'traditional': {
                    flour: 300,
                    butter: 200,
                    sugar: 100,
                    salt: 2,
                    bakingTemp: 160,
                    bakingTime: 25,
                    mixingMethod: 'sablage',
                    butterType: 'european',
                    sugarType: 'granulated',
                    techniques: {
                        chilling: true,
                        docking: true,
                        twiceBaked: false,
                        vanilla: false
                    }
                },
                'crispy': {
                    flour: 200,
                    butter: 180,
                    sugar: 80,
                    riceFlour: 50,
                    salt: 2,
                    bakingTemp: 177,
                    bakingTime: 35,
                    mixingMethod: 'sablage',
                    butterType: 'european',
                    sugarType: 'granulated',
                    techniques: {
                        chilling: true,
                        docking: true,
                        twiceBaked: true,
                        vanilla: false
                    }
                }
            };
            
            const sample = samples[type];
            
            // ุชุนุจุฆุฉ ุงูุญููู ุงูุฃุณุงุณูุฉ
            document.getElementById('has-flour').checked = true;
            document.getElementById('flour').value = sample.flour;
            document.getElementById('flour').disabled = false;
            
            document.getElementById('has-butter').checked = true;
            document.getElementById('butter').value = sample.butter;
            document.getElementById('butter').disabled = false;
            
            document.getElementById('has-sugar').checked = true;
            document.getElementById('sugar').value = sample.sugar;
            document.getElementById('sugar').disabled = false;
            
            document.getElementById('has-salt').checked = true;
            document.getElementById('salt').value = sample.salt;
            document.getElementById('salt').disabled = false;
            
            // ุชุนุจุฆุฉ ุงูุญููู ุงูุงุฎุชูุงุฑูุฉ
            if (sample.riceFlour) {
                document.getElementById('has-rice-flour').checked = true;
                document.getElementById('rice-flour').value = sample.riceFlour;
                document.getElementById('rice-flour').disabled = false;
            } else {
                document.getElementById('has-rice-flour').checked = false;
                document.getElementById('rice-flour').value = '';
                document.getElementById('rice-flour').disabled = true;
            }
            
            // ุฅุนุงุฏุฉ ุชุนููู ูุดุง ุงูุฐุฑุฉ
            document.getElementById('has-cornstarch').checked = false;
            document.getElementById('cornstarch').value = '';
            document.getElementById('cornstarch').disabled = true;
            
            // ุชุนุจุฆุฉ ุฅุนุฏุงุฏุงุช ุงูุฎุจุฒ
            document.getElementById('baking-temp').value = sample.bakingTemp;
            document.getElementById('baking-time').value = sample.bakingTime;
            
            // ุชุนุจุฆุฉ ุงูุชูููุงุช
            document.getElementById('has-chilling').checked = sample.techniques.chilling;
            document.getElementById('has-docking').checked = sample.techniques.docking;
            document.getElementById('has-twice-baked').checked = sample.techniques.twiceBaked;
            document.getElementById('has-vanilla').checked = sample.techniques.vanilla;
            
            // ุชุญุฏูุฏ ุงูุทุฑู ุจุงุณุชุฎุฏุงู ุงูุนูุงุตุฑ ุงูุตุญูุญุฉ
            const mixingCards = document.querySelectorAll('.card:has(.subsection-title:contains("ุทุฑููุฉ ุงูุฎูุท")) .option-card');
            const butterCards = document.querySelectorAll('.card:has(.subsection-title:contains("ููุน ุงูุฒุจุฏุฉ")) .option-card');
            const sugarCards = document.querySelectorAll('.card:has(.subsection-title:contains("ููุน ุงูุณูุฑ")) .option-card');
            
            // ุชุญุฏูุฏ ุทุฑููุฉ ุงูุฎูุท
            if (sample.mixingMethod === 'sablage') {
                selectAnalyzerMixingMethod('sablage', mixingCards[0]);
            } else if (sample.mixingMethod === 'creaming') {
                selectAnalyzerMixingMethod('creaming', mixingCards[1]);
            } else {
                selectAnalyzerMixingMethod('unknown', mixingCards[2]);
            }
            
            // ุชุญุฏูุฏ ููุน ุงูุฒุจุฏุฉ
            if (sample.butterType === 'european') {
                selectAnalyzerButterType('european', butterCards[0]);
            } else if (sample.butterType === 'american') {
                selectAnalyzerButterType('american', butterCards[1]);
            } else if (sample.butterType === 'vegetable') {
                selectAnalyzerButterType('vegetable', butterCards[2]);
            } else {
                selectAnalyzerButterType('unknown', butterCards[3]);
            }
            
            // ุชุญุฏูุฏ ููุน ุงูุณูุฑ
            if (sample.sugarType === 'granulated') {
                selectAnalyzerSugarType('granulated', sugarCards[0]);
            } else if (sample.sugarType === 'powdered') {
                selectAnalyzerSugarType('powdered', sugarCards[1]);
            } else {
                selectAnalyzerSugarType('unknown', sugarCards[2]);
            }
            
            uiManager.showNotification(`โ ุชู ุชุญููู ูุตูุฉ ${type === 'ted-lasso' ? 'ุจุณูููุช ุชูุฏ ูุงุณู' : type === 'traditional' ? 'ุงูุชูููุฏูุฉ ุงููุชูุงุฒูุฉ' : 'ุงูููุฑูุดุฉ'}`);
        }

        // =============================================
        // ุงูุชููุฆุฉ ูุงููุธุงุฆู ุงูุนุงูุฉ
        // =============================================

        let uiManager = null;
        
        // ุฏูุงู ูุณุงุนุฏุฉ ูููุตูู ูู HTML
        function handleMixingMethodSelect(method, element) {
            if (uiManager) {
                uiManager.selectMixingMethod(method, { currentTarget: element });
            }
        }

        function switchTab(tabName) {
            if (uiManager) uiManager.switchTab(tabName);
        }

        function selectQuickProfile(profile) {
            if (uiManager) uiManager.selectQuickProfile(profile);
        }

        function selectTexture(texture) {
            if (uiManager) uiManager.selectTexture(texture);
        }

        function selectButter(butterType) {
            if (uiManager) uiManager.selectButter(butterType);
        }

        function setMode(mode) {
            if (uiManager) uiManager.setMode(mode);
        }

        function init() {
            if (uiManager) {
                console.warn('UIManager already initialized');
                return;
            }
            
            uiManager = new UIManager();
            
            // ุชุนุฑูู ุงูุฏูุงู ุนูู ุงููุทุงู ุงูุนุงู ูููุตูู ูู HTML
            window.uiManager = uiManager;
            window.switchTab = switchTab;
            window.selectQuickProfile = selectQuickProfile;
            window.selectTexture = selectTexture;
            window.selectButter = selectButter;
            window.selectMixingMethod = handleMixingMethodSelect;
            window.setMode = setMode;
            window.toggleInput = toggleInput;
            window.selectAnalyzerMixingMethod = selectAnalyzerMixingMethod;
            window.selectAnalyzerButterType = selectAnalyzerButterType;
            window.selectAnalyzerSugarType = selectAnalyzerSugarType;
            window.analyzeManualRecipe = analyzeManualRecipe;
            window.loadSampleRecipe = loadSampleRecipe;
            
            console.log('โ ุชู ุชููุฆุฉ ูููุฏุณ ุงูุดูุฑุช ุจุฑูุฏ ุงูุนููู ุงููุญุณู ุจูุฌุงุญ!');
        }

        // ุชููุฆุฉ ุงูุชุทุจูู ุนูุฏ ุชุญููู ุงูุตูุญุฉ
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>